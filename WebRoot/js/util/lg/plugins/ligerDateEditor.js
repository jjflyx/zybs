(function(a){a.fn.ligerDateEditor=function(){return a.ligerui.run.call(this,"ligerDateEditor",arguments);};a.fn.ligerGetDateEditorManager=function(){return a.ligerui.run.call(this,"ligerGetDateEditorManager",arguments);};a.ligerDefaults.DateEditor={format:"yyyy-MM-dd hh:mm",showTime:false,onChangeDate:false,absolute:true};a.ligerDefaults.DateEditorString={dayMessage:["日","一","二","三","四","五","六"],monthMessage:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],todayMessage:"今天",closeMessage:"关闭"};a.ligerMethos.DateEditor={};a.ligerui.controls.DateEditor=function(c,b){a.ligerui.controls.DateEditor.base.constructor.call(this,c,b);};a.ligerui.controls.DateEditor.ligerExtend(a.ligerui.controls.Input,{__getType:function(){return"DateEditor";},__idPrev:function(){return"DateEditor";},_extendMethods:function(){return a.ligerMethos.DateEditor;},_render:function(){var d=this,e=this.options;if(!e.showTime&&e.format.indexOf(" hh:mm")>-1){e.format=e.format.replace(" hh:mm","");}if(this.element.tagName.toLowerCase()!="input"||this.element.type!="text"){return;}d.inputText=a(this.element);if(!d.inputText.hasClass("l-text-field")){d.inputText.addClass("l-text-field");}d.link=a('<div class="l-trigger"><div class="l-trigger-icon"></div></div>');d.text=d.inputText.wrap('<div class="l-text l-text-date"></div>').parent();d.text.append('<div class="l-text-l"></div><div class="l-text-r"></div>');d.text.append(d.link);d.textwrapper=d.text.wrap('<div class="l-text-wrapper"></div>').parent();var c="";c+="<div class='l-box-dateeditor' style='display:none'>";c+="    <div class='l-box-dateeditor-header'>";c+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevyear'><span></span></div>";c+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-prevmonth'><span></span></div>";c+="        <div class='l-box-dateeditor-header-text'><a class='l-box-dateeditor-header-month'></a> , <a  class='l-box-dateeditor-header-year'></a></div>";c+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextmonth'><span></span></div>";c+="        <div class='l-box-dateeditor-header-btn l-box-dateeditor-header-nextyear'><span></span></div>";c+="    </div>";c+="    <div class='l-box-dateeditor-body'>";c+="        <table cellpadding='0' cellspacing='0' border='0' class='l-box-dateeditor-calendar'>";c+="            <thead>";c+="                <tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>";c+="            </thead>";c+="            <tbody>";c+="                <tr class='l-first'><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr><tr><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td><td align='center'></td></tr>";c+="            </tbody>";c+="        </table>";c+="        <ul class='l-box-dateeditor-monthselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";c+="        <ul class='l-box-dateeditor-yearselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";c+="        <ul class='l-box-dateeditor-hourselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";c+="        <ul class='l-box-dateeditor-minuteselector'><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li><li></li></ul>";c+="    </div>";c+="    <div class='l-box-dateeditor-toolbar'>";c+="        <div class='l-box-dateeditor-time'></div>";c+="        <div class='l-button l-button-today'></div>";c+="        <div class='l-button l-button-close'></div>";c+="        <div class='l-clear'></div>";c+="    </div>";c+="</div>";d.dateeditor=a(c);if(e.absolute){d.dateeditor.appendTo("body").addClass("l-box-dateeditor-absolute");}else{d.textwrapper.append(d.dateeditor);}d.header=a(".l-box-dateeditor-header",d.dateeditor);d.body=a(".l-box-dateeditor-body",d.dateeditor);d.toolbar=a(".l-box-dateeditor-toolbar",d.dateeditor);d.body.thead=a("thead",d.body);d.body.tbody=a("tbody",d.body);d.body.monthselector=a(".l-box-dateeditor-monthselector",d.body);d.body.yearselector=a(".l-box-dateeditor-yearselector",d.body);d.body.hourselector=a(".l-box-dateeditor-hourselector",d.body);d.body.minuteselector=a(".l-box-dateeditor-minuteselector",d.body);d.toolbar.time=a(".l-box-dateeditor-time",d.toolbar);d.toolbar.time.hour=a("<a></a>");d.toolbar.time.minute=a("<a></a>");d.buttons={btnPrevYear:a(".l-box-dateeditor-header-prevyear",d.header),btnNextYear:a(".l-box-dateeditor-header-nextyear",d.header),btnPrevMonth:a(".l-box-dateeditor-header-prevmonth",d.header),btnNextMonth:a(".l-box-dateeditor-header-nextmonth",d.header),btnYear:a(".l-box-dateeditor-header-year",d.header),btnMonth:a(".l-box-dateeditor-header-month",d.header),btnToday:a(".l-button-today",d.toolbar),btnClose:a(".l-button-close",d.toolbar)};var b=new Date();d.now={year:b.getFullYear(),month:b.getMonth()+1,day:b.getDay(),date:b.getDate(),hour:b.getHours(),minute:b.getMinutes()};d.currentDate={year:b.getFullYear(),month:b.getMonth()+1,day:b.getDay(),date:b.getDate(),hour:b.getHours(),minute:b.getMinutes()};d.selectedDate=null;d.usedDate=null;a("td",d.body.thead).each(function(f,g){a(g).html(e.dayMessage[f]);});a("li",d.body.monthselector).each(function(g,f){a(f).html(e.monthMessage[g]);});d.buttons.btnToday.html(e.todayMessage);d.buttons.btnClose.html(e.closeMessage);if(e.showTime){d.toolbar.time.show();d.toolbar.time.append(d.toolbar.time.hour).append(":").append(d.toolbar.time.minute);a("li",d.body.hourselector).each(function(f,g){var h=f;if(f<10){h="0"+f.toString();}a(this).html(h);});a("li",d.body.minuteselector).each(function(f,g){var h=f;if(f<10){h="0"+f.toString();}a(this).html(h);});}d.bulidContent();if(d.inputText.val()!=""){d.onTextChange();}d.dateeditor.hover(null,function(f){if(d.dateeditor.is(":visible")&&!d.editorToggling){d.toggleDateEditor(true);}});d.link.hover(function(){if(e.disabled){return;}this.className="l-trigger-hover";},function(){if(e.disabled){return;}this.className="l-trigger";}).mousedown(function(){if(e.disabled){return;}this.className="l-trigger-pressed";}).mouseup(function(){if(e.disabled){return;}this.className="l-trigger-hover";}).click(function(){if(e.disabled){return;}d.bulidContent();d.toggleDateEditor(d.dateeditor.is(":visible"));});if(e.disabled){d.inputText.attr("readonly","readonly");d.text.addClass("l-text-disabled");}if(e.initValue){d.inputText.val(e.initValue);}d.buttons.btnClose.click(function(){d.toggleDateEditor(true);});a("td",d.body.tbody).hover(function(){if(a(this).hasClass("l-box-dateeditor-today")){return;}a(this).addClass("l-box-dateeditor-over");},function(){a(this).removeClass("l-box-dateeditor-over");}).click(function(){a(".l-box-dateeditor-selected",d.body.tbody).removeClass("l-box-dateeditor-selected");if(!a(this).hasClass("l-box-dateeditor-today")){a(this).addClass("l-box-dateeditor-selected");}d.currentDate.date=parseInt(a(this).html());d.currentDate.day=new Date(d.currentDate.year,d.currentDate.month-1,1).getDay();if(a(this).hasClass("l-box-dateeditor-out")){if(a("tr",d.body.tbody).index(a(this).parent())==0){if(--d.currentDate.month==0){d.currentDate.month=12;d.currentDate.year--;}}else{if(++d.currentDate.month==13){d.currentDate.month=1;d.currentDate.year++;}}}d.selectedDate={year:d.currentDate.year,month:d.currentDate.month,date:d.currentDate.date};d.showDate();d.editorToggling=true;d.dateeditor.slideToggle("fast",function(){d.editorToggling=false;});});a(".l-box-dateeditor-header-btn",d.header).hover(function(){a(this).addClass("l-box-dateeditor-header-btn-over");},function(){a(this).removeClass("l-box-dateeditor-header-btn-over");});d.buttons.btnYear.click(function(){if(!d.body.yearselector.is(":visible")){a("li",d.body.yearselector).each(function(g,h){var f=d.currentDate.year+(g-4);if(f==d.currentDate.year){a(this).addClass("l-selected");}else{a(this).removeClass("l-selected");}a(this).html(f);});}d.body.yearselector.slideToggle();});d.body.yearselector.hover(function(){},function(){a(this).slideUp();});a("li",d.body.yearselector).click(function(){d.currentDate.year=parseInt(a(this).html());d.body.yearselector.slideToggle();d.bulidContent();});d.buttons.btnMonth.click(function(){a("li",d.body.monthselector).each(function(f,g){if(d.currentDate.month==f+1){a(this).addClass("l-selected");}else{a(this).removeClass("l-selected");}});d.body.monthselector.slideToggle();});d.body.monthselector.hover(function(){},function(){a(this).slideUp("fast");});a("li",d.body.monthselector).click(function(){var f=a("li",d.body.monthselector).index(this);d.currentDate.month=f+1;d.body.monthselector.slideToggle();d.bulidContent();});d.toolbar.time.hour.click(function(){a("li",d.body.hourselector).each(function(f,g){if(d.currentDate.hour==f){a(this).addClass("l-selected");}else{a(this).removeClass("l-selected");}});d.body.hourselector.slideToggle();});d.body.hourselector.hover(function(){},function(){a(this).slideUp("fast");});a("li",d.body.hourselector).click(function(){var f=a("li",d.body.hourselector).index(this);d.currentDate.hour=f;d.body.hourselector.slideToggle();d.bulidContent();});d.toolbar.time.minute.click(function(){a("li",d.body.minuteselector).each(function(f,g){if(d.currentDate.minute==f){a(this).addClass("l-selected");}else{a(this).removeClass("l-selected");}});d.body.minuteselector.slideToggle("fast",function(){var f=a("li",this).index(a("li.l-selected",this));if(f>29){var g=(a("li.l-selected",this).offset().top-a(this).offset().top);a(this).animate({scrollTop:g});}});});d.body.minuteselector.hover(function(){},function(){a(this).slideUp("fast");});a("li",d.body.minuteselector).click(function(){var f=a("li",d.body.minuteselector).index(this);d.currentDate.minute=f;d.body.minuteselector.slideToggle("fast");d.bulidContent();});d.buttons.btnPrevMonth.click(function(){if(--d.currentDate.month==0){d.currentDate.month=12;d.currentDate.year--;}d.bulidContent();});d.buttons.btnNextMonth.click(function(){if(++d.currentDate.month==13){d.currentDate.month=1;d.currentDate.year++;}d.bulidContent();});d.buttons.btnPrevYear.click(function(){d.currentDate.year--;d.bulidContent();});d.buttons.btnNextYear.click(function(){d.currentDate.year++;d.bulidContent();});d.buttons.btnToday.click(function(){d.currentDate={year:d.now.year,month:d.now.month,day:d.now.day,date:d.now.date};d.selectedDate={year:d.now.year,month:d.now.month,day:d.now.day,date:d.now.date};d.showDate();d.dateeditor.slideToggle("fast");});d.inputText.change(function(){d.onTextChange();}).blur(function(){d.text.removeClass("l-text-focus");}).focus(function(){d.text.addClass("l-text-focus");});d.text.hover(function(){d.text.addClass("l-text-over");},function(){d.text.removeClass("l-text-over");});if(e.label){d.labelwrapper=d.textwrapper.wrap('<div class="l-labeltext"></div>').parent();d.labelwrapper.prepend('<div class="l-text-label" style="float:left;display:inline;">'+e.label+":&nbsp</div>");d.textwrapper.css("float","left");if(!e.labelWidth){e.labelWidth=a(".l-text-label",d.labelwrapper).outerWidth();}else{a(".l-text-label",d.labelwrapper).outerWidth(e.labelWidth);}a(".l-text-label",d.labelwrapper).width(e.labelWidth);a(".l-text-label",d.labelwrapper).height(d.text.height());d.labelwrapper.append('<br style="clear:both;" />');if(e.labelAlign){a(".l-text-label",d.labelwrapper).css("text-align",e.labelAlign);}d.textwrapper.css({display:"inline"});d.labelwrapper.width(d.text.outerWidth()+e.labelWidth+2);}d.set(e);},destroy:function(){if(this.textwrapper){this.textwrapper.remove();}if(this.dateeditor){this.dateeditor.remove();}this.options=null;a.ligerui.remove(this);},bulidContent:function(){var e=this,f=this.options;var c=new Date(e.currentDate.year,e.currentDate.month-1,1).getDay();var b=e.currentDate.month;var i=e.currentDate.year;if(++b==13){b=1;i++;}var h=new Date(i,b-1,0).getDate();var d=new Date(e.currentDate.year,e.currentDate.month-1,0).getDate();e.buttons.btnMonth.html(f.monthMessage[e.currentDate.month-1]);e.buttons.btnYear.html(e.currentDate.year);e.toolbar.time.hour.html(e.currentDate.hour);e.toolbar.time.minute.html(e.currentDate.minute);if(e.toolbar.time.hour.html().length==1){e.toolbar.time.hour.html("0"+e.toolbar.time.hour.html());}if(e.toolbar.time.minute.html().length==1){e.toolbar.time.minute.html("0"+e.toolbar.time.minute.html());}a("td",this.body.tbody).each(function(){this.className="";});a("tr",this.body.tbody).each(function(g,j){a("td",j).each(function(l,n){var m=g*7+(l-c);var k=m+1;if(e.selectedDate&&e.currentDate.year==e.selectedDate.year&&e.currentDate.month==e.selectedDate.month&&m+1==e.selectedDate.date){if(l==0||l==6){a(n).addClass("l-box-dateeditor-holiday");}a(n).addClass("l-box-dateeditor-selected");a(n).siblings().removeClass("l-box-dateeditor-selected");}else{if(e.currentDate.year==e.now.year&&e.currentDate.month==e.now.month&&m+1==e.now.date){if(l==0||l==6){a(n).addClass("l-box-dateeditor-holiday");}a(n).addClass("l-box-dateeditor-today");}else{if(m<0){k=d+k;a(n).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected");}else{if(m>h-1){k=k-h;a(n).addClass("l-box-dateeditor-out").removeClass("l-box-dateeditor-selected");}else{if(l==0||l==6){a(n).addClass("l-box-dateeditor-holiday").removeClass("l-box-dateeditor-selected");}else{n.className="";}}}}}a(n).html(k);});});},updateSelectBoxPosition:function(){var b=this,c=this.options;if(c.absolute){b.dateeditor.css({left:b.text.offset().left,top:b.text.offset().top+1+b.text.outerHeight()});}else{if(b.text.offset().top+4>b.dateeditor.height()&&b.text.offset().top+b.dateeditor.height()+textHeight+4-a(window).scrollTop()>a(window).height()){b.dateeditor.css("marginTop",-1*(b.dateeditor.height()+textHeight+5));b.showOnTop=true;}else{b.showOnTop=false;}}},toggleDateEditor:function(b){var c=this,d=this.options;var e=c.text.height();c.editorToggling=true;if(b){c.dateeditor.hide("fast",function(){c.editorToggling=false;});}else{c.updateSelectBoxPosition();c.dateeditor.slideDown("fast",function(){c.editorToggling=false;});}},showDate:function(){var c=this,d=this.options;if(!this.selectedDate){return;}var b=c.selectedDate.year+"/"+c.selectedDate.month+"/"+c.selectedDate.date;this.currentDate.hour=parseInt(c.toolbar.time.hour.html(),10);this.currentDate.minute=parseInt(c.toolbar.time.minute.html(),10);if(d.showTime){b+=" "+this.currentDate.hour+":"+this.currentDate.minute;}this.inputText.val(b);this.inputText.trigger("change").focus();},isDateTime:function(b){var e=this,f=this.options;var c=b.match(/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2})$/);if(c==null){return false;}var h=new Date(c[1],c[3]-1,c[4]);if(h=="NaN"){return false;}return(h.getFullYear()==c[1]&&(h.getMonth()+1)==c[3]&&h.getDate()==c[4]);},isLongDateTime:function(b){var f=this,h=this.options;var c=/^(\d{1,4})(-|\/)(\d{1,2})\2(\d{1,2}) (\d{1,2}):(\d{1,2})$/;var e=b.match(c);if(e==null){return false;}var i=new Date(e[1],e[3]-1,e[4],e[5],e[6]);if(i=="NaN"){return false;}return(i.getFullYear()==e[1]&&(i.getMonth()+1)==e[3]&&i.getDate()==e[4]&&i.getHours()==e[5]&&i.getMinutes()==e[6]);},getFormatDate:function(c){var d=this,f=this.options;if(c=="NaN"){return null;}var e=f.format;var h={"M+":c.getMonth()+1,"d+":c.getDate(),"h+":c.getHours(),"m+":c.getMinutes(),"s+":c.getSeconds(),"q+":Math.floor((c.getMonth()+3)/3),"S":c.getMilliseconds()};if(/(y+)/.test(e)){e=e.replace(RegExp.$1,(c.getFullYear()+"").substr(4-RegExp.$1.length));}for(var b in h){if(new RegExp("("+b+")").test(e)){e=e.replace(RegExp.$1,RegExp.$1.length==1?h[b]:("00"+h[b]).substr((""+h[b]).length));}}return e;},onTextChange:function(){var c=this,d=this.options;var e=c.inputText.val();if(e==""){c.selectedDate=null;return true;}if(!d.showTime&&!c.isDateTime(e)){if(!c.usedDate){c.inputText.val("");}else{c.inputText.val(c.getFormatDate(c.usedDate));}}else{if(d.showTime&&!c.isLongDateTime(e)){if(!c.usedDate){c.inputText.val("");}else{c.inputText.val(c.getFormatDate(c.usedDate));}}else{e=e.replace(/-/g,"/");var b=c.getFormatDate(new Date(e));if(b==null){if(!c.usedDate){c.inputText.val("");}else{c.inputText.val(c.getFormatDate(c.usedDate));}}c.usedDate=new Date(e);c.selectedDate={year:c.usedDate.getFullYear(),month:c.usedDate.getMonth()+1,day:c.usedDate.getDay(),date:c.usedDate.getDate(),hour:c.usedDate.getHours(),minute:c.usedDate.getMinutes()};c.currentDate={year:c.usedDate.getFullYear(),month:c.usedDate.getMonth()+1,day:c.usedDate.getDay(),date:c.usedDate.getDate(),hour:c.usedDate.getHours(),minute:c.usedDate.getMinutes()};c.inputText.val(b);c.trigger("changeDate",[b]);if(a(c.dateeditor).is(":visible")){c.bulidContent();}}}},_setHeight:function(c){var b=this;if(c>4){b.text.css({height:c});b.inputText.css({height:c});b.textwrapper.css({height:c});}},_setWidth:function(c){var b=this;if(c>20){b.text.css({width:c});b.inputText.css({width:c-20});b.textwrapper.css({width:c});}},_setValue:function(c){var b=this;if(!c){b.inputText.val("");}if(typeof c=="string"){b.inputText.val(c);}else{if(typeof c=="object"){if(c instanceof Date){b.inputText.val(b.getFormatDate(c));b.onTextChange();}}}},_getValue:function(){return this.usedDate;},setEnabled:function(){var b=this,c=this.options;this.inputText.removeAttr("readonly");this.text.removeClass("l-text-disabled");c.disabled=false;},setDisabled:function(){var b=this,c=this.options;this.inputText.attr("readonly","readonly");this.text.addClass("l-text-disabled");c.disabled=true;}});})(jQuery);