(function(a){a.fn.ligerLayout=function(b){return a.ligerui.run.call(this,"ligerLayout",arguments);};a.fn.ligerGetLayoutManager=function(){return a.ligerui.run.call(this,"ligerGetLayoutManager",arguments);};a.ligerDefaults.Layout={topHeight:50,bottomHeight:50,leftWidth:110,centerWidth:300,rightWidth:170,InWindow:true,heightDiff:0,height:"100%",onHeightChanged:null,isLeftCollapse:false,isRightCollapse:false,allowLeftCollapse:true,allowRightCollapse:true,allowLeftResize:true,allowRightResize:true,allowTopResize:true,allowBottomResize:true,space:3,onEndResize:null,minLeftWidth:80,minRightWidth:80};a.ligerMethos.Layout={};a.ligerui.controls.Layout=function(c,b){a.ligerui.controls.Layout.base.constructor.call(this,c,b);};a.ligerui.controls.Layout.ligerExtend(a.ligerui.core.UIComponent,{__getType:function(){return"Layout";},__idPrev:function(){return"Layout";},_extendMethods:function(){return a.ligerMethos.Layout;},_render:function(){var e=this,h=this.options;e.layout=a(this.element);e.layout.addClass("l-layout");e.width=e.layout.width();if(a("> div[position=top]",e.layout).length>0){e.top=a("> div[position=top]",e.layout).wrap('<div class="l-layout-top" style="top:0px;"></div>').parent();e.top.content=a("> div[position=top]",e.top);if(!e.top.content.hasClass("l-layout-content")){e.top.content.addClass("l-layout-content");}e.topHeight=h.topHeight;if(e.topHeight){e.top.height(e.topHeight);}}if(a("> div[position=bottom]",e.layout).length>0){e.bottom=a("> div[position=bottom]",e.layout).wrap('<div class="l-layout-bottom"></div>').parent();e.bottom.content=a("> div[position=bottom]",e.bottom);if(!e.bottom.content.hasClass("l-layout-content")){e.bottom.content.addClass("l-layout-content");}e.bottomHeight=h.bottomHeight;if(e.bottomHeight){e.bottom.height(e.bottomHeight);}var c=e.bottom.content.attr("title");if(c){e.bottom.header=a('<div class="l-layout-header"></div>');e.bottom.prepend(e.bottom.header);e.bottom.header.html(c);e.bottom.content.attr("title","");}}if(a("> div[position=left]",e.layout).length>0){e.left=a("> div[position=left]",e.layout).wrap('<div class="l-layout-left" style="left:0px;"></div>').parent();e.left.header=a('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>');e.left.prepend(e.left.header);e.left.header.toggle=a(".l-layout-header-toggle",e.left.header);e.left.content=a("> div[position=left]",e.left);if(!e.left.content.hasClass("l-layout-content")){e.left.content.addClass("l-layout-content");}if(!h.allowLeftCollapse){a(".l-layout-header-toggle",e.left.header).remove();}var d=e.left.content.attr("title");if(d){e.left.content.attr("title","");a(".l-layout-header-inner",e.left.header).html(d);}e.leftWidth=h.leftWidth;if(e.leftWidth){e.left.width(e.leftWidth);}}if(a("> div[position=center]",e.layout).length>0){e.center=a("> div[position=center]",e.layout).wrap('<div class="l-layout-center" ></div>').parent();e.center.content=a("> div[position=center]",e.center);e.center.content.addClass("l-layout-content");var b=e.center.content.attr("title");if(b){e.center.content.attr("title","");e.center.header=a('<div class="l-layout-header"></div>');e.center.prepend(e.center.header);e.center.header.html(b);}e.centerWidth=h.centerWidth;if(e.centerWidth){e.center.width(e.centerWidth);}}if(a("> div[position=right]",e.layout).length>0){e.right=a("> div[position=right]",e.layout).wrap('<div class="l-layout-right"></div>').parent();e.right.header=a('<div class="l-layout-header"><div class="l-layout-header-toggle"></div><div class="l-layout-header-inner"></div></div>');e.right.prepend(e.right.header);e.right.header.toggle=a(".l-layout-header-toggle",e.right.header);if(!h.allowRightCollapse){a(".l-layout-header-toggle",e.right.header).remove();}e.right.content=a("> div[position=right]",e.right);if(!e.right.content.hasClass("l-layout-content")){e.right.content.addClass("l-layout-content");}var f=e.right.content.attr("title");if(f){e.right.content.attr("title","");a(".l-layout-header-inner",e.right.header).html(f);}e.rightWidth=h.rightWidth;if(e.rightWidth){e.right.width(e.rightWidth);}}e.layout.lock=a("<div class='l-layout-lock'></div>");e.layout.append(e.layout.lock);e._addDropHandle();e.isLeftCollapse=h.isLeftCollapse;e.isRightCollapse=h.isRightCollapse;e.leftCollapse=a('<div class="l-layout-collapse-left" style="display: none; "><div class="l-layout-collapse-left-toggle"></div></div>');e.rightCollapse=a('<div class="l-layout-collapse-right" style="display: none; "><div class="l-layout-collapse-right-toggle"></div></div>');e.layout.append(e.leftCollapse).append(e.rightCollapse);e.leftCollapse.toggle=a("> .l-layout-collapse-left-toggle",e.leftCollapse);e.rightCollapse.toggle=a("> .l-layout-collapse-right-toggle",e.rightCollapse);e._setCollapse();e._bulid();a(window).resize(function(){e._onResize();});e.set(h);},setLeftCollapse:function(c){var b=this,d=this.options;if(!b.left){return false;}b.isLeftCollapse=c;if(b.isLeftCollapse){b.leftCollapse.show();b.leftDropHandle&&b.leftDropHandle.hide();b.left.hide();}else{b.leftCollapse.hide();b.leftDropHandle&&b.leftDropHandle.show();b.left.show();}b._onResize();},setRightCollapse:function(c){var b=this,d=this.options;if(!b.right){return false;}b.isRightCollapse=c;b._onResize();if(b.isRightCollapse){b.rightCollapse.show();b.rightDropHandle&&b.rightDropHandle.hide();b.right.hide();}else{b.rightCollapse.hide();b.rightDropHandle&&b.rightDropHandle.show();b.right.show();}b._onResize();},_bulid:function(){var b=this,c=this.options;a("> .l-layout-left .l-layout-header,> .l-layout-right .l-layout-header",b.layout).hover(function(){a(this).addClass("l-layout-header-over");},function(){a(this).removeClass("l-layout-header-over");});a(".l-layout-header-toggle",b.layout).hover(function(){a(this).addClass("l-layout-header-toggle-over");},function(){a(this).removeClass("l-layout-header-toggle-over");});a(".l-layout-header-toggle",b.left).click(function(){b.setLeftCollapse(true);});a(".l-layout-header-toggle",b.right).click(function(){b.setRightCollapse(true);});b.middleTop=0;if(b.top){b.middleTop+=b.top.height();b.middleTop+=parseInt(b.top.css("borderTopWidth"));b.middleTop+=parseInt(b.top.css("borderBottomWidth"));b.middleTop+=c.space;}if(b.left){b.left.css({top:b.middleTop});b.leftCollapse.css({top:b.middleTop});}if(b.center){b.center.css({top:b.middleTop});}if(b.right){b.right.css({top:b.middleTop});b.rightCollapse.css({top:b.middleTop});}if(b.left){b.left.css({left:0});}b._onResize();b._onResize();},_setCollapse:function(){var b=this,c=this.options;b.leftCollapse.hover(function(){a(this).addClass("l-layout-collapse-left-over");},function(){a(this).removeClass("l-layout-collapse-left-over");});b.leftCollapse.toggle.hover(function(){a(this).addClass("l-layout-collapse-left-toggle-over");},function(){a(this).removeClass("l-layout-collapse-left-toggle-over");});b.rightCollapse.hover(function(){a(this).addClass("l-layout-collapse-right-over");},function(){a(this).removeClass("l-layout-collapse-right-over");});b.rightCollapse.toggle.hover(function(){a(this).addClass("l-layout-collapse-right-toggle-over");},function(){a(this).removeClass("l-layout-collapse-right-toggle-over");});b.leftCollapse.toggle.click(function(){b.setLeftCollapse(false);});b.rightCollapse.toggle.click(function(){b.setRightCollapse(false);});if(b.left&&b.isLeftCollapse){b.leftCollapse.show();b.leftDropHandle&&b.leftDropHandle.hide();b.left.hide();}if(b.right&&b.isRightCollapse){b.rightCollapse.show();b.rightDropHandle&&b.rightDropHandle.hide();b.right.hide();}},_addDropHandle:function(){var b=this,c=this.options;if(b.left&&c.allowLeftResize){b.leftDropHandle=a("<div class='l-layout-drophandle-left'></div>");b.layout.append(b.leftDropHandle);b.leftDropHandle&&b.leftDropHandle.show();b.leftDropHandle.mousedown(function(d){b._start("leftresize",d);});}if(b.right&&c.allowRightResize){b.rightDropHandle=a("<div class='l-layout-drophandle-right'></div>");b.layout.append(b.rightDropHandle);b.rightDropHandle&&b.rightDropHandle.show();b.rightDropHandle.mousedown(function(d){b._start("rightresize",d);});}if(b.top&&c.allowTopResize){b.topDropHandle=a("<div class='l-layout-drophandle-top'></div>");b.layout.append(b.topDropHandle);b.topDropHandle.show();b.topDropHandle.mousedown(function(d){b._start("topresize",d);});}if(b.bottom&&c.allowBottomResize){b.bottomDropHandle=a("<div class='l-layout-drophandle-bottom'></div>");b.layout.append(b.bottomDropHandle);b.bottomDropHandle.show();b.bottomDropHandle.mousedown(function(d){b._start("bottomresize",d);});}b.draggingxline=a("<div class='l-layout-dragging-xline'></div>");b.draggingyline=a("<div class='l-layout-dragging-yline'></div>");b.layout.append(b.draggingxline).append(b.draggingyline);},_setDropHandlePosition:function(){var b=this,c=this.options;if(b.leftDropHandle){b.leftDropHandle.css({left:b.left.width()+parseInt(b.left.css("left")),height:b.middleHeight,top:b.middleTop});}if(b.rightDropHandle){b.rightDropHandle.css({left:parseInt(b.right.css("left"))-c.space,height:b.middleHeight,top:b.middleTop});}if(b.topDropHandle){b.topDropHandle.css({top:b.top.height()+parseInt(b.top.css("top")),width:b.top.width()});}if(b.bottomDropHandle){b.bottomDropHandle.css({top:parseInt(b.bottom.css("top"))-c.space,width:b.bottom.width()});}},_onResize:function(){var i=this,j=this.options;var b=i.layout.height();var e=0;var k=a(window).height();var d=null;if(typeof(j.height)=="string"&&j.height.indexOf("%")>0){var c=i.layout.parent();if(j.InWindow||c[0].tagName.toLowerCase()=="body"){d=k;d-=parseInt(a("body").css("paddingTop"));d-=parseInt(a("body").css("paddingBottom"));}else{d=c.height();}e=d*parseFloat(j.height)*0.01;if(j.InWindow||c[0].tagName.toLowerCase()=="body"){e-=(i.layout.offset().top-parseInt(a("body").css("paddingTop")));}}else{e=parseInt(j.height);}e+=j.heightDiff;i.layout.height(e);i.layoutHeight=i.layout.height();i.middleWidth=i.layout.width();i.middleHeight=i.layout.height();if(i.top){i.middleHeight-=i.top.height();i.middleHeight-=parseInt(i.top.css("borderTopWidth"));i.middleHeight-=parseInt(i.top.css("borderBottomWidth"));i.middleHeight-=j.space;}if(i.bottom){i.middleHeight-=i.bottom.height();i.middleHeight-=parseInt(i.bottom.css("borderTopWidth"));i.middleHeight-=parseInt(i.bottom.css("borderBottomWidth"));i.middleHeight-=j.space;}i.middleHeight-=2;if(i.hasBind("heightChanged")&&i.layoutHeight!=b){i.trigger("heightChanged",[{layoutHeight:i.layoutHeight,diff:i.layoutHeight-b,middleHeight:i.middleHeight}]);}if(i.center){i.centerWidth=i.middleWidth;if(i.left){if(i.isLeftCollapse){i.centerWidth-=i.leftCollapse.width();i.centerWidth-=parseInt(i.leftCollapse.css("borderLeftWidth"));i.centerWidth-=parseInt(i.leftCollapse.css("borderRightWidth"));i.centerWidth-=parseInt(i.leftCollapse.css("left"));i.centerWidth-=j.space;}else{i.centerWidth-=i.leftWidth;i.centerWidth-=parseInt(i.left.css("borderLeftWidth"));i.centerWidth-=parseInt(i.left.css("borderRightWidth"));i.centerWidth-=parseInt(i.left.css("left"));i.centerWidth-=j.space;}}if(i.right){if(i.isRightCollapse){i.centerWidth-=i.rightCollapse.width();i.centerWidth-=parseInt(i.rightCollapse.css("borderLeftWidth"));i.centerWidth-=parseInt(i.rightCollapse.css("borderRightWidth"));i.centerWidth-=parseInt(i.rightCollapse.css("right"));i.centerWidth-=j.space;}else{i.centerWidth-=i.rightWidth;i.centerWidth-=parseInt(i.right.css("borderLeftWidth"));i.centerWidth-=parseInt(i.right.css("borderRightWidth"));i.centerWidth-=j.space;}}i.centerLeft=0;if(i.left){if(i.isLeftCollapse){i.centerLeft+=i.leftCollapse.width();i.centerLeft+=parseInt(i.leftCollapse.css("borderLeftWidth"));i.centerLeft+=parseInt(i.leftCollapse.css("borderRightWidth"));i.centerLeft+=parseInt(i.leftCollapse.css("left"));i.centerLeft+=j.space;}else{i.centerLeft+=i.left.width();i.centerLeft+=parseInt(i.left.css("borderLeftWidth"));i.centerLeft+=parseInt(i.left.css("borderRightWidth"));i.centerLeft+=j.space;}}i.center.css({left:i.centerLeft});i.center.width(i.centerWidth);i.center.height(i.middleHeight);var f=i.middleHeight;if(i.center.header){f-=i.center.header.height();}i.center.content.height(f);}if(i.left){i.leftCollapse.height(i.middleHeight);i.left.height(i.middleHeight);}if(i.right){i.rightCollapse.height(i.middleHeight);i.right.height(i.middleHeight);i.rightLeft=0;if(i.left){if(i.isLeftCollapse){i.rightLeft+=i.leftCollapse.width();i.rightLeft+=parseInt(i.leftCollapse.css("borderLeftWidth"));i.rightLeft+=parseInt(i.leftCollapse.css("borderRightWidth"));i.rightLeft+=j.space;}else{i.rightLeft+=i.left.width();i.rightLeft+=parseInt(i.left.css("borderLeftWidth"));i.rightLeft+=parseInt(i.left.css("borderRightWidth"));i.rightLeft+=parseInt(i.left.css("left"));i.rightLeft+=j.space;}}if(i.center){i.rightLeft+=i.center.width();i.rightLeft+=parseInt(i.center.css("borderLeftWidth"));i.rightLeft+=parseInt(i.center.css("borderRightWidth"));i.rightLeft+=j.space;}i.right.css({left:i.rightLeft});}if(i.bottom){i.bottomTop=i.layoutHeight-i.bottom.height()-2;i.bottom.css({top:i.bottomTop});}i._setDropHandlePosition();},_start:function(f,d){var b=this,c=this.options;b.dragtype=f;if(f=="leftresize"||f=="rightresize"){b.xresize={startX:d.pageX};b.draggingyline.css({left:d.pageX-b.layout.offset().left,height:b.middleHeight,top:b.middleTop}).show();a("body").css("cursor","col-resize");}else{if(f=="topresize"||f=="bottomresize"){b.yresize={startY:d.pageY};b.draggingxline.css({top:d.pageY-b.layout.offset().top,width:b.layout.width()}).show();a("body").css("cursor","row-resize");}else{return;}}b.layout.lock.width(b.layout.width());b.layout.lock.height(b.layout.height());b.layout.lock.show();if(a.browser.msie||a.browser.safari){a("body").bind("selectstart",function(){return false;});}a(document).bind("mouseup",function(){b._stop.apply(b,arguments);});a(document).bind("mousemove",function(){b._drag.apply(b,arguments);});},_drag:function(d){var b=this,c=this.options;if(b.xresize){b.xresize.diff=d.pageX-b.xresize.startX;b.draggingyline.css({left:d.pageX-b.layout.offset().left});a("body").css("cursor","col-resize");}else{if(b.yresize){b.yresize.diff=d.pageY-b.yresize.startY;b.draggingxline.css({top:d.pageY-b.layout.offset().top});a("body").css("cursor","row-resize");}}},_stop:function(f){var b=this,d=this.options;var c;if(b.xresize&&b.xresize.diff!=undefined){c=b.xresize.diff;if(b.dragtype=="leftresize"){if(d.minLeftWidth){if(b.leftWidth+b.xresize.diff<d.minLeftWidth){return;}}b.leftWidth+=b.xresize.diff;b.left.width(b.leftWidth);if(b.center){b.center.width(b.center.width()-b.xresize.diff).css({left:parseInt(b.center.css("left"))+b.xresize.diff});}else{if(b.right){b.right.width(b.left.width()-b.xresize.diff).css({left:parseInt(b.right.css("left"))+b.xresize.diff});}}}else{if(b.dragtype=="rightresize"){if(d.minRightWidth){if(b.rightWidth-b.xresize.diff<d.minRightWidth){return;}}b.rightWidth-=b.xresize.diff;b.right.width(b.rightWidth).css({left:parseInt(b.right.css("left"))+b.xresize.diff});if(b.center){b.center.width(b.center.width()+b.xresize.diff);}else{if(b.left){b.left.width(b.left.width()+b.xresize.diff);}}}}}else{if(b.yresize&&b.yresize.diff!=undefined){c=b.yresize.diff;if(b.dragtype=="topresize"){b.top.height(b.top.height()+b.yresize.diff);b.middleTop+=b.yresize.diff;b.middleHeight-=b.yresize.diff;if(b.left){b.left.css({top:b.middleTop}).height(b.middleHeight);b.leftCollapse.css({top:b.middleTop}).height(b.middleHeight);}if(b.center){b.center.css({top:b.middleTop}).height(b.middleHeight);}if(b.right){b.right.css({top:b.middleTop}).height(b.middleHeight);b.rightCollapse.css({top:b.middleTop}).height(b.middleHeight);}}else{if(b.dragtype=="bottomresize"){b.bottom.height(b.bottom.height()-b.yresize.diff);b.middleHeight+=b.yresize.diff;b.bottomTop+=b.yresize.diff;b.bottom.css({top:b.bottomTop});if(b.left){b.left.height(b.middleHeight);b.leftCollapse.height(b.middleHeight);}if(b.center){b.center.height(b.middleHeight);}if(b.right){b.right.height(b.middleHeight);b.rightCollapse.height(b.middleHeight);}}}}}b.trigger("endResize",[{direction:b.dragtype?b.dragtype.replace(/resize/,""):"",diff:c},f]);b._setDropHandlePosition();b.draggingxline.hide();b.draggingyline.hide();b.xresize=b.yresize=b.dragtype=false;b.layout.lock.hide();if(a.browser.msie||a.browser.safari){a("body").unbind("selectstart");}a(document).unbind("mousemove",b._drag);a(document).unbind("mouseup",b._stop);a("body").css("cursor","");}});})(jQuery);