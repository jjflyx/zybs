(function(b){var a=b.ligerui;b(".l-dialog-btn").live("mouseover",function(){b(this).addClass("l-dialog-btn-over");}).live("mouseout",function(){b(this).removeClass("l-dialog-btn-over");});b(".l-dialog-tc .l-dialog-close").live("mouseover",function(){b(this).addClass("l-dialog-close-over");}).live("mouseout",function(){b(this).removeClass("l-dialog-close-over");});b.ligerDialog=function(){return a.run.call(null,"ligerDialog",arguments,{isStatic:true});};b.ligerui.DialogImagePath="../../lib/ligerUI/skins/Aqua/images/win/";function c(e){for(var d in e){b("<img />").attr("src",a.DialogImagePath+e[d]);}}b.ligerDefaults.Dialog={cls:null,id:null,buttons:null,isDrag:true,width:280,height:null,content:"",target:null,url:null,load:false,onLoaded:null,type:"none",left:null,top:null,modal:true,name:null,isResize:false,allowClose:true,opener:null,timeParmName:null,closeWhenEnter:null,isHidden:true,show:true,title:"提示",showMax:false,showToggle:false,showMin:false,slide:b.browser.msie?false:true,fixedType:null,showType:null};b.ligerDefaults.DialogString={titleMessage:"提示",ok:"确定",yes:"是",no:"否",cancel:"取消",waittingMessage:"正在等待中,请稍候..."};b.ligerMethos.Dialog=b.ligerMethos.Dialog||{};a.controls.Dialog=function(d){a.controls.Dialog.base.constructor.call(this,null,d);};a.controls.Dialog.ligerExtend(a.core.Win,{__getType:function(){return"Dialog";},__idPrev:function(){return"Dialog";},_extendMethods:function(){return b.ligerMethos.Dialog;},_render:function(){var i=this,l=this.options;i.set(l,true);var e=b('<div class="l-dialog"><table class="l-dialog-table" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="l-dialog-tl"></td><td class="l-dialog-tc"><div class="l-dialog-tc-inner"><div class="l-dialog-icon"></div><div class="l-dialog-title"></div><div class="l-dialog-winbtns"><div class="l-dialog-winbtn l-dialog-close"></div></div></div></td><td class="l-dialog-tr"></td></tr><tr><td class="l-dialog-cl"></td><td class="l-dialog-cc"><div class="l-dialog-body"><div class="l-dialog-image"></div> <div class="l-dialog-content"></div><div class="l-dialog-buttons"><div class="l-dialog-buttons-inner"></div></td><td class="l-dialog-cr"></td></tr><tr><td class="l-dialog-bl"></td><td class="l-dialog-bc"></td><td class="l-dialog-br"></td></tr></tbody></table></div>');b("body").append(e);var h=b(".l-dialog-frame");if(h.length==0){h=b('<iframe frameborder="0" class="l-dialog-frame"></iframe>');e.after(h);}i.iframe=h;i.dialog=e;i.element=e[0];i.dialog.body=b(".l-dialog-body:first",i.dialog);i.dialog.header=b(".l-dialog-tc-inner:first",i.dialog);i.dialog.winbtns=b(".l-dialog-winbtns:first",i.dialog.header);i.dialog.buttons=b(".l-dialog-buttons:first",i.dialog);i.dialog.content=b(".l-dialog-content:first",i.dialog);i.set(l,false);if(l.allowClose==false){b(".l-dialog-close",i.dialog).remove();}if(l.target||l.url||l.type=="none"){l.type=null;i.dialog.addClass("l-dialog-win");}if(l.cls){i.dialog.addClass(l.cls);}if(l.id){i.dialog.attr("id",l.id);}i.mask();if(l.isDrag){i._applyDrag();}if(l.isResize){i._applyResize();}if(l.type){i._setImage();}else{b(".l-dialog-image",i.dialog).remove();i.dialog.content.addClass("l-dialog-content-noimage");}if(!l.show){i.unmask();i.dialog.hide();}if(l.target){i.dialog.content.prepend(l.target);b(l.target).show();}else{if(l.url){if(l.timeParmName){l.url+=l.url.indexOf("?")==-1?"?":"&";l.url+=l.timeParmName+"="+new Date().getTime();}if(l.load){i.dialog.body.load(l.url,function(){i._saveStatus();i.trigger("loaded");});}else{i.jiframe=b("<iframe frameborder='0'></iframe>");var d=l.name?l.name:"ligerwindow"+new Date().getTime();i.jiframe.attr("name",d);i.jiframe.attr("id",d);i.dialog.content.prepend(i.jiframe);i.dialog.content.addClass("l-dialog-content-nopadding");setTimeout(function(){i.jiframe.attr("src",l.url);i.frame=window.frames[i.jiframe.attr("name")];},0);}}}if(l.opener){i.dialog.opener=l.opener;}if(l.buttons){b(l.buttons).each(function(m,n){var g=b('<div class="l-dialog-btn"><div class="l-dialog-btn-l"></div><div class="l-dialog-btn-r"></div><div class="l-dialog-btn-inner"></div></div>');b(".l-dialog-btn-inner",g).html(n.text);b(".l-dialog-buttons-inner",i.dialog.buttons).prepend(g);n.width&&g.width(n.width);n.onclick&&g.click(function(){n.onclick(n,i,m);});});}else{i.dialog.buttons.remove();}b(".l-dialog-buttons-inner",i.dialog.buttons).append("<div class='l-clear'></div>");b(".l-dialog-title",i.dialog).bind("selectstart",function(){return false;});i.dialog.click(function(){a.win.setFront(i);});b(".l-dialog-tc .l-dialog-close",i.dialog).click(function(){if(l.isHidden){i.hide();}else{i.close();}});if(!l.fixedType){var k=0;var j=0;var f=l.width||i.dialog.width();if(l.slide==true){l.slide="fast";}if(l.left!=null){k=l.left;}else{l.left=k=0.5*(b(window).width()-f);}if(l.top!=null){j=l.top;}else{l.top=j=0.5*(b(window).height()-i.dialog.height())+b(window).scrollTop()-10;}if(k<0){l.left=k=0;}if(j<0){l.top=j=0;}i.dialog.css({left:k,top:j});i.iframe.css({left:k,top:j,width:i.dialog.width(),height:i.dialog.height()});}i.show();b("body").bind("keydown.dialog",function(m){var g=m.which;if(g==13){i.enter();}else{if(g==27){i.esc();}}});i._updateBtnsWidth();i._saveStatus();i._onReisze();},_borderX:12,_borderY:32,doMax:function(e){var h=this,k=this.options;var f=b(window).width(),d=b(window).height(),j=0,i=0;if(a.win.taskbar){d-=a.win.taskbar.outerHeight();if(a.win.top){i+=a.win.taskbar.outerHeight();}}if(e){h.dialog.body.animate({width:f-h._borderX},k.slide);h.dialog.animate({left:j,top:i},k.slide);h.dialog.content.animate({height:d-h._borderY-h.dialog.buttons.outerHeight()},k.slide,function(){h._onReisze();});}else{h.set({width:f,height:d,left:j,top:i});h._onReisze();}},max:function(){var d=this,e=this.options;if(d.winmax){d.winmax.addClass("l-dialog-recover");d.doMax(e.slide);if(d.wintoggle){if(d.wintoggle.hasClass("l-dialog-extend")){d.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-extend-disabled");}else{d.wintoggle.addClass("l-dialog-toggle-disabled l-dialog-collapse-disabled");}}if(d.resizable){d.resizable.set({disabled:true});}if(d.draggable){d.draggable.set({disabled:true});}d.maximum=true;b(window).bind("resize.dialogmax",function(){d.doMax(false);});}},recover:function(){var d=this,e=this.options;if(d.winmax){d.winmax.removeClass("l-dialog-recover");if(e.slide){d.dialog.body.animate({width:d._width-d._borderX},e.slide);d.dialog.animate({left:d._left,top:d._top},e.slide);d.dialog.content.animate({height:d._height-d._borderY-d.dialog.buttons.outerHeight()},e.slide,function(){d._onReisze();});}else{d.set({width:d._width,height:d._height,left:d._left,top:d._top});d._onReisze();}if(d.wintoggle){d.wintoggle.removeClass("l-dialog-toggle-disabled l-dialog-extend-disabled l-dialog-collapse-disabled");}b(window).unbind("resize.dialogmax");}if(this.resizable){this.resizable.set({disabled:false});}if(d.draggable){d.draggable.set({disabled:false});}d.maximum=false;},min:function(){var e=this,f=this.options;var d=a.win.getTask(this);if(f.slide){e.dialog.body.animate({width:1},f.slide);d.y=d.offset().top+d.height();d.x=d.offset().left+d.width()/2;e.dialog.animate({left:d.x,top:d.y},f.slide,function(){e.dialog.hide();});}else{e.dialog.hide();}e.unmask();e.minimize=true;e.actived=false;},active:function(){var f=this,j=this.options;if(f.minimize){var e=f._width,d=f._height,i=f._left,h=f._top;if(f.maximum){e=b(window).width();d=b(window).height();i=h=0;if(a.win.taskbar){d-=a.win.taskbar.outerHeight();if(a.win.top){h+=a.win.taskbar.outerHeight();}}}if(j.slide){f.dialog.body.animate({width:e-f._borderX},j.slide);f.dialog.animate({left:i,top:h},j.slide);}else{f.set({width:e,height:d,left:i,top:h});}}f.actived=true;f.minimize=false;a.win.setFront(f);f.show();},toggle:function(){var d=this,e=this.options;if(!d.wintoggle){return;}if(d.wintoggle.hasClass("l-dialog-extend")){d.extend();}else{d.collapse();}},collapse:function(){var d=this,e=this.options;if(!d.wintoggle){return;}if(e.slide){d.dialog.content.animate({height:1},e.slide);}else{d.dialog.content.height(1);}if(this.resizable){this.resizable.set({disabled:true});}},extend:function(){var e=this,f=this.options;if(!e.wintoggle){return;}var d=e._height-e._borderY-e.dialog.buttons.outerHeight();if(f.slide){e.dialog.content.animate({height:d},f.slide);}else{e.dialog.content.height(d);}if(this.resizable){this.resizable.set({disabled:false});}},_updateBtnsWidth:function(){var e=this;var d=b(">div",e.dialog.winbtns).length;e.dialog.winbtns.width(22*d);},_setLeft:function(d){if(!this.dialog){return;}if(d!=null){this.dialog.css({left:d});}},_setTop:function(d){if(!this.dialog){return;}if(d!=null){this.dialog.css({top:d});}},_setWidth:function(d){if(!this.dialog){return;}if(d>=this._borderX){this.dialog.body.width(d-this._borderX);}},_setHeight:function(f){var e=this,h=this.options;if(!this.dialog){return;}if(f>=this._borderY){var d=f-this._borderY-e.dialog.buttons.outerHeight();e.dialog.content.height(d);}},_setShowMax:function(e){var d=this,f=this.options;if(e){if(!d.winmax){d.winmax=b('<div class="l-dialog-winbtn l-dialog-max"></div>').appendTo(d.dialog.winbtns).hover(function(){if(b(this).hasClass("l-dialog-recover")){b(this).addClass("l-dialog-recover-over");}else{b(this).addClass("l-dialog-max-over");}},function(){b(this).removeClass("l-dialog-max-over l-dialog-recover-over");}).click(function(){if(b(this).hasClass("l-dialog-recover")){d.recover();}else{d.max();}});}}else{if(d.winmax){d.winmax.remove();d.winmax=null;}}d._updateBtnsWidth();},_setShowMin:function(e){var d=this,f=this.options;if(e){if(!d.winmin){d.winmin=b('<div class="l-dialog-winbtn l-dialog-min"></div>').appendTo(d.dialog.winbtns).hover(function(){b(this).addClass("l-dialog-min-over");},function(){b(this).removeClass("l-dialog-min-over");}).click(function(){d.min();});a.win.addTask(d);}}else{if(d.winmin){d.winmin.remove();d.winmin=null;}}d._updateBtnsWidth();},_setShowToggle:function(e){var d=this,f=this.options;if(e){if(!d.wintoggle){d.wintoggle=b('<div class="l-dialog-winbtn l-dialog-collapse"></div>').appendTo(d.dialog.winbtns).hover(function(){if(b(this).hasClass("l-dialog-toggle-disabled")){return;}if(b(this).hasClass("l-dialog-extend")){b(this).addClass("l-dialog-extend-over");}else{b(this).addClass("l-dialog-collapse-over");}},function(){b(this).removeClass("l-dialog-extend-over l-dialog-collapse-over");}).click(function(){if(b(this).hasClass("l-dialog-toggle-disabled")){return;}if(d.wintoggle.hasClass("l-dialog-extend")){if(d.trigger("extend")==false){return;}d.wintoggle.removeClass("l-dialog-extend");d.extend();d.trigger("extended");}else{if(d.trigger("collapse")==false){return;}d.wintoggle.addClass("l-dialog-extend");d.collapse();d.trigger("collapseed");}});}}else{if(d.wintoggle){d.wintoggle.remove();d.wintoggle=null;}}},enter:function(){var e=this,f=this.options;var d;if(f.closeWhenEnter!=undefined){d=f.closeWhenEnter;}else{if(f.type=="warn"||f.type=="error"||f.type=="success"||f.type=="question"){d=true;}}if(d){e.close();}},esc:function(){},_removeDialog:function(){var d=this,e=this.options;if(e.showType&&e.fixedType){d.dialog.animate({bottom:-1*e.height},function(){d.dialog.remove();});}else{d.dialog.remove();}},close:function(){var d=this,e=this.options;a.win.removeTask(this);d.unmask();d._removeDialog();b("body").unbind("keydown.dialog");d.iframe.hide();},_getVisible:function(){return this.dialog.is(":visible");},_setUrl:function(d){var e=this,f=this.options;f.url=d;if(f.load){e.dialog.body.html("").load(f.url,function(){e.trigger("loaded");});}else{if(e.jiframe){e.jiframe.attr("src",f.url);}}},_setContent:function(d){this.dialog.content.html(d);},_setTitle:function(e){var d=this;var f=this.options;if(e){b(".l-dialog-title",d.dialog).html(e);}},_hideDialog:function(){var d=this,e=this.options;if(e.showType&&e.fixedType){d.dialog.animate({bottom:-1*e.height},function(){d.dialog.hide();});}else{d.dialog.hide();}},hidden:function(){var d=this;a.win.removeTask(d);d.dialog.hide();d.unmask();d.iframe.hide();},show:function(){var d=this,e=this.options;d.mask();if(e.fixedType){if(e.showType){d.dialog.css({bottom:-1*e.height}).addClass("l-dialog-fixed");d.dialog.show().animate({bottom:0});}else{d.dialog.show().css({bottom:0});}}else{d.dialog.show();}b.ligerui.win.setFront.ligerDefer(b.ligerui.win,100,[d]);d.iframe.show();},setUrl:function(d){this._setUrl(d);},_saveStatus:function(){var d=this;d._width=d.dialog.body.width();d._height=d.dialog.body.height();var f=0;var e=0;if(!isNaN(parseInt(d.dialog.css("top")))){f=parseInt(d.dialog.css("top"));}if(!isNaN(parseInt(d.dialog.css("left")))){e=parseInt(d.dialog.css("left"));}d._top=f;d._left=e;},_applyDrag:function(){var d=this,e=this.options;if(b.fn.ligerDrag){d.draggable=d.dialog.ligerDrag({handler:".l-dialog-title",animate:false,onStartDrag:function(){a.win.setFront(d);},onStopDrag:function(){if(e.target){var g=a.find(b.ligerui.controls.DateEditor);var f=a.find(b.ligerui.controls.ComboBox);b(b.merge(g,f)).each(function(){if(this.updateSelectBoxPosition){this.updateSelectBoxPosition();}});}d._saveStatus();d.iframe.css({left:d.dialog.css("left"),top:d.dialog.css("top")});}});}},_onReisze:function(){var h=this,i=this.options;if(i.target){var e=b(i.target).liger();if(!e){e=b(i.target).find(":first").liger();}if(!e){return;}var f=h.dialog.content.height();var d=h.dialog.content.width();e.trigger("resize",[{width:d,height:f}]);}},_applyResize:function(){var d=this,e=this.options;if(b.fn.ligerResizable){d.resizable=d.dialog.ligerResizable({onStopResize:function(i,h){var g=0;var f=0;if(!isNaN(parseInt(d.dialog.css("top")))){g=parseInt(d.dialog.css("top"));}if(!isNaN(parseInt(d.dialog.css("left")))){f=parseInt(d.dialog.css("left"));}if(i.diffLeft){d.set({left:f+i.diffLeft});}if(i.diffTop){d.set({top:g+i.diffTop});}if(i.newWidth){d.set({width:i.newWidth});d.dialog.body.css({width:i.newWidth-d._borderX});}if(i.newHeight){d.set({height:i.newHeight});}d.iframe.css({left:f+i.diffLeft,top:g+i.diffTop,width:i.newWidth,height:i.newHeight+8});d._onReisze();d._saveStatus();return false;},animate:false});}},_setImage:function(){var d=this,e=this.options;if(e.type){if(e.type=="success"||e.type=="donne"||e.type=="ok"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-donne").show();d.dialog.content.css({paddingLeft:64,paddingBottom:30});}else{if(e.type=="error"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-error").show();d.dialog.content.css({paddingLeft:64,paddingBottom:30});}else{if(e.type=="warn"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-warn").show();d.dialog.content.css({paddingLeft:64,paddingBottom:30});}else{if(e.type=="question"){b(".l-dialog-image",d.dialog).addClass("l-dialog-image-question").show();d.dialog.content.css({paddingLeft:64,paddingBottom:40});}}}}}}});a.controls.Dialog.prototype.hide=a.controls.Dialog.prototype.hidden;b.ligerDialog.open=function(d){return b.ligerDialog(d);};b.ligerDialog.close=function(){var f=a.find(a.controls.Dialog.prototype.__getType());for(var e in f){var g=f[e];g.destroy.ligerDefer(g,5);}a.win.unmask();};b.ligerDialog.show=function(f){var e=a.find(a.controls.Dialog.prototype.__getType());if(e.length){for(var d in e){e[d].show();return;}}return b.ligerDialog(f);};b.ligerDialog.hide=function(){var f=a.find(a.controls.Dialog.prototype.__getType());for(var e in f){var g=f[e];g.hide();}};b.ligerDialog.tip=function(d){d=b.extend({showType:"slide",width:240,modal:false,height:100},d||{});b.extend(d,{fixedType:"se",type:"none",isDrag:false,isResize:false,showMax:false,showToggle:false,showMin:false});return b.ligerDialog.open(d);};b.ligerDialog.alert=function(f,g,e,h){f=f||"";if(typeof(g)=="function"){h=g;e=null;}else{if(typeof(e)=="function"){h=e;}}var d=function(k,i,j){i.close();if(h){h(k,i,j);}};p={content:f,buttons:[{text:b.ligerDefaults.DialogString.ok,onclick:d}]};if(typeof(g)=="string"&&g!=""){p.title=g;}if(typeof(e)=="string"&&e!=""){p.type=e;}b.extend(p,{showMax:false,showToggle:false,showMin:false});return b.ligerDialog(p);};b.ligerDialog.confirm=function(e,f,g){if(typeof(f)=="function"){g=f;type=null;}var d=function(i,h){h.close();if(g){g(i.type=="ok");}};p={type:"question",content:e,buttons:[{text:b.ligerDefaults.DialogString.yes,onclick:d,type:"ok"},{text:b.ligerDefaults.DialogString.no,onclick:d,type:"no"}]};if(typeof(f)=="string"&&f!=""){p.title=f;}b.extend(p,{showMax:false,showToggle:false,showMin:false});return b.ligerDialog(p);};b.ligerDialog.warning=function(e,f,g){if(typeof(f)=="function"){g=f;type=null;}var d=function(i,h){h.close();if(g){g(i.type);}};p={type:"question",content:e,buttons:[{text:b.ligerDefaults.DialogString.yes,onclick:d,type:"yes"},{text:b.ligerDefaults.DialogString.no,onclick:d,type:"no"},{text:b.ligerDefaults.DialogString.cancel,onclick:d,type:"cancel"}]};if(typeof(f)=="string"&&f!=""){p.title=f;}b.extend(p,{showMax:false,showToggle:false,showMin:false});return b.ligerDialog(p);};b.ligerDialog.waitting=function(d){d=d||b.ligerDefaults.Dialog.waittingMessage;return b.ligerDialog.open({cls:"l-dialog-waittingdialog",type:"none",content:'<div style="padding:4px">'+d+"</div>",allowClose:false});};b.ligerDialog.closeWaitting=function(){var f=a.find(a.controls.Dialog);for(var e in f){var g=f[e];if(g.dialog.hasClass("l-dialog-waittingdialog")){g.close();}}};b.ligerDialog.success=function(e,f,d){return b.ligerDialog.alert(e,f,"success",d);};b.ligerDialog.error=function(e,f,d){return b.ligerDialog.alert(e,f,"error",d);};b.ligerDialog.warn=function(e,f,d){return b.ligerDialog.alert(e,f,"warn",d);};b.ligerDialog.question=function(d,e){return b.ligerDialog.alert(d,e,"question");};b.ligerDialog.prompt=function(h,e,g,i){var f=b('<input type="text" class="l-dialog-inputtext"/>');if(typeof(g)=="function"){i=g;}if(typeof(e)=="function"){i=e;}else{if(typeof(e)=="boolean"){g=e;}}if(typeof(g)=="boolean"&&g){f=b('<textarea class="l-dialog-textarea"></textarea>');}if(typeof(e)=="string"||typeof(e)=="int"){f.val(e);}var d=function(l,j,k){j.close();if(i){i(l.type=="yes",f.val());}};p={title:h,target:f,width:320,buttons:[{text:b.ligerDefaults.DialogString.ok,onclick:d,type:"yes"},{text:b.ligerDefaults.DialogString.cancel,onclick:d,type:"cancel"}]};return b.ligerDialog(p);};})(jQuery);