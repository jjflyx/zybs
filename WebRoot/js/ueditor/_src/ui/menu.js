(function(){var h=baidu.editor.utils,d=baidu.editor.dom.domUtils,b=baidu.editor.ui.uiUtils,c=baidu.editor.ui.UIBase,i=baidu.editor.ui.Popup,a=baidu.editor.ui.Stateful,e=baidu.editor.ui.Menu=function(j){this.initOptions(j);this.initMenu();};var f={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>';},postRender:function(){},queryAutoHide:function(){return true;}};e.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[];this.initPopup();this.initItems();},initItems:function(){for(var j=0;j<this.items.length;j++){var k=this.items[j];if(k=="-"){this.items[j]=this.getSeparator();}else{if(!(k instanceof g)){this.items[j]=this.createItem(k);}}}},getSeparator:function(){return f;},createItem:function(j){return new g(j);},_Popup_getContentHtmlTpl:i.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(this.items.length==0){return this._Popup_getContentHtmlTpl();}var l=[];for(var j=0;j<this.items.length;j++){var k=this.items[j];l[j]=k.renderHtml();}return('<div class="%%-body">'+l.join("")+"</div>");},_Popup_postRender:i.prototype.postRender,postRender:function(){var l=this;for(var j=0;j<this.items.length;j++){var k=this.items[j];k.ownerMenu=this;k.postRender();}d.on(this.getDom(),"mouseover",function(n){n=n||event;var m=n.relatedTarget||n.fromElement;var o=l.getDom();if(!b.contains(o,m)&&o!==m){l.fireEvent("over");}});this._Popup_postRender();},queryAutoHide:function(k){if(k){if(b.contains(this.getDom(),k)){return false;}for(var j=0;j<this.items.length;j++){var l=this.items[j];if(l.queryAutoHide(k)===false){return false;}}}},clearItems:function(){for(var j=0;j<this.items.length;j++){var k=this.items[j];clearTimeout(k._showingTimer);clearTimeout(k._closingTimer);if(k.subMenu){k.subMenu.destroy();}}this.items=[];},destroy:function(){if(this.getDom()){d.remove(this.getDom());}this.clearItems();},dispose:function(){this.destroy();}};h.inherits(e,i);var g=baidu.editor.ui.MenuItem=function(j){this.initOptions(j);this.initUIBase();this.Stateful_init();if(this.subMenu&&!(this.subMenu instanceof e)){this.subMenu=new e(this.subMenu);}};g.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:true,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);">'+'<div class="%%-body">'+this.renderLabelHtml()+"</div>"+"</div>";},postRender:function(){var j=this;this.addListener("over",function(){j.ownerMenu.fireEvent("submenuover",j);if(j.subMenu){j.delayShowSubMenu();}});if(this.subMenu){this.getDom().className+=" edui-hassubmenu";this.subMenu.render();this.addListener("out",function(){j.delayHideSubMenu();});this.subMenu.addListener("over",function(){clearTimeout(j._closingTimer);j._closingTimer=null;j.addState("opened");});this.ownerMenu.addListener("hide",function(){j.hideSubMenu();});this.ownerMenu.addListener("submenuover",function(l,k){if(k!==j){j.delayHideSubMenu();}});this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide;this.subMenu.queryAutoHide=function(k){if(k&&b.contains(j.getDom(),k)){return false;}return this._bakQueryAutoHide(k);};}this.getDom().style.tabIndex="-1";b.makeUnselectable(this.getDom());this.Stateful_postRender();},delayShowSubMenu:function(){var j=this;if(!j.isDisabled()){j.addState("opened");clearTimeout(j._showingTimer);clearTimeout(j._closingTimer);j._closingTimer=null;j._showingTimer=setTimeout(function(){j.showSubMenu();},250);}},delayHideSubMenu:function(){var j=this;if(!j.isDisabled()){j.removeState("opened");clearTimeout(j._showingTimer);if(!j._closingTimer){j._closingTimer=setTimeout(function(){if(!j.hasState("opened")){j.hideSubMenu();}j._closingTimer=null;},400);}}},renderLabelHtml:function(){return'<div class="edui-arrow"></div>'+'<div class="edui-box edui-icon"></div>'+'<div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>";},getStateDom:function(){return this.getDom();},queryAutoHide:function(j){if(this.subMenu&&this.hasState("opened")){return this.subMenu.queryAutoHide(j);}},_onClick:function(j,k){if(this.hasState("disabled")){return;}if(this.fireEvent("click",j,k)!==false){if(this.subMenu){this.showSubMenu();}else{i.postHide();}}},showSubMenu:function(){var j=b.getClientRect(this.getDom());j.right-=5;j.left+=2;j.width-=7;j.top-=4;j.bottom+=4;j.height+=8;this.subMenu.showAnchorRect(j,true,true);},hideSubMenu:function(){this.subMenu.hide();}};h.inherits(g,c);h.extend(g.prototype,a,true);})();