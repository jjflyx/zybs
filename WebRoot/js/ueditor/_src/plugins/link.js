(function(){function a(d){var e=d.startContainer,c=d.endContainer;if(e=domUtils.findParentByTagName(e,"a",true)){d.setStartBefore(e);}if(c=domUtils.findParentByTagName(c,"a",true)){d.setEndAfter(c);}}UE.commands["unlink"]={execCommand:function(){var c,d=new dom.Range(this.document),k=this.currentSelectedArr,h;if(k&&k.length>0){for(var f=0,g;g=k[f++];){c=domUtils.getElementsByTagName(g,"a");for(var e=0,l;l=c[e++];){domUtils.remove(l,true);}}if(domUtils.isEmptyNode(k[0])){d.setStart(k[0],0).setCursor();}else{d.selectNodeContents(k[0]).select();}}else{d=this.selection.getRange();if(d.collapsed&&!domUtils.findParentByTagName(d.startContainer,"a",true)){return;}h=d.createBookmark();a(d);d.removeInlineStyle("a").moveToBookmark(h).select();}},queryCommandState:function(){return !this.highlight&&this.queryCommandValue("link")?0:-1;}};function b(d,e){a(d=d.adjustmentBoundary());var g=d.startContainer;if(g.nodeType==1){g=g.childNodes[d.startOffset];if(g&&g.nodeType==1&&g.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(g[browser.ie?"innerText":"textContent"])){g[browser.ie?"innerText":"textContent"]=utils.html(e.textValue||e.href);}}d.removeInlineStyle("a");if(d.collapsed){var c=d.document.createElement("a"),f="";if(e.textValue){f=utils.html(e.textValue);delete e.textValue;}else{f=utils.html(e.href);}domUtils.setAttributes(c,e);d.insertNode(c);c[browser.ie?"innerText":"textContent"]=f;d.selectNode(c);}else{d.applyInlineStyle("a",e);}}UE.commands["link"]={queryCommandState:function(){return this.highlight?-1:0;},execCommand:function(d,f){var c=new dom.Range(this.document),h=this.currentSelectedArr;f.data_ue_src&&(f.data_ue_src=utils.unhtml(f.data_ue_src,/[<">]/g));f.href&&(f.href=utils.unhtml(f.href,/[<">]/g));f.textValue&&(f.textValue=utils.unhtml(f.textValue,/[<">]/g));if(h&&h.length){for(var e=0,g;g=h[e++];){if(domUtils.isEmptyNode(g)){g[browser.ie?"innerText":"textContent"]=utils.html(f.textValue||f.href);}b(c.selectNodeContents(g),f);}c.selectNodeContents(h[0]).select();}else{b(c=this.selection.getRange(),f);c.collapse().select(true);}},queryCommandValue:function(){var l=new dom.Range(this.document),j=this.currentSelectedArr,g,f;if(j&&j.length){for(var k=0,d;d=j[k++];){g=d.getElementsByTagName("a");if(g[0]){return g[0];}}}else{l=this.selection.getRange();if(l.collapsed){f=this.selection.getStart();if(f&&(f=domUtils.findParentByTagName(f,"a",true))){return f;}}else{l.shrinkBoundary();var e=l.startContainer.nodeType==3||!l.startContainer.childNodes[l.startOffset]?l.startContainer:l.startContainer.childNodes[l.startOffset],h=l.endContainer.nodeType==3||l.endOffset==0?l.endContainer:l.endContainer.childNodes[l.endOffset-1],m=l.getCommonAncestor();f=domUtils.findParentByTagName(m,"a",true);if(!f&&m.nodeType==1){var g=m.getElementsByTagName("a"),c,n;for(var k=0,o;o=g[k++];){c=domUtils.getPosition(o,e),n=domUtils.getPosition(o,h);if((c&domUtils.POSITION_FOLLOWING||c&domUtils.POSITION_CONTAINS)&&(n&domUtils.POSITION_PRECEDING||n&domUtils.POSITION_CONTAINS)){f=o;break;}}}return f;}}}};})();