UE.plugins["formatmatch"]=function(){var c=this,d=[],b,a=0;c.addListener("reset",function(){d=[];a=0;});function e(m,o){if(browser.webkit){var l=o.target.tagName=="IMG"?o.target:null;}function f(i){if(p&&(!c.currentSelectedArr||!c.currentSelectedArr.length)){i.selectNode(p);}return i.applyInlineStyle(d[d.length-1].tagName,null,d);}c.undoManger&&c.undoManger.save();var k=c.selection.getRange(),n=l||k.getClosedNode();if(b&&n&&n.tagName=="IMG"){n.style.cssText+=";float:"+(b.style.cssFloat||b.style.styleFloat||"none")+";display:"+(b.style.display||"inline");b=null;}else{if(!b){var h=k.collapsed;if(h){var p=c.document.createTextNode("match");k.insertNode(p).select();}c.__hasEnterExecCommand=true;var g=c.options.removeFormatAttributes;c.options.removeFormatAttributes="";c.execCommand("removeformat");c.options.removeFormatAttributes=g;c.__hasEnterExecCommand=false;k=c.selection.getRange();if(d.length==0){if(c.currentSelectedArr&&c.currentSelectedArr.length>0){k.selectNodeContents(c.currentSelectedArr[0]).select();}}else{if(c.currentSelectedArr&&c.currentSelectedArr.length>0){for(var j=0,q;q=c.currentSelectedArr[j++];){k.selectNodeContents(q);f(k);}k.selectNodeContents(c.currentSelectedArr[0]).select();}else{f(k);}}if(!c.currentSelectedArr||!c.currentSelectedArr.length){if(p){k.setStartBefore(p).collapse(true);}k.select();}p&&domUtils.remove(p);}}c.undoManger&&c.undoManger.save();c.removeListener("mouseup",e);a=0;}c.commands["formatmatch"]={execCommand:function(g){if(a){a=0;d=[];c.removeListener("mouseup",e);return;}var f=c.selection.getRange();b=f.getClosedNode();if(!b||b.tagName!="IMG"){f.collapse(true).shrinkBoundary();var k=f.startContainer;d=domUtils.findParents(k,true,function(i){return !domUtils.isBlockElm(i)&&i.nodeType==1;});for(var j=0,h;h=d[j];j++){if(h.tagName=="A"){d.splice(j,1);break;}}}c.addListener("mouseup",e);a=1;},queryCommandState:function(){if(this.highlight){return -1;}return a;},notNeedUndo:1};};