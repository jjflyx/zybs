(function(){var c=domUtils.isBlockElm,b=function(d){return utils.findNode(d.selection.getStartElementPath(),null,function(e){return e.getAttribute("dir");});},a=function(h,i,g){var l,o=function(p){return p.nodeType==1?!domUtils.isBookmarkNode(p):!domUtils.isWhitespace(p);},f=b(i);if(f&&h.collapsed){f.setAttribute("dir",g);return h;}l=h.createBookmark();h.enlarge(true);var q=h.createBookmark(),k=domUtils.getNextDomNode(q.start,false,o),m=h.cloneRange(),e;while(k&&!(domUtils.getPosition(k,q.end)&domUtils.POSITION_FOLLOWING)){if(k.nodeType==3||!c(k)){m.setStartBefore(k);while(k&&k!==q.end&&!c(k)){e=k;k=domUtils.getNextDomNode(k,false,null,function(p){return !c(p);});}m.setEndAfter(e);var j=m.getCommonAncestor();if(!domUtils.isBody(j)&&c(j)){j.setAttribute("dir",g);k=j;}else{var d=h.document.createElement("p");d.setAttribute("dir",g);var n=m.extractContents();d.appendChild(n);m.insertNode(d);k=d;}k=domUtils.getNextDomNode(k,false,o);}else{k=domUtils.getNextDomNode(k,true,o);}}return h.moveToBookmark(q).moveToBookmark(l);};UE.commands["directionality"]={execCommand:function(g,f){var e=new dom.Range(this.document);if(this.currentSelectedArr&&this.currentSelectedArr.length>0){for(var h=0,j;j=this.currentSelectedArr[h++];){if(j.style.display!="none"){a(e.selectNode(j),this,f);}}e.selectNode(this.currentSelectedArr[0]).select();}else{e=this.selection.getRange();if(e.collapsed){var d=this.document.createTextNode("d");e.insertNode(d);}a(e,this,f);if(d){e.setStartBefore(d).collapse(true);domUtils.remove(d);}e.select();}return true;},queryCommandValue:function(){var d=b(this);return d?d.getAttribute("dir"):"ltr";},queryCommandState:function(){return this.highlight?-1:0;}};})();