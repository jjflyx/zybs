UE.plugins["enterkey"]=function(){var b,c=this,a=c.options.enterTag;c.addListener("keyup",function(l,m){var n=m.keyCode||m.which;if(n==13){var k=c.selection.getRange(),g=k.startContainer,d;if(!browser.ie){if(/h\d/i.test(b)){if(browser.gecko){var j=domUtils.findParentByTagName(g,["h1","h2","h3","h4","h5","h6","blockquote"],true);if(!j){c.document.execCommand("formatBlock",false,"<p>");d=1;}}else{if(g.nodeType==1){var i=c.document.createTextNode(""),e;k.insertNode(i);e=domUtils.findParentByTagName(i,"div",true);if(e){var f=c.document.createElement("p");while(e.firstChild){f.appendChild(e.firstChild);}e.parentNode.insertBefore(f,e);domUtils.remove(e);k.setStartBefore(i).setCursor();d=1;}domUtils.remove(i);}}if(c.undoManger&&d){c.undoManger.save();}}browser.opera&&k.select();}setTimeout(function(){c.selection.getRange().scrollToView(c.autoHeightEnabled,c.autoHeightEnabled?domUtils.getXY(c.iframe).y:0);},50);}});c.addListener("keydown",function(i,k){var m=k.keyCode||k.which;if(m==13){if(c.undoManger){c.undoManger.save();}b="";var f=c.selection.getRange();if(!f.collapsed){var d=f.startContainer,e=f.endContainer,g=domUtils.findParentByTagName(d,"td",true),h=domUtils.findParentByTagName(e,"td",true);if(g&&h&&g!==h||!g&&h||g&&!h){k.preventDefault?k.preventDefault():(k.returnValue=false);return;}}c.currentSelectedArr&&domUtils.clearSelectedArr(c.currentSelectedArr);if(a=="p"){if(!browser.ie){d=domUtils.findParentByTagName(f.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote"],true);if(!d&&!browser.opera){c.document.execCommand("formatBlock",false,"<p>");if(browser.gecko){f=c.selection.getRange();d=domUtils.findParentByTagName(f.startContainer,"p",true);d&&domUtils.removeDirtyAttr(d);}}else{b=d.tagName;d.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(d);}}}else{k.preventDefault?k.preventDefault():(k.returnValue=false);if(!f.collapsed){f.deleteContents();d=f.startContainer;if(d.nodeType==1&&(d=d.childNodes[f.startOffset])){while(d.nodeType==1){if(dtd.$empty[d.tagName]){f.setStartBefore(d).setCursor();if(c.undoManger){c.undoManger.save();}return false;}if(!d.firstChild){var l=f.document.createElement("br");d.appendChild(l);f.setStart(d,0).setCursor();if(c.undoManger){c.undoManger.save();}return false;}d=d.firstChild;}if(d===f.startContainer.childNodes[f.startOffset]){l=f.document.createElement("br");f.insertNode(l).setCursor();}else{f.setStart(d,0).setCursor();}}else{l=f.document.createElement("br");f.insertNode(l).setStartAfter(l).setCursor();}}else{l=f.document.createElement("br");f.insertNode(l);var j=l.parentNode;if(j.lastChild===l){l.parentNode.insertBefore(l.cloneNode(true),l);f.setStartBefore(l);}else{f.setStartAfter(l);}f.setCursor();}}}});};