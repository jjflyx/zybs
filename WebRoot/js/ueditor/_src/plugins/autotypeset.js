UE.plugins["autotypeset"]=function(){this.setOpt({"autotypeset":{mergeEmptyline:true,removeClass:true,removeEmptyline:false,textAlign:"left",imageBlockLine:"center",pasteFilter:false,clearFontSize:false,clearFontFamily:false,removeEmptyNode:false,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:false,indentValue:"2em"}});var h=this,a=h.options.autotypeset,b={"selectTdClass":1,"pagebreak":1,"anchorclass":1},c={"li":1},i={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1},e;if(!a){return;}function d(k,j){if(k&&k.parentNode&&i[k.tagName.toLowerCase()]){if(e&&e.contains(k)||k.getAttribute("pagebreak")){return 0;}return j?!domUtils.isEmptyBlock(k):domUtils.isEmptyBlock(k);}}function f(j){if(!j.style.cssText){domUtils.removeAttributes(j,["style"]);if(j.tagName.toLowerCase()=="span"&&domUtils.hasNoAttributes(j)){domUtils.remove(j,true);}}}function g(s,q){var v;if(q){if(!a.pasteFilter){return;}v=h.document.createElement("div");v.innerHTML=q.html;}else{v=h.document.body;}var j=domUtils.getElementsByTagName(v,"*");for(var n=0,u;u=j[n++];){if(!e&&u.tagName=="DIV"&&u.getAttribute("highlighter")){e=u;}if(a.clearFontSize&&u.style.fontSize){u.style.fontSize="";f(u);}if(a.clearFontFamily&&u.style.fontFamily){u.style.fontFamily="";f(u);}if(d(u)){if(a.mergeEmptyline){var p=u.nextSibling,k;while(d(p)){k=p;p=k.nextSibling;domUtils.remove(k);}}if(a.removeEmptyline&&domUtils.inDoc(u,v)&&!c[u.parentNode.tagName.toLowerCase()]){domUtils.remove(u);continue;}}if(d(u,true)){if(a.indent){u.style.textIndent=a.indentValue;}if(a.textAlign){u.style.textAlign=a.textAlign;}}if(a.removeClass&&u.className&&!b[u.className.toLowerCase()]){if(e&&e.contains(u)){continue;}domUtils.removeAttributes(u,["class"]);}if(a.imageBlockLine&&u.tagName.toLowerCase()=="img"&&!u.getAttribute("emotion")){if(q){var m=u;switch(a.imageBlockLine){case"left":case"right":case"none":var r=m.parentNode,k,l,p;while(dtd.$inline[r.tagName]||r.tagName=="A"){r=r.parentNode;}k=r;if(k.tagName=="P"&&domUtils.getStyle(k,"text-align")=="center"){if(!domUtils.isBody(k)&&domUtils.getChildCount(k,function(w){return !domUtils.isBr(w)&&!domUtils.isWhitespace(w);})==1){l=k.previousSibling;p=k.nextSibling;if(l&&p&&l.nodeType==1&&p.nodeType==1&&l.tagName==p.tagName&&domUtils.isBlockElm(l)){l.appendChild(k.firstChild);while(p.firstChild){l.appendChild(p.firstChild);}domUtils.remove(k);domUtils.remove(p);}else{domUtils.setStyle(k,"text-align","");}}}domUtils.setStyle(m,"float",a.imageBlockLine);break;case"center":if(h.queryCommandValue("imagefloat")!="center"){r=m.parentNode;domUtils.setStyle(m,"float","none");k=m;while(r&&domUtils.getChildCount(r,function(w){return !domUtils.isBr(w)&&!domUtils.isWhitespace(w);})==1&&(dtd.$inline[r.tagName]||r.tagName=="A")){k=r;r=r.parentNode;}var t=h.document.createElement("p");domUtils.setAttributes(t,{style:"text-align:center"});k.parentNode.insertBefore(t,k);t.appendChild(k);domUtils.setStyle(k,"float","");}}}else{var o=h.selection.getRange();o.selectNode(u).select();h.execCommand("imagefloat",a.imageBlockLine);}}if(a.removeEmptyNode){if(a.removeTagNames[u.tagName.toLowerCase()]&&domUtils.hasNoAttributes(u)&&domUtils.isEmptyBlock(u)){domUtils.remove(u);}}}if(q){q.html=v.innerHTML;}}if(a.pasteFilter){h.addListener("beforepaste",g);}h.commands["autotypeset"]={execCommand:function(){h.removeListener("beforepaste",g);if(a.pasteFilter){h.addListener("beforepaste",g);}g();}};};