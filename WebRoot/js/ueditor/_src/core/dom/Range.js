(function(){var g=0,h=domUtils.fillChar,c;function b(j){j.collapsed=j.startContainer&&j.endContainer&&j.startContainer===j.endContainer&&j.startOffset==j.endOffset;}function a(k,l,m,j){if(l.nodeType==1&&(dtd.$empty[l.tagName]||dtd.$nonChild[l.tagName])){m=domUtils.getNodeIndex(l)+(k?0:1);l=l.parentNode;}if(k){j.startContainer=l;j.startOffset=m;if(!j.endContainer){j.collapse(true);}}else{j.endContainer=l;j.endOffset=m;if(!j.startContainer){j.collapse(false);}}b(j);return j;}function i(q,u){var o=q.startContainer,n=q.endContainer,w=q.startOffset,p=q.endOffset,C=q.document,k=C.createDocumentFragment(),r,t;if(o.nodeType==1){o=o.childNodes[w]||(r=o.appendChild(C.createTextNode("")));}if(n.nodeType==1){n=n.childNodes[p]||(t=n.appendChild(C.createTextNode("")));}if(o===n&&o.nodeType==3){k.appendChild(C.createTextNode(o.substringData(w,p-w)));if(u){o.deleteData(w,p-w);q.collapse(true);}return k;}var s,y,A=k,z=domUtils.findParents(o,true),l=domUtils.findParents(n,true);for(var x=0;z[x]==l[x];){x++;}for(var v=x,B;B=z[v];v++){s=B.nextSibling;if(B==o){if(!r){if(q.startContainer.nodeType==3){A.appendChild(C.createTextNode(o.nodeValue.slice(w)));if(u){o.deleteData(w,o.nodeValue.length-w);}}else{A.appendChild(!u?o.cloneNode(true):o);}}}else{y=B.cloneNode(false);A.appendChild(y);}while(s){if(s===n||s===l[v]){break;}B=s.nextSibling;A.appendChild(!u?s.cloneNode(true):s);s=B;}A=y;}A=k;if(!z[x]){A.appendChild(z[x-1].cloneNode(false));A=A.firstChild;}for(var v=x,m;m=l[v];v++){s=m.previousSibling;if(m==n){if(!t&&q.endContainer.nodeType==3){A.appendChild(C.createTextNode(n.substringData(0,p)));if(u){n.deleteData(0,p);}}}else{y=m.cloneNode(false);A.appendChild(y);}if(v!=x||!z[x]){while(s){if(s===o){break;}m=s.previousSibling;A.insertBefore(!u?s.cloneNode(true):s,A.firstChild);s=m;}}A=y;}if(u){q.setStartBefore(!l[x]?l[x-1]:!z[x]?z[x-1]:l[x]).collapse(true);}r&&domUtils.remove(r);t&&domUtils.remove(t);return k;}var d=dom.Range=function(j){var k=this;k.startContainer=k.startOffset=k.endContainer=k.endOffset=null;k.document=j;k.collapsed=true;};function f(m,j){try{if(c&&domUtils.inDoc(c,m)){if(!c.nodeValue.replace(fillCharReg,"").length){var k=c.parentNode;domUtils.remove(c);while(k&&domUtils.isEmptyInlineElement(k)&&!k.contains(j)){c=k.parentNode;domUtils.remove(k);k=c;}}else{c.nodeValue=c.nodeValue.replace(fillCharReg,"");}}}catch(l){}}function e(l,j){var k;l=l[j];while(l&&domUtils.isFillChar(l)){k=l[j];domUtils.remove(l);l=k;}}d.prototype={cloneContents:function(){return this.collapsed?null:i(this,0);},deleteContents:function(){var j;if(!this.collapsed){i(this,1);}if(browser.webkit){j=this.startContainer;if(j.nodeType==3&&!j.nodeValue.length){this.setStartBefore(j).collapse(true);domUtils.remove(j);}}return this;},extractContents:function(){return this.collapsed?null:i(this,2);},setStart:function(j,k){return a(true,j,k,this);},setEnd:function(j,k){return a(false,j,k,this);},setStartAfter:function(j){return this.setStart(j.parentNode,domUtils.getNodeIndex(j)+1);},setStartBefore:function(j){return this.setStart(j.parentNode,domUtils.getNodeIndex(j));},setEndAfter:function(j){return this.setEnd(j.parentNode,domUtils.getNodeIndex(j)+1);},setStartAtFirst:function(j){return this.setStart(j,0);},setStartAtLast:function(j){return this.setStart(j,j.nodeType==3?j.nodeValue.length:j.childNodes.length);},setEndAtFirst:function(j){return this.setEnd(j,0);},setEndAtLast:function(j){return this.setEnd(j,j.nodeType==3?j.nodeValue.length:j.childNodes.length);},setEndBefore:function(j){return this.setEnd(j.parentNode,domUtils.getNodeIndex(j));},selectNode:function(j){return this.setStartBefore(j).setEndAfter(j);},selectNodeContents:function(j){return this.setStart(j,0).setEnd(j,j.nodeType==3?j.nodeValue.length:j.childNodes.length);},cloneRange:function(){var k=this,j=new d(k.document);return j.setStart(k.startContainer,k.startOffset).setEnd(k.endContainer,k.endOffset);},collapse:function(j){var k=this;if(j){k.endContainer=k.startContainer;k.endOffset=k.startOffset;}else{k.startContainer=k.endContainer;k.startOffset=k.endOffset;}k.collapsed=true;return k;},shrinkBoundary:function(k){var j=this,m,l=j.collapsed;while(j.startContainer.nodeType==1&&(m=j.startContainer.childNodes[j.startOffset])&&m.nodeType==1&&!domUtils.isBookmarkNode(m)&&!dtd.$empty[m.tagName]&&!dtd.$nonChild[m.tagName]){j.setStart(m,0);}if(l){return j.collapse(true);}if(!k){while(j.endContainer.nodeType==1&&j.endOffset>0&&(m=j.endContainer.childNodes[j.endOffset-1])&&m.nodeType==1&&!domUtils.isBookmarkNode(m)&&!dtd.$empty[m.tagName]&&!dtd.$nonChild[m.tagName]){j.setEnd(m,m.childNodes.length);}}return j;},getCommonAncestor:function(k,l){var m=this.startContainer,j=this.endContainer;if(m===j){if(k&&m.nodeType==1&&this.startOffset==this.endOffset-1){return m.childNodes[this.startOffset];}return l&&m.nodeType==3?m.parentNode:m;}return domUtils.getCommonAncestor(m,j);},trimBoundary:function(k){this.txtToElmBoundary();var o=this.startContainer,n=this.startOffset,m=this.collapsed,j=this.endContainer;if(o.nodeType==3){if(n==0){this.setStartBefore(o);}else{if(n>=o.nodeValue.length){this.setStartAfter(o);}else{var l=domUtils.split(o,n);if(o===j){this.setEnd(l,this.endOffset-n);}else{if(o.parentNode===j){this.endOffset+=1;}}this.setStartBefore(l);}}if(m){return this.collapse(true);}}if(!k){n=this.endOffset;j=this.endContainer;if(j.nodeType==3){if(n==0){this.setEndBefore(j);}else{if(n>=j.nodeValue.length){this.setEndAfter(j);}else{domUtils.split(j,n);this.setEndAfter(j);}}}}return this;},txtToElmBoundary:function(){function j(l,n){var k=l[n+"Container"],m=l[n+"Offset"];if(k.nodeType==3){if(!m){l["set"+n.replace(/(\w)/,function(o){return o.toUpperCase();})+"Before"](k);}else{if(m>=k.nodeValue.length){l["set"+n.replace(/(\w)/,function(o){return o.toUpperCase();})+"After"](k);}}}}if(!this.collapsed){j(this,"start");j(this,"end");}return this;},insertNode:function(l){var n=l,k=1;if(l.nodeType==11){n=l.firstChild;k=l.childNodes.length;}this.trimBoundary(true);var o=this.startContainer,m=this.startOffset;var j=o.childNodes[m];if(j){o.insertBefore(l,j);}else{o.appendChild(l);}if(n.parentNode===this.endContainer){this.endOffset=this.endOffset+k;}return this.setStartBefore(n);},setCursor:function(k,j){return this.collapse(!k).select(j);},createBookmark:function(l,m){var j,k=this.document.createElement("span");k.style.cssText="display:none;line-height:0px;";k.appendChild(this.document.createTextNode("\uFEFF"));k.id="_baidu_bookmark_start_"+(m?"":g++);if(!this.collapsed){j=k.cloneNode(true);j.id="_baidu_bookmark_end_"+(m?"":g++);}this.insertNode(k);if(j){this.collapse(false).insertNode(j);this.setEndBefore(j);}this.setStartAfter(k);return{start:l?k.id:k,end:j?l?j.id:j:null,id:l};},moveToBookmark:function(k){var l=k.id?this.document.getElementById(k.start):k.start,j=k.end&&k.id?this.document.getElementById(k.end):k.end;this.setStartBefore(l);domUtils.remove(l);if(j){this.setEndBefore(j);domUtils.remove(j);}else{this.collapse(true);}return this;},enlarge:function(k,n){var j=domUtils.isBody,o,m,l=this.document.createTextNode("");if(k){m=this.startContainer;if(m.nodeType==1){if(m.childNodes[this.startOffset]){o=m=m.childNodes[this.startOffset];}else{m.appendChild(l);o=m=l;}}else{o=m;}while(1){if(domUtils.isBlockElm(m)){m=o;while((o=m.previousSibling)&&!domUtils.isBlockElm(o)){m=o;}this.setStartBefore(m);break;}o=m;m=m.parentNode;}m=this.endContainer;if(m.nodeType==1){if(o=m.childNodes[this.endOffset]){m.insertBefore(l,o);}else{m.appendChild(l);}o=m=l;}else{o=m;}while(1){if(domUtils.isBlockElm(m)){m=o;while((o=m.nextSibling)&&!domUtils.isBlockElm(o)){m=o;}this.setEndAfter(m);break;}o=m;m=m.parentNode;}if(l.parentNode===this.endContainer){this.endOffset--;}domUtils.remove(l);}if(!this.collapsed){while(this.startOffset==0){if(n&&n(this.startContainer)){break;}if(j(this.startContainer)){break;}this.setStartBefore(this.startContainer);}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(n&&n(this.endContainer)){break;}if(j(this.endContainer)){break;}this.setEndAfter(this.endContainer);}}return this;},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer);}while(!domUtils.isBody(this.endContainer)&&!this.endOffset){this.setEndBefore(this.endContainer);}}return this;},applyInlineStyle:function(l,w,s){if(this.collapsed){return this;}this.trimBoundary().enlarge(false,function(A){return A.nodeType==1&&domUtils.isBlockElm(A);}).adjustmentBoundary();var t=this.createBookmark(),o=t.end,y=function(A){return A.nodeType==1?A.tagName.toLowerCase()!="br":!domUtils.isWhitespace(A);},r=domUtils.getNextDomNode(t.start,false,y),m,n,q=this.cloneRange();while(r&&(domUtils.getPosition(r,o)&domUtils.POSITION_PRECEDING)){if(r.nodeType==3||dtd[l][r.tagName]){q.setStartBefore(r);m=r;while(m&&(m.nodeType==3||dtd[l][m.tagName])&&m!==o){n=m;m=domUtils.getNextDomNode(m,m.nodeType==1,null,function(A){return dtd[l][A.tagName];});}var x=q.setEndAfter(n).extractContents(),u;if(s&&s.length>0){var j,v;v=j=s[0].cloneNode(false);for(var p=1,z;z=s[p++];){j.appendChild(z.cloneNode(false));j=j.firstChild;}u=j;}else{u=q.document.createElement(l);}if(w){domUtils.setAttributes(u,w);}u.appendChild(x);q.insertNode(s?v:u);var k;if(l=="span"&&w.style&&/text\-decoration/.test(w.style)&&(k=domUtils.findParentByTagName(u,"a",true))){domUtils.setAttributes(k,w);domUtils.remove(u,true);u=k;}else{domUtils.mergSibling(u);domUtils.clearEmptySibling(u);}domUtils.mergChild(u,l,w);r=domUtils.getNextDomNode(u,false,y);domUtils.mergToParent(u);if(m===o){break;}}else{r=domUtils.getNextDomNode(r,true,y);}}return this.moveToBookmark(t);},removeInlineStyle:function(k){if(this.collapsed){return this;}k=utils.isArray(k)?k:[k];this.shrinkBoundary().adjustmentBoundary();var q=this.startContainer,j=this.endContainer;while(1){if(q.nodeType==1){if(utils.indexOf(k,q.tagName.toLowerCase())>-1){break;}if(q.tagName.toLowerCase()=="body"){q=null;break;}}q=q.parentNode;}while(1){if(j.nodeType==1){if(utils.indexOf(k,j.tagName.toLowerCase())>-1){break;}if(j.tagName.toLowerCase()=="body"){j=null;break;}}j=j.parentNode;}var m=this.createBookmark(),p,o;if(q){o=this.cloneRange().setEndBefore(m.start).setStartBefore(q);p=o.extractContents();o.insertNode(p);domUtils.clearEmptySibling(q,true);q.parentNode.insertBefore(m.start,q);}if(j){o=this.cloneRange().setStartAfter(m.end).setEndAfter(j);p=o.extractContents();o.insertNode(p);domUtils.clearEmptySibling(j,false,true);j.parentNode.insertBefore(m.end,j.nextSibling);}var n=domUtils.getNextDomNode(m.start,false,function(r){return r.nodeType==1;}),l;while(n&&n!==m.end){l=domUtils.getNextDomNode(n,true,function(r){return r.nodeType==1;});if(utils.indexOf(k,n.tagName.toLowerCase())>-1){domUtils.remove(n,true);}n=l;}return this.moveToBookmark(m);},getClosedNode:function(){var k;if(!this.collapsed){var j=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(j.startContainer.nodeType==1&&j.startContainer===j.endContainer&&j.endOffset-j.startOffset==1){var l=j.startContainer.childNodes[j.startOffset];if(l&&l.nodeType==1&&(dtd.$empty[l.tagName]||dtd.$nonChild[l.tagName])){k=l;}}}return k;},select:browser.ie?function(j,t){var p;if(!this.collapsed){this.shrinkBoundary();}var l=this.getClosedNode();if(l&&!t){try{p=this.document.body.createControlRange();p.addElement(l);p.select();}catch(q){}return this;}var r=this.createBookmark(),k=r.start,m;p=this.document.body.createTextRange();p.moveToElementText(k);p.moveStart("character",1);if(!this.collapsed){var o=this.document.body.createTextRange();m=r.end;o.moveToElementText(m);p.setEndPoint("EndToEnd",o);}else{if(!j&&this.startContainer.nodeType!=3){var s=this.document.createTextNode(h),n=this.document.createElement("span");n.appendChild(this.document.createTextNode(h));k.parentNode.insertBefore(n,k);k.parentNode.insertBefore(s,k);f(this.document,s);c=s;e(n,"previousSibling");e(k,"nextSibling");p.moveStart("character",-1);p.collapse(true);}}this.moveToBookmark(r);n&&domUtils.remove(n);try{p.select();}catch(q){}return this;}:function(j){var o=domUtils.getWindow(this.document),n=o.getSelection(),m;browser.gecko?this.document.body.focus():o.focus();if(n){n.removeAllRanges();if(this.collapsed){if(j&&browser.opera&&!domUtils.isBody(this.startContainer)&&this.startContainer.nodeType==1){var k=this.document.createTextNode("");this.insertNode(k).setStart(k,0).collapse(true);}if(!j){m=this.document.createTextNode(h);this.insertNode(m);f(this.document,m);e(m,"previousSibling");e(m,"nextSibling");c=m;this.setStart(m,browser.webkit?1:0).collapse(true);}}var l=this.document.createRange();l.setStart(this.startContainer,this.startOffset);l.setEnd(this.endContainer,this.endOffset);n.addRange(l);}return this;},scrollToView:function(l,m){l=l?window:domUtils.getWindow(this.document);var j=this.document.createElement("span");j.innerHTML="&nbsp;";var k=this.cloneRange();k.insertNode(j);domUtils.scrollToView(j,l,m);domUtils.remove(j);return this;}};})();