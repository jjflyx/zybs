<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>$!app_name</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<!-- 框架 -->
<link rel="stylesheet" type="text/css"
	href="${base}/include/css/default.css" />
<script type='text/javascript'>
	var CONTEXTPATH = '${base}';
	var stylePath = '$!stylename';
</script>
<script src="${base}/include/js/main.js"></script>
<script src="${base}/include/js/string.js"></script>
<!-- 分页  注意顺序 -->
<link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet"
	type="text/css" />
<script src="${base}/include/js/jquery.easyui.min.js"></script>
<!-- 树 -->
<script type="text/javascript"
	src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
<link rel="stylesheet"
	href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css"
	type="text/css">
<script type="text/javascript"
	src="${base}/include/controls/my97/WdatePicker.js"></script>
<style type="text/css">
</style>
<SCRIPT type="text/javascript">
<!--
	var setting = {
		async : {
			enable : true,
			url : "${base}/private/sys/user/tree",
			autoParam : [ "id" ]
		},
		view : {
			nameIsHTML : true
		}
	};
	function initTree() {
		var myTree = jQuery.fn.zTree.init(jQuery("#treeDemo"), setting);
	}
	var iWidth = 1000; //弹出窗口的宽度;
	var iHeight = parent.document.body.clientHeight; //弹出窗口的高度; 
	iWidth = 800;
	//转到新增页面
	function add() {
		var iHeight = 340;
		var iWidth = 800;
		var title = '新增订单';
		var url = '${base}/private/order/toAdd?sys_random=' + Math.random();
		openWin3(url, title, iWidth, iHeight);
	}

	function addSave() {
		if ($DW.Verify.hasError()) {
			return;
		}
		jQuery.ajax({
			url : "${base}/private/ddgl/addsave",
			data : $DW.$("#form1").serialize(),
			success : function(res) {
				if (res == "true") {
					Dialog.alert("操作成功！", function() {
						$D.close();
						loadData();
					});
				} else {
					alert("操作失败！");
					submit = false;
				}
				return false;
			},
			error : function(res) {
				alert("系统错误?!");
			}
		});

	}

	function toupdate() {
		var arr = $('#dg1').datagrid('getSelected');
		if (!arr || arr.length == 0) {
			Dialog.alert("请先选择要编辑的用户！");
			return;
		}
		var d = new Dialog("Update");
		d.Width = 630;
		d.Height = 460;
		d.Title = "编辑用户" + arr.userid;
		d.URL = "${base}/private/sys/user/toupdate?userid=" + arr.userid;
		d.OKEvent = function() {
			updateSave();
		};
		d.show();
	}
	function toupdateId(id) {

		if (!id || id.length == 0) {
			Dialog.alert("请先选择要编辑的用户！");
			return;
		}
		var d = new Dialog("Update");
		d.Width = 630;
		d.Height = 460;
		d.Title = "编辑用户" + id;
		d.URL = "${base}/private/sys/user/toupdate?userid=" + id;
		d.OKEvent = function() {
			updateSave();
		};
		d.show();
	}
	function updateSave() {
		if ($DW.Verify.hasError()) {
			return;
		}
		if ($DW.dosave()) {
			jQuery.ajax({
				type : 'POST',
				url : "${base}/private/sys/user/update",
				data : $DW.$("#form1").serialize(),
				success : function(res) {
					if (res == "true") {
						$D.close();
						Dialog.alert("更新成功！");
						loadData();
					} else {
						var jobj = jQuery.parseJSON(res).msg;
						if (jobj != "false") {
							Dialog.alert(jobj);
						} else {
							Dialog.alert("更新失败！");
						}
					}

					return false;
				},
				fail : function(res) {
					Dialog.alert("系统错误!");
				}
			});
		}
	}
	function del() {
		var ids = [];
		var arr = $('#dg1').datagrid('getSelections');
		if (!arr || arr.length == 0) {
			Dialog.alert("请先选择要删除的用户！");
			return;
		}
		Dialog.confirm("确定删除？", function() {
			jQuery.ajax({
				type : 'POST',
				url : "${base}/private/sys/user/delete?ids=" + ids,
				success : function(res) {
					if (res == "true") {
						Dialog.alert("删除成功！");
						loadData();
					} else {
						var jobj = jQuery.parseJSON(res).msg;
						if (jobj != "false") {
							Dialog.alert(jobj);
						} else {
							Dialog.alert("删除失败！");
						}
					}
					return false;
				},
				fail : function(res) {
					Dialog.alert("系统错误!");
				}
			});
		}, "", 250, 150);
	}

	function initButton() {
		Page.initBtn();
		$
		!initBtn
	}

	function getWidth(percent) {
		return document.body.clientWidth * percent;
	}
	function loadData() {
		var SearchUserName = Page.getValue("unitid");
		$("#dg1")
				.datagrid(
						{
							width : "auto",
							height : "auto",
							nowrap : false,
							striped : true,
							border : true,
							collapsible : false,//是否可折叠的  
							fit : false,//自动大小  
							url : "${base}/private/order/orderList",
							queryParams : {
								"SearchUserName" : SearchUserName
							},
							//sortName: 'code',  
							//sortOrder: 'desc',  
							remoteSort : false,
							idField : "userid",
							singleSelect : true,//是否单选
							pagination : true,//分页控件  
							rownumbers : true,//行号  
							fitColumns : true,//行自适应
							pageSize : 10,
							pageList : [ 5, 10, 15, 20, 30, 40, 50 ],
							loadMsg : '数据加载中...',
							onDblClickRow : function(rowIndex, row) {
								toupdateId(row.userid);
							},
							columns : [ [
									{
										title : '订单名称',
										field : 'ddmc',
										align : "center",
										width : getWidth(0.15),
									},
									{
										title : '客户名称',
										field : 'khmc',
										align : "center",
										width : getWidth(0.15),
									},
									{
										title : '联系方式',
										field : 'lxfs',
										align : "center",
										width : getWidth(0.1),
									},
									{
										title : '类型',
										field : 'status',
										align : "center",
										width : getWidth(0.08),
									},
									{
										title : '应付价款',
										field : 'yfjk',
										align : "center",
										width : getWidth(0.08),
									},
									{
										title : '应发货日期',
										field : 'yfhrq',
										align : "center",
										width : getWidth(0.15),
									},
									{
										title : '是否发货',
										field : 'isfh',
										align : "center",
										width : getWidth(0.08),
									},
									{
										field : "e",
										title : "操作",
										width : getWidth(0.1),
										align : "center",
										formatter : function(val, rec) {
											var s1 = "<a href='javascript:update("
														+ rec.sxcjid
														+ ");'>修改</a>";
											var s2 = "<a href='javascript:;toIssue("
														+ rec.sxcjid
														+ ")'>发货</a>";
											var s3 = "<a href='javascript:detail("
													+ rec.sxcjid + ");'>浏览</a>";
											
											return s3 + " | " + s1 + " | " + s2;
										}
									} ] ],
							frozenColumns : [ [ {
								field : "userid",
								checkbox : true
							} ] ]
						});
		//设置分页控件  
		var p = $("#dg1").datagrid("getPager");
		$(p).pagination({
			beforePageText : "第",//页数文本框前显示的汉字  
			afterPageText : "页    共 {pages} 页",
			displayMsg : "当前显示 {from} - {to} 条记录   共 {total} 条记录",
		});
	}
	function lockSearch() {
		Page.setValue("lock", "1");
		loadData();
		Page.setValue("lock", "0");
	}
	Page.onLoad(function() {
		loadData();
	});
	$(window).resize(function() {
		clearTimeout(timer);
		timer = setTimeout(function() {
			$('#dg1').treegrid('resize');
			$('div.panel-body').css('width', 'auto'); //////
		}, 100);
	});
</SCRIPT>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
	<form name='form1' id="from1" method='post'>
		<input type="hidden" name="doAction" value=""> <input
			type="hidden" name="sys_menuid" value="$!sys_menuid"> <input
			type="hidden" name="type" id="type" value="$!type"> <input
			type="hidden" name="xylx" id="xylx" value="$!xylx">
		<div region="north" border="false"
			style="overflow: hidden; padding: 10px 10px 0px 10px">
			<table width="100%" border="0" cellspacing="0" cellpadding="0"
				class="blockTable">
				<tr>
					<td class="blockTd">
						<table width="100%" border="0" cellspacing="0" cellpadding="6">

							<tr>
								<td style="padding: 8px 0 4px 6px;" id="btnlist"><span
									style="float: left;"> &nbsp; 客户名称：<input type="text"
										name="unitid" id="unitid" size="20" /> <input type="button"
										name="check" onclick="loadData();" value="查询" /> <!-- <a class="Djtoggle" id="Djtoggle" name="Djtoggle" style="cursor: pointer;">点击有惊喜</a> -->
								</span> <span style="float:right;"> <a
										href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn'
										hidefocus='true' tabindex='-1' onselectstart='return false'
										id='a' onClick="add();"><img
											src="${base}/images/icons/icon022a2.gif" width="20"
											height="20" /><b>新建&nbsp;</b></a>
								</span></td>
							</tr>
						</table>
					</td>
				</tr>
			</table>
		</div>
		<div region="center" border="false"
			style="width: 100%; height: 100%; padding: 0px 10px 10px;">
			<div id="dg1" style="width: 100%; height: 100%;"></div>
		</div>
	</form>
</body>
</html>