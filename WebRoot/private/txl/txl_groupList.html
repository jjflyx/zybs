<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>$!app_name</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<!-- 框架 -->
		<link rel="stylesheet" type="text/css"
			href="${base}/include/css/blue/style.css" />
		<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
		<script src="${base}/include/js/main.js"></script>
		<script src="${base}/include/js/string.js"></script>
		<!-- 分页  注意顺序 -->
		<link href="${base}/include/css/themes/gray/easyui.css"
			rel="stylesheet" type="text/css" />
		<script src="${base}/include/js/jquery.easyui.min.js"></script>
		<script>
	function getWidth(percent){
        	   return document.body.clientWidth*percent;
	}
	//增加公告
	function openW(url,title) {
		
		var openUrl = url;// 弹出窗口的 url
		var iWidth=500 ;
		var iHeight=300 ;
		var iTop = (window.screen.availHeight-30-iHeight)/2; // 获得窗口的垂直位置;
		var iLeft = (window.screen.availWidth-10-iWidth)/2; // 获得窗口的水平位置;
		
		var w = window.open(openUrl,title,"height="+iHeight+", width="+iWidth+", top="+iTop+", left="+iLeft); 
		if (!w) {
			Dialog.alert("发现弹出窗口被阻止，请更改浏览器设置，以便正常使用本功能!");
			return;
		}
	}
	
	function loadData(){
		$("#dg1").treegrid({
			width:"auto",
        	height:"auto",
        	nowrap: true,  
        	striped: true,  
        	border: true,  
        	collapsible:false,//是否可折叠的 
			url : "${base}/private/txl_group/list",//首次查询路径
			queryParams:{},//首次查询参数
			idField:"id",
			treeField:"name",
			singleSelect:false,//是否单选 
			rownumbers:true,//行号  
			fit: true,//自动大小  
			fitColumns: true,//行自适应
			pagination:true,//分页控件
			loadMsg:'数据加载中...',
			columns : [ [
			{
				field : "name",
				title : "名称",
				width : getWidth(0.2)
			},
			{
				field : "bz",
				title : "备注",
				width : getWidth(0.7)
			}
			] ],
        	 frozenColumns:[[  
        	            {field:"id",checkbox:true}
        	 ]],
			 onDblClickRow:function(row)
        	 {
        	     toupdate(row.id);
        	 }
			
		});
        var p = $("#dg1").datagrid("getPager");
        $(p).pagination({
            beforePageText: "第",//页数文本框前显示的汉字
            afterPageText: "页    共 {pages} 页",
            displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
            onBeforeRefresh:function(){
                $(this).pagination('loading');

                $(this).pagination('loaded');
            }
        });
	}
    //转到新增页面
    function add(){
        var title = "新建分组";
        var url = "${base}/private/txl_group/toadd";
        openW(url,title);
    }
   
    //转到修改页面
    function update()
    {
        var arr = DataGrid.getSelectedValueID("dg1");
        if (!arr || arr.length == 0) {
            Dialog.alert("请先选择要编辑的分组信息！");
            return;
        }
        var title = "修改分组信息";
        var url = "${base}/private/txl_group/toUpdate?id=" + arr[0];
        openW(url,title);

    }
    //转到修改页面
    function toupdate(id)
    {
        var title = "修改分组信息";
        var url = "${base}/private/txl_group/toUpdate?id="+id;
        openW(url,title);
    }
   

    function del() {
    	var ids = new Array();
    	var arr = $("#dg1").treegrid("getSelections");
    	if(arr.length==0){
    		Dialog.alert("请选择要删除的分组信息！");
    		return;
    	}
    	var isdel =confirm("删除分组会级联删除分组内的联系人信息,请谨慎操作");
    	if(!isdel){
    		return ;
    	}
    	for(var r in arr){
    		if(arr[r].id){
    			ids.push(arr[r].id);
    		}
    		
    	}
      	   jQuery.ajax({
     			url : "${base}/private/txl_group/delete?ids="+ids,
     		
     			success : function (res) {  
     				
     				if(res=="true"){ 
                       loadData();
     				}else{
     					Dialog.alert("删除失败！");
     				}
                   arr.length = 0;
                   return false;
     			},
     			fail : function(res) {
     				Dialog.alert("系统错误?!");
     			}
     		});
      }
      
   
    function sel(obj){
         var id=obj.value;
         var qx=document.getElementsByName("id");
         for(var i = 0; i < qx.length; i ++)
           {
               if(qx[i].type == "checkbox")
                {
                  var v=qx[i].value;
                  if(v!=""&&v.length>id.length&&v.startWith(id)){
                      if(obj.checked){
                          qx[i].checked=true;
                      } else{
                           qx[i].checked=false;
                      }
                  }
                   if(v!=""&&v.length<id.length&&id.startWith(v)){
                      if(obj.checked){
                      } else{
                           qx[i].checked=false;
                      }
                  }

                }
           }
        
    }
	Page.onLoad(function() {
	   loadData();
	   
     });
	$(window).resize(function () {
		clearTimeout(timer);
		timer=setTimeout(function(){
		  $('#dg1').datagrid('resize');
		  $('div.panel-body').css('width','auto'); //////
		 },100);
		});
</script>
	</head>
	<body leftmargin="0" topmargin="0" class="easyui-layout">
		<form name='form1' id="from1" method='post'>
			<input type="hidden" name="doAction" value="">
			<input type="hidden" name="sys_menuid" value="$!sys_menuid">
			<input type="hidden" name="checkids" value="">
			<input type="hidden" name="deltype" value="1">
			<div region="north" border="false"
				style="overflow: hidden; padding: 10px 10px 0px 10px">
				<table width="100%" border="0" align="center" cellpadding="0"
					cellspacing="0" class="table_auto czbutton_bk margin_top5">
					<tr>
						<td>
							<div class="czbutton">
								<ul>
									<li id='BtnAdd'>
										<a href='javascript:void(0);' onClick="add();"> <img
												src="${base}/include/img/cz_add.png" width="14" height="14"
												class="png" /><b>新建&nbsp;</b> </a>
									</li>
									<li id='BtnUpdate'>
										<a href='javascript:void(0);' onClick="update();"> <img
												src="${base}/include/img/bj.png" width="16" height="16" /><b>编辑&nbsp;</b>
										</a>
									</li>
									<li id='BtnDel'>
										<a href='javascript:void(0);' onClick="del();"><img
												src="${base}/include/img/cz_del.png" width="14" height="14" /><b>删除&nbsp;</b>
										</a>
									</li>
								</ul>
							</div>
							<div class="clear"></div>
						</td>
					</tr>
				</table>
			</div>
			<div region="center" border="false"
				style="width: 100%; height: 100%; padding: 0px 10px 10px;">
				<div id="dg1" style="width: 100%; height: 100%;"></div>
			</div>
		</form>

	</body>
</html>
