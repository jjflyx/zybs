<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';

	</script>
	<link href="${base}/private/ratifyFollow/css/$!stylename/style.css" rel="stylesheet" type="text/css" />
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!--<link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css" />-->
	<link href="${base}/include/controls/my97/skin/WdatePicker.css" rel="stylesheet" type="text/css"/>
	<script language="javascript" type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
	<script>

		var checkresult=true;
		var submit=false;
		function doSave(status){
			document.getElementById("status").value=status;
			if(submit){
				alert("请勿重复提交！");
				return;
			}
			if(Verify.hasError()){
				return ;
			}
			var sex = $('input[name="sex"]:checked').val();
			if(sex==null){
				Dialog.alert("请选择您的性别!",function(){
					return;
				});
				return;
			}
			checkcode($("#code"));
			if(!checkresult){
				return;
			}
			submit=true;
			jQuery.ajax({
				type: 'POST',
				url : "${base}/private/gtxt/xyzt/add" ,
				data : $("#form1").serialize(),
				success : function (res) {
					if(res){
						Dialog.alert("添加成功！",function(){
							window.opener.loadGrid();
							window.close();
						});
					}else{
						Dialog.alert("添加失败！");
						submit=false;
					}
					return false;
				},
				fail : function(res) {
					Dialog.alert("系统错误?!");
				}
			});
		}

		function getOther(){
			var numb = $("#code").val();
			var birthday = numb.substring(6, 10) + "-" + numb.substring(10, 12) + "-" + numb.substring(12, 14);
			$("#csrq").val(birthday);
			var sex = numb.substring(16,17);
			if(sex%2 == 0){
				$("input[name=sex]:eq(1)").attr("checked",'checked');
			}else{
				$("input[name=sex]:eq(0)").attr("checked",'checked');
			}
		}

		//验证身份证号是否唯一
		function checkcode(obj){
			var value=$(obj).val();
			if(value){//没有值得时候不验证
				jQuery.ajax({
					type : 'POST',
					url : "${base}/private/gtxt/xyzt/checkCode",
					data : {"code":value},
					async:false,
					success : function(res) {
						if (res == "false") {
							Dialog.alert("当前输入的身份证号信息已存在,请勿重复添加！", function() {
// 								window.opener.loadData();
// 								window.close();
							});
							checkresult=false;
						} else{
							checkresult=true;
						}

					},
					fail : function(res) {
						Dialog.alert("系统错误?!");
					}
				});
			}
		}
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="form1" method='post'>
	<input type="hidden" name="type" id="type" value="0">
	<input type="hidden" name="status" id="status">
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<table width="98%" border="0" align="center" cellpadding="0"
			   cellspacing="0" class="table_auto margin_top15 table_titlebk">
			<tr>
				<td class="table_title" align="center">
					自然人信息
				</td>
			</tr>
		</table>
		<table width="98%" border="0" align="center" cellpadding="0"  cellspacing="0" class="table_auto table_nrbk">
			<tr>
				<td valign="top" class="padding10">
					<table width="100%" border="0" cellpadding="0" cellspacing="3">
						<tr>
							<td align="right" width="41%">
								姓名：
							</td>
							<td width="220">
								<input type="text" name="name" id="name" size="25" maxlength="40" verify="自然人姓名|NotNull" /><span style="color:red">*</span>
							</td>
						</tr>
						<tr>
							<td align="right">
								身份证号：
							</td>
							<td align="left" width="140">
								<input type="text" name="code" id="code" size="25" maxlength="50" verify="身份证号|NotNull&&身份证号|isIdNumber" onblur="getOther();"/><span style="color:red">* (身份证号即个人信用代码)</span>

							</td>
						</tr>
						<tr>
							<td align="right">
								性别：
							</td>
							<td width="220">
								<label><input type="radio" name="sex"  value="0" />男性</label>
								<label><input type="radio" name="sex"  value="1" />女性</label>
							</td>
						</tr>
						<tr>
							<td align="right">
								出生日期：
							</td>
							<td width="220">
								<input type="text" id="csrq" name="csrq"  style="width:90px;height:16px;background:#F4F9FB url(${base}/include/controls/my97/skin/datePicker.gif) no-repeat right;"
									   onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" >
							</td>
						</tr>
						<tr>
							<td align="right">
								手机号码：
							</td>
							<td align="left" width="140">
								<input type="text" name="phone" id="phone" size="25" maxlength="50" verify="手机号码|NotNull&&手机号码|isPhone" /><span style="color:red">*</span>
							</td>
						</tr>
						<tr>
							<td align="right">
								家庭住址：
							</td>
							<td align="left" width="140">
								<input type="text" name="home_addr" id="home_addr" size="25" maxlength="240"  />
							</td>
						</tr>
						<!-- 
						<tr>
							<td align="right">联系电话：</td>
							<td align="left" width="140">
								<input type="text" name="tel" id="tel" size="25" maxlength="50"/>
							</td>
						</tr>
						 -->
					</table>
				</td>
			</tr>
		</table>
		
	</div>
	<div region="south" border="false"
		 style="overflow: hidden; padding: 10px 10px 0px 10px">
		<div align="center" style="padding-bottom: 10px;">
		<input type="button" class="button" name="btnOk" value="暂存" onclick="doSave(0)" />
			<input class="button" type="button" name="btnOk" value="提交"
				   onclick="doSave(1)" />
			<input class="button" type="button" name="btnOk" value="关闭"
				   onclick="window.close();" />
		</div>
	</div>
</form>
</body>
</html>