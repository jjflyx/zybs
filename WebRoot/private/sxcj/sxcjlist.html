<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html style="overflow-y:auto">
<head>
    <title>$!app_name</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- 框架 -->
    <link href="${base}/include/css/default.css" rel="stylesheet" type="text/css"/>
    <script type='text/javascript'>
        var CONTEXTPATH = '${base}';
        var stylePath = '$!stylename';

    </script>
    <script src="${base}/include/js/main.js"></script>
    <script src="${base}/include/js/string.js"></script>
    <!-- 分页  注意顺序 -->
    <link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css"/>
    <script src="${base}/include/js/jquery.easyui.min.js"></script>
    <!-- 树 -->
    <script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
    <link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
    <link href="${base}/include/controls/my97/skin/WdatePicker.css" rel="stylesheet" type="text/css"/>
    <script language="javascript" type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
    <script>

        function getWidth(percent){
            return document.body.clientWidth*percent;
        }

        var cjTable = $!cjTable;
        var csTable = $!csTable;
        var ztTable = $!ztTable;
        function loadData(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/sxcj/sxcjlist",//首次查询路径
                queryParams:{"xyzt_type":$("#xyzt_type").val(),"src":$("#src").val(),"type":$("#type").val(),"xyzt_name":$("#xyzt_name").val(),"xytype":$("#xytype").val()},//首次查询参数
                idField:"sxcjid",
                treeField:"name",
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        align : "center",
                        width : 400
                    },
                    {
                        field : "xyzt_type",
                        title : "类型",
                        align : "center",
                        width : getWidth(0.10),
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                                val = ztTable[val];
                            }
                            return val;
                        }
                    } ,
                    {
                        field : "sxxw",
                        title : "失信行为",
                        align : "center",
                        width : getWidth(0.25),
                        formatter : function(value,row,index){
                            var sub = "";
                            if(value.length > 12){
                                sub = value.substring(0,12)+"...";
                            }else{
                                sub = value;
                            }
                            var html = "<span title='"+value+"'>"+sub+"</span>";
                            return html;
                        }
                    },
                    {
                        field : "cjcs",
                        title : "惩戒措施",
                        align : "center",
                        width : getWidth(0.25),
                        formatter : function(value,row,index){
                        	var sub = "";
                            if(value!=null&&value.length > 12){
                                sub = value.substring(0,12)+"...";
                            }else{
                                sub = value;
                            }
                            var html = "<span title='"+value+"'>"+sub+"</span>";
                            return html;
                        }
                    },
                    {
                        field : "startdend",
                        title : "惩戒期限",
                        align : "center",
                        width : getWidth(0.30)
                    },
                    {
                     field : "discipline_date",
                     title : "惩戒作出时间",
                     align : "center",
                     width : getWidth(0.15)
                     },
                    {
                        field : "type",
                        title : "状态",
                        align : "center",
                        width : getWidth(0.1),
                        formatter : function(val,rec){
                            var val = val+"";
                            if(val!=null && val!=" "){
                            	if(val.indexOf(",") > 0){
                                	var array= val.split(',');
                                	val=cjTable[array[0]];
                                }else{
                                	val = cjTable[val];
                                }
                            }
                            //else{
                             //   val = "惩戒尚未开始";
                            //}
                            return val;
                        }
                    },
                    /* {
                        field : "src",
                        title : "产生方式",
                        align : "center",
                        width : getWidth(0.15),
                        formatter : function(val,rec){
                            var val = val+"";
                            if(val!=null && val!=""){
                                val = csTable[val];
                            }
                            return val;
                        }
                    }, */
                   
                    {
                        field : "i",
                        title : "操作",
                        align : "center",
                        width : getWidth(0.28),
                        formatter : function(val,rec){
                            if(rec.type==0&&rec.src!=2) {
                                var s1 = "<a href='javascript:update(" + rec.sxcjid + ");'>修改</a>"; //未发布、未撤销
                            }else{
                                var s1 = "修改"
                            }
                            if((rec.type==0||rec.type==4) && rec.issue==0) {
                                var s2 = "<a href='javascript:;toIssue(" + rec.sxcjid + ")'>发布</a>";// 未撤销
                            }else{
                                var s2 = "发布";
                            }
                            var s3 = "<a href='javascript:detail(" + rec.sxcjid + ");'>浏览</a>";
                            if(rec.issue==0&&rec.src!=2&&rec.type!=2) {
                                var s4 = "<a href='javascript:chexiao(" + rec.sxcjid + ");'>撤销</a>";//未发布
                            }else{
                                var s4 = "撤销";
                            }
                            if(rec.src!=2&&rec.type!=1&&rec.type!=2){
                            	var s5="<a href='javascript:biaozhu(" + rec.sxcjid + ");'>标注</a>";
                        	}else{
                        		var s5 = "标注";
                        	}	
                            return s3+" | "+s1+" | "+s2+" | "+s4+" | "+s5;
                        }
                    }
                ] ],
                /*frozenColumns:[[
                 {field:"id",checkbox:true}
                 ]],*/

                //,
                // onLoadSuccess:function(){
                //   initCheckbox();
                // }
              	//当选中一行是触发
				onSelect: function(index,row){
					//TODO 事件响应代码；
					$("#cjcs").attr("value",row.cjcs);
					$("#sxxw").attr("value",row.sxxw);
				}
            });
            //设置分页控件  
            var p = $("#dg1").datagrid("getPager");
            $(p).pagination({
                beforePageText: "第",//页数文本框前显示的汉字  
                afterPageText: "页    共 {pages} 页",
                displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
                onBeforeRefresh:function(){
                }
            });
        }
        //是否发布
        function toIssue(id){
            Dialog.confirm("确定要外网发布吗？", function() {
                jQuery.ajax({
                    type: 'POST',
                    url : "${base}/private/sxcj/toIssue?sxcjid="+id ,
                    success : function (res) {
                        if(res=="true"){
                            Dialog.alert("外网发布成功！");
                            loadData();
                        }else{
                            Dialog.alert("外网发布失败！");
                        }
                    },
                    fail : function(res) {
                        Dialog.alert("系统错误?!");
                    }
                });
            })
        }

        //浏览页面
        function detail(id){
        	var cjcs=$("#cjcs").val();
            var iHeight = 450;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2;//获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2;//获得窗口的水平位置;
            window.open("${base}/private/sxcj/detail?sxcjid="+id+"&xytype="+$("#xytype").val(), "浏览法人信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        //转到新增页面
        function add()
        {
            var xytype = $("#xytype").val();
            var iHeight = 560;
            var iWidth = 950;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/sxcj/add?xytype="+xytype, "添加失信惩戒信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        //转到撤销页面
        function chexiao(id){
        	var cjcs=$("#cjcs").val();
            var xytype = $("#xytype").val();
            var iHeight = 560;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/sxcj/toCancel?sxcjid="+id+"&xytype="+xytype, "撤销失信惩戒信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }
      //转到标注页面
        function biaozhu(id){
        	var cjcs=$("#cjcs").val();
            var xytype = $("#xytype").val();
            var iHeight = 560;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/sxcj/toBz?sxcjid="+id+"&xytype="+xytype, "标注失信惩戒信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        //转到修改页面
        function update(id)
        {
            var xytype = $("#xytype").val();
            var iHeight = 560;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/sxcj/toUpdate?sxcjid="+id+"&xytype="+xytype, "修改失信惩戒信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');

        }
        //转到修改页面
        function toupdate(id)
        {
            var d = new Dialog("Update");
            d.Width = 500;
            d.Height = 300;
            d.Title = "修改菜单";
            d.URL = "${base}/private/sys/res/toupdate?id="+id;
            d.onLoad = function(){
                $DW.$Z("name").focus();
            }
            d.OKEvent = function(){
                updateSave();

            };
            d.show();
        }
        
        function updateSave(){
            if($DW.Verify.hasError()){
                return;
            }
            jQuery.ajax({
                type: 'POST',
                url : "${base}/private/zjgl/sxcj/updateSave" ,
                data : $DW.$("#form1").serialize(),
                success : function (res) {
                    if(res!=""){
                        $D.close();
                        Dialog.alert("修改成功！");
                        loadData();
                    }else{
                        Dialog.alert("修改失败！");
                    }

                    return false;
                },
                fail : function(res) {
                    Dialog.alert("系统错误?!");
                }
            });

        }

        Page.onLoad(function() {
            loadData();

        });
        $(window).resize(function () {
            clearTimeout(timer);
            timer=setTimeout(function(){
                $('#dg1').datagrid('resize');
                $('div.panel-body').css('width','auto'); //////
            },100);
        });
    </script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
    <input type="hidden" name="doAction" value=""> <input
        type="hidden" name="sys_menuid" value="$!sys_menuid"> <input
        type="hidden" name="checkids" value=""> <input
        type="hidden" name="deltype" value="1">
    <input type="hidden" name="xytype" id="xytype" value="$!xytype"/>
    <input type="hidden" name="cjcs" id="cjcs" />
    <input type="hidden" name="sxxw" id="sxxw" />
    <div region="north" border="false"  style="overflow: hidden; padding: 10px 10px 0px 10px">
        <table width="100%" border="0" cellspacing="0" cellpadding="0"
               class="blockTable">
            <tr>
                <td class="blockTd">
                    <table width="100%" border="0" cellspacing="0" cellpadding="6">
                        <!-- <tr>
                            <td valign="middle"><img
                                    src="${base}/images/icons/icon042a4.gif"
                                    width="20" height="20" />&nbsp;失信惩戒</td>
                        </tr> -->
                        <tr>
                            <td style="padding: 8px 0 4px 6px;" nowrap="nowrap">
                               <span style="float: left"> &nbsp;
                                信用主体类型：<select id="xyzt_type" name="xyzt_type" onchange="loadData();">
                                <option value="">请选择</option>
                                #foreach($!type in $!ztlxlist)
                                <option value="$!type.value">$!type.name</option>
                                #end
                            </select>
                                &nbsp;
                                产生方式：<select id="src" name="src" onchange="loadData();">
                                <option value="">请选择</option>
                                #foreach($!csfs in $!csMap)
                                <option value="$!csfs.value">$!csfs.name</option>
                                #end
                            </select>
                               <!--  &nbsp;
                                惩戒状态：<select id="type" name="type" onchange="loadData();">
                                <option value="">请选择</option>
                                #foreach($!cjzt in $!cjMap)
                                <option value="$!cjzt.value">$!cjzt.name</option>
                                #end
                                 <option value=" ">惩戒尚未开始</option>
                            </select> -->
                                &nbsp;
                                关键字：<input type="text" name="xyzt_name" id="xyzt_name" size="20" placeholder="信用主体名称"></input>
                                <input type="button" name="button" id="button" value="查询" onclick = " loadData();"></input>
                                               </span><span style="float: right">
                                            <a
                                                href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn'
                                                hidefocus='true' tabindex='-1' onselectstart='return false'
                                                id='a' onClick="add();"><img
                                                    src="${base}/images/icons/icon022a2.gif" width="20"
                                                    height="20" /><b>新建&nbsp;</b></a>
                                        </span>
                            </td>
                        </tr>
                    </table></td></tr></table>
    </div>
    <div region="center" border="false"
         style="width: 100%; height: 100%; padding: 0px 10px 10px;">
        <div id="dg1" style="width: 100%; height: 100%;"></div>
    </div>
</form>
</body>
</html>
