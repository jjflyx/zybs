<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html style="overflow-y:auto">
<head>
    <title>$!app_name</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- 框架 -->
    <link href="${base}/include/css/default.css" rel="stylesheet" type="text/css"/>
    <script type='text/javascript'>
        var CONTEXTPATH = '${base}';
        var stylePath = '$!stylename';
    </script>
    <script src="${base}/include/js/main.js"></script>
    <script src="${base}/include/js/string.js"></script>
    <!-- 分页  注意顺序 -->
    <link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css"/>
    <script src="${base}/include/js/jquery.easyui.min.js"></script>
    <!-- 树 -->
    <script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
    <link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
    <link href="${base}/include/controls/my97/skin/WdatePicker.css" rel="stylesheet" type="text/css"/>
    <script language="javascript" type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
    <script>

        function getWidth(percent){
            return document.body.clientWidth*percent;
        }
        4
        var cjTable = $!cjTable;
        var ztTable = $!ztTable;
        var statusMap=$!statusMap;
        function loadData(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/xzcf/xzcflist",//首次查询路径
                queryParams:{"xyzt_type":$("#xyzt_type").val(),"cfsx_date":$("#cfsx_date").val(),"xyzt_name":$("#xyzt_name").val(),"xzcf_zt":$("#xzcf_zt").val()},//首次查询参数
                idField:"xzcfid",
                treeField:"name",
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "被处罚（信用）主体",
                        align : "center",
                        width : 260
                    },
                    {
                        field : "xyzt_type",
                        title : "信用主体类型",
                        align : "center",
                        width : getWidth(0.09),
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                                val = ztTable[val];
                            }
                            return val;
                        }
                    } ,
//                    {
//                        field : "xm_name",
//                        title : "关联项目",
//                        align : "center",
//                        width : getWidth(0.20)
//                    },
                    {
                        field : "au",
                        title : "案由",
                        align : "center",
                        width : getWidth(0.2),
                        formatter : function(value,row,index){
                            var sub = "";
                            if(value!=null){
                            	if(value.length > 15){
                                    sub = value.substring(0,15)+"...";
                                }else{
                                    sub = value;
                                }
                            }
                            var html = "<span title='"+value+"'>"+sub+"</span>";
                            return html;
                        }
                    },
                    {
                        field : "cfsx_date",
                        title : "处罚生效时间",
                        align : "center",
                        width : getWidth(0.10)
                    },
                    {
                        field : "status",
                        title : "状态",
                        align : "center",
                        width : getWidth(0.10),
                        formatter:function(value,row,index){
                        	return statusMap[row.status];
                        }
                    },
                    {
                        field : "g",
                        title : "操作",
                        align : "center",
                        width : getWidth(0.26),
                        formatter : function(val,rec){
                        	var lxqk=rec.cflx_date!=null&&rec.cflx_date!=""&&rec.cflx_date!="null";
                            if(rec.xzcf_zt==2||rec.is_qz==1||rec.sjlxqk!=03||(rec.biaozhu!=05&&rec.biaozhu!=null)){
                                var s1 = "修改";
                            }else{
                                var s1 = "<a href='javascript:update("+rec.xzcfid+");'>修改</a>";
                            }
                            var s2 = "<a href='javascript:detail("+rec.xzcfid+");'>浏览</a>";
                            if(rec.issue == 0&&rec.status==1&&rec.sjlxqk==03&&(rec.biaozhu==05||rec.biaozhu==null)) {
                                var s3 = "<a href='javascript:;toIssue(" + rec.xzcfid + ")'>发布</a>";
                            }else{
                                var s3 = "发布";
                            }
                            if(rec.xzcf_zt!=2 && rec.is_qz==0&&lxqk==false&&rec.status==1&&rec.sjlxqk==03){
                                var s4 = "<a href='javascript:chexiao("+rec.xzcfid+");'>撤销</a>";
                            }else{
                                var s4 = "撤销";
                            }
                            if(rec.is_qz == 0&&lxqk==false&&rec.xzcf_zt!=2&&rec.status==1&&rec.sjlxqk!=01&&rec.sjlxqk!=04&&(rec.biaozhu==05||rec.biaozhu==null)){
                                var s5 = "<a href='javascript:qzAdd("+rec.xzcfid+");'>强制</a>";
                            }else{
                                var s5 = "强制";
                            }
                            var s6 = "<a href='javascript:toLX("+rec.xzcfid+");'>履行情况</a>";
                            if(rec.sjlxqk==01||rec.sjlxqk==04||rec.status!=1||rec.xzcf_zt==2||(rec.biaozhu!=05&&rec.biaozhu!=null)){//填报履行情况
                                s6 = "履行情况";
                            }
                            var s7="<a href='javascript:toBZ("+rec.xzcfid+");'>标注</a>";
                            if(rec.status!=1||rec.xzcf_zt==2||rec.sjlxqk!=03){
                            	s7 = "标注";
                            }
                            return s2+" | "+s1+" | "+s3 + " | "+s4 + " | "+s7+" | " + s6 + " | " + s5;
                        }
                    }
                ] ],
                onDblClickRow:function(value,row,index)
                {
//                    update(row.id);
                }
            });
            //设置分页控件
            var p = $("#dg1").datagrid("getPager");
            $(p).pagination({
                beforePageText: "第",//页数文本框前显示的汉字
                afterPageText: "页    共 {pages} 页",
                displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
                onBeforeRefresh:function(){
                }
            });
            $("#dg1").datagrid("clearSelections");

        }

        //是否发布
        function toIssue(id){
            Dialog.confirm("确定要外网发布吗？", function() {
                jQuery.ajax({
                    type: 'POST',
                    url : "${base}/private/xzcf/toIssue?xzcfid="+id ,
                    success : function (res) {
                        if(res=="true"){
                            Dialog.alert("外网发布成功！");
                            loadData();
                        }else{
                            Dialog.alert("外网发布失败！");
                        }
                    },
                    fail : function(res) {
                        Dialog.alert("系统错误?!");
                    }
                });
            })
        }

        //转到撤销页面
        function chexiao(id){
            var iHeight = 560;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/xzcf/toCancel?xzcfid="+id, "行政处罚撤销", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }
      //转到撤销页面
        function toLX(id){
            var iHeight = 560;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/xzcf/toLX?xzcfid="+id, "填报履行情况", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }
      //转到标注页面
        function toBZ(id){
            var iHeight = 560;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/xzcf/toBz?xzcfid="+id, "填报标注", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        //浏览页面
        function detail(id){
            var iHeight = 450;
            var iWidth = 900;
            var iTop = (window.screen.height-30-iHeight)/2;//获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2;//获得窗口的水平位置;
            window.open("${base}/private/xzcf/detail?xzcfid="+id, "浏览行政处罚信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        //转到新增页面
        function add()
        {
            var iHeight = 550;
            var iWidth = 950;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/xzcf/toadd", "行政处罚信息添加", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }
        //转到修改页面
        function update(id)
        {
            var iHeight = 600;
            var iWidth = 950;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/xzcf/toUpdate?xzcfid="+id, "行政处罚信息修改", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        //转到新增页面
        function qzAdd(id)
        {
            var iHeight = 600;
            var iWidth = 950;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/xzqz/toadd?id="+id, "行政强制信息添加", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        Page.onLoad(function() {
            loadData();

        });
        $(window).resize(function () {
            clearTimeout(timer);
            timer=setTimeout(function(){
                $('#dg1').datagrid('resize');
                $('div.panel-body').css('width','auto'); //////
            },100);
        });
    </script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
    <input type="hidden" name="doAction" value=""> <input
        type="hidden" name="sys_menuid" value="$!sys_menuid"> <input
        type="hidden" name="checkids" value=""> <input
        type="hidden" name="deltype" value="1">
    <div region="north" border="false"
         style="overflow: hidden; padding: 10px 10px 0px 10px">
        <table width="100%" border="0" cellspacing="0" cellpadding="0"
               class="blockTable">
            <tr>
                <td class="blockTd">
                    <table width="100%" border="0" cellspacing="0" cellpadding="6">
                        <!-- <tr>
                            <td valign="middle"><img
                                    src="${base}/images/icons/icon042a4.gif"
                                    width="20" height="20" />&nbsp;行政处罚</td>
                        </tr> -->
                        <tr>
                            <td nowrap="nowrap">
<span style="float: left">
                                &nbsp;
                                信用主体类型：<select id="xyzt_type" name="xyzt_type" onchange="loadData();">
                                <option value="">请选择</option>
                                #foreach($!xyzt in $!xyztMap)
                                <option value="$!xyzt.value">$!xyzt.name</option>
                                #end
                            </select>
                                &nbsp;
                                处罚生效年度：<input type="text" id="cfsx_date" name="cfsx_date" value="$!startTime"   style="width:80px;height:16px;background:#F4F9FB url(${base}/include/controls/my97/skin/datePicker.gif) no-repeat right;"
                                              onclick="WdatePicker({dateFmt:'yyyy'})" >
                                <!--                         &nbsp;
                                                                                 状态：<select id="xzcf_zt" name="xzcf_zt" onchange="loadData();">
                                                        <option value="">请选择</option>
                                                        #foreach($!cjzt in $!cjMap)
                                                        <option value="$!cjzt.value">$!cjzt.name</option>
                                                        #end
                                                        <option value=" ">惩戒尚未开始</option>
                                                    </select> -->
                                &nbsp;
                                关键字：<input type="text" name="xyzt_name" id="xyzt_name" size="20" placeholder="信用主体名称"/>
                                &nbsp;
                                <input type="button" name="button" id="button" value="查询" onclick="loadData();"/></span>
                                                    <span style="float: right">
                                                         <a href ='javascript:void(0);' ztype='zPushBtn'
                                                            class='zPushBtn' hidefocus='true' tabindex='-1'
                                                            onselectstart='return false' id='a' onClick="add();">
                                                             <img src="${base}/images/icons/icon022a2.gif" width="20"
                                                                  height="20" />
                                                             <b>新建&nbsp;</b></a>
                                                    </span>
                            </td>
                        </tr>
                    </table></td></tr></table>
    </div>
    <div region="center" border="false"
         style="width: 100%; height: 100%; padding: 0px 10px 10px;">
        <div id="dg1" style="width: 100%; height: 100%;"></div>
    </div>
</form>
</body>
</html>
