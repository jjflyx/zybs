<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
	<link rel="stylesheet" type="text/css" href="${base}/css/form.css" />
	<link rel="stylesheet" type="text/css" href="${base}/include/css/page.css"/>
	<link href="${base}/private/ratifyFollow/css/$!stylename/style.css" rel="stylesheet" type="text/css" />
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!--<link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css" />-->
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<link href="${base}/include/controls/my97/skin/WdatePicker.css" rel="stylesheet" type="text/css"/>
	<script language="javascript" type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
	<script src="${base}/include/js/ajaxfileupload.js"></script>
	<script src="${base}/js/util/preview.js"></script>
	<script>
		function customHeightSet(){
			var otherH_1	=jQuery(".pageBtnarea").outerHeight() + parseInt($(".pageM").css("paddingTop")) + parseInt($(".pageM").css("paddingBottom"));
			var pageH	=document.documentElement.clientHeight;
			jQuery("#pageScroll").height(pageH-otherH_1);
		}
		jQuery(document).ready(function(){
			customHeightSet();
			appendDiv();
		});
		window.onload = function(){
			customHeightSet();
		}
		window.onresize = function(){
			customHeightSet();
		}
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="form1" method='post'
	  action="${base}/private/slzx/slj_info/add">
	<input type="hidden" name="sxqx_name" id="sxqx_name"/>

	<input type="hidden" name="sxxw_id" id="sxxw_id">
	<input type="hidden" name="sxqx_id" id="sxqx_id">
	<input type="hidden" name="cjcs_id" id="cjcs_id">

	<input type="hidden" name="status" id="status">
	<input type="hidden" name="issue" id="issue" value="0"/>

	<input name="file_html" id="file_html" type="hidden">
	<input type="hidden" id="xyzt_id" name="xyzt_id" value="">
	<input type="hidden" id="contract_id" name="contract_id">
	<input type="hidden" id="is_warn" name="is_warn" value="0">
	<input type="hidden" id="if_lx" name="if_lx" value="0">
	<input type="hidden" name="filename" id="filename" value="" />
	<input type="hidden" name="filepath" id="filepath" value="" />
	<input type="hidden" name="filesize" id="filesize" value="" />
	<div class="pageM editpage" id="pageScroll">
		<table width="100%" border="0" align="center" cellpadding="0" cellspacing="0" class="table_titlebk">
			<tr>
				<td class="table_title" align="center">
					行政处罚信息
				</td>
			</tr>
		</table>
		<div class="conBody">
			<table width="100%" border="0" cellspacing="0" cellpadding="0"  class="tableEdits table_nrbk">
				<colgroup>
					<col width="15%" />
					<col width="35%" />
					<col width="15%" />
					<col width="35%" />
				</colgroup>
				<tr>
					<th>行政处罚类型：</th>
					<td colspan="3">
						<select id="xzcf_type" name="xzcf_type" onchange="toFindxw();" verify="行政处罚类型|NotNull">
							<option value="">请选择</option>
							#foreach($!xzcf in $!xzcf_typeList)
							<option value="$!xzcf.value">$!xzcf.name</option>
							#end
						</select>
						<span style="color: red">*</span>
					</td>
				</tr>

				<tr>
					<th>被处罚（信用）主体：</th>
					<td>
						<input type="text" name="xyzt_name" id="xyzt_name" size="20" readonly="readonly" placeholder="点击右边图标即可添加" verify="信用主体|NotNull" maxlength="40" />
						&nbsp;
						<img src="${base}/include/img/cz_find.png" id="sxcj_img" name="sxcj_img" style="vertical-align: middle; cursor: pointer;"
							 onclick="toAddsxcj();" />
						<span style="color: red">*</span>
					</td>
					<th>信用主体类型：</th>
					<td>
						<input type="text" id="xyzt_type" name="xyzt_type" size="20" readonly="readonly" maxlength="40" />
					</td>
				</tr>

				<tr>
					<!--<th>关联合同：</th>-->
					<!--<td>-->
					<!--<input type="text" name="xm_name" id="xm_name" size="20" readonly="readonly" maxlength="50"/>-->
					<!--&nbsp;-->
					<!--<img src="${base}/include/img/cz_find.png"  style="vertical-align: middle; cursor: pointer;"-->
					<!--onclick="findht();" /> -->
					<!--</td>-->
					<th>处罚单位：</th>
					<td colspan="3">
						<input type="hidden" id="cf_unit" name="cf_unit" value="$!unit"/>
						$!unitname
					</td>
				</tr>
				<tr id="xwtr">
					<th>被处罚事由(失信行为)：</th>
					<td colspan="3"><span id="xw_td"></span></td>
				</tr>

				<tr id="qxtr">
					<th>被处罚（失信）情形：</th>
					<td colspan="3"><span id="qx_td"></span></td>
				</tr>
				<tr id="cstr">
					<th>惩戒措施：</th>
					<td colspan="3" id="cs_td"></td>
				</tr>
				<tr id="yjtr">
					<th>惩戒依据：</th>
					<td colspan="3" id="yj_td">
						<span id="yj_textarea" ></span>
					</td>
				</tr>
				<tr id="anyou">
					<th></th>
					<td colspan="3">
						<textarea id="au" name="au" cols="95" rows="3" ></textarea>
					</td>
				</tr>
				<tr>
					<th>行政处罚决定书文号：</th>
					<td>
						<input type="text" name="xzcf_code" id="xzcf_code" size="20" maxlength="40" verify="行政处罚决定书文号|NotNull" />
						<span style="color: red">*</span>
					</td>
					<th>处罚生效时间：</th>
					<td>
						<input class="Wdate" onclick="WdatePicker();" name="cfsx_date" id="cfsx_date" size="20" maxlength="50" verify="处罚生效时间|NotNull" />
						<span style="color: red">*</span>
					</td>
				</tr>
				<!-- <tr>
					<th>履行处罚截止日期：</th>
					<td colspan="3">
						<input class="Wdate" onclick="WdatePicker();" name="start_date" id="start_date" size="20" maxlength="50" verify="处罚开始时间|NotNull" />
						&nbsp;至 &nbsp;
						<input class="Wdate" onclick="WdatePicker();" name="end_date" id="end_date" size="20" maxlength="50" verify="履行处罚截止日期|NotNull" />
						<span style="color: red">*</span>
					</td>
					<td align="right" width="100" >实际履行处罚日期：</td>
					<td width="100">
						<input class="Wdate" onclick="WdatePicker();" name="cflx_date" id="cflx_date" size="20" maxlength="50" />
					</td>
				</tr> -->
			<tr>
                <td align="right">被惩戒时限：</td>
                <td colspan="3">
                    <input class="Wdate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd',maxDate:'%y-%M-%d'});" name="cj_start_date" id="cj_start_date" value="$!today" size="20" maxlength="50"  verify="开始时间|NotNull"></input>&nbsp;&nbsp;至&nbsp;
                    <input class="Wdate" onclick="WdatePicker({dateFmt:'yyyy-MM-dd',minDate:'#F{$dp.$D(\'cj_start_date\')}'});" name="cj_end_date" id="cj_end_date" size="20" maxlength="50"></input>
                </td>
            </tr>
            	<tr>
					<th>处罚依据：</th>
					<td colspan="3">
						<textarea id="xzcf_yiju" name="xzcf_yiju" cols="95" rows="3" verify="处罚依据|NotNull"></textarea>
						<span style="color: red">*</span>
					</td>
				</tr>
				<tr>
					<th>处罚结论：</th>
					<td colspan="3">
						<textarea id="xzcf_note" name="xzcf_note" cols="95" rows="3" verify="处罚结论|NotNull"></textarea>
						<span style="color: red">*</span>
					</td>
				</tr>
				<tr> 
      <td dateclass="forth" align="right">上传附件：</td> 
      <td colspan="3">
      <table>
			<tr>
				<td>
					<select id="sbfile" name='sbfile'
						style='width: 350px;height: 65px;' multiple size="3"
						class="Noprint">
					</select>
					<button type="button"  fileinputname="fj" class="btn-text btn-attachement" 
					onclick="selectUpload(form1.sbfile);">选择</button>
					<button type="button" fileinputname="fj" class="btn-text btn-attachement-del"
					 onclick="del_fujian(form1.sbfile);">删除</button>
						(文件大小不能超过5MB！)
				</td>
			</tr>
			</table></td> 
     </tr> 
				<tr bgcolor="#ffffff" id="file_tr" style="display: none;">
					<th> 文件列表：</th>
					<td height="24" colspan="3" bgcolor="#FFFFFF">
						<span id="file_list"></span>
					</td>
				</tr>
			</table>
		</div>
	</div>
	<div class="pageBtnarea">
		<input class="button" type="button" name="btnOk" value="暂存" onclick="doSave(0)" />
		<input class="button" type="button" name="btnOk" value="提交" onclick="doSave(1)" />
		<input class="button" type="button" name="btnOk" value="关闭" onclick="window.close();" />
	</div>
</form>
<script>
	function ht() {
		$("#hideDIV").attr("style", "");
	}

	function add() {
		var d = new Dialog("add");
		d.Width = 850;
		d.Height = 400;
		d.Title = "添加项目";
		d.URL = "${base}/private/zjgl/sxcj/addht";
		d.OKEvent = function() {
			$D.close();
		}
		d.show();
	}

	//选择行政处罚类型，弹出失信行为
	function toFindxw() {
		var xzcf_type = $("#xzcf_type").val();
		if(xzcf_type==""){
			Dialog.alert("请选择行政处罚类型!");
			return ;
		}
		$("#xyzt_name").val("");
		$("#xyzt_id").val("");
		$("#xyzt_type").val("");
		$("#contract_id").val("");
		$("#xm_name").val("");
		$("#xwtr").hide();
		if (xzcf_type) {
			//添加行政处罚类失信行为
			$.ajax({
				type : "post",
				url : "${base}/private/xzcf/sxxwAjax?xzcf_type=" + xzcf_type,
				dataType : "json",
				success : function(res) {
					var xw = "";
					var old_name = "";
					$.each(res,function(n, array) {
						if (old_name != array.sxxw) {
							old_name = array.sxxw;
							xw += "<input style='vertical-align: middle;' type='checkbox' id='checkbox"
									+ array.id
									+ "' name='checkbox' value='"
									+ array.id
									+ "' onclick='checkboxOnclick();'/><span>"
									+ array.sxxw
									+ "</span></br>";
						}
					});
					if(xzcf_type=="0004"){
					xw += "<input style='vertical-align: middle;' type='checkbox' name='checkbox' value='0043_03'  onclick='checkboxOnclick();' /><span id=\"0043_03\">非法转让其他土地</span></br>"
					xw += "<input style='vertical-align: middle;' type='checkbox' name='checkbox' value='0043_01'  onclick='checkboxOnclick();' /><span id=\"0043_01\">非法占地</span></br>"
					xw += "<input style='vertical-align: middle;' type='checkbox' name='checkbox' value='0043_02'  onclick='checkboxOnclick();' /><span id=\"0043_02\">破坏耕地</span></br>"
					}
					xw += "<input style='vertical-align: middle;' type='checkbox' id='checkbox99' name='checkbox' value='0043'  onclick='checkboxOnclick();' /><span id=\"0043\">其他行为</span></br>"
					$("#xw_td").html(xw+"<hr />");
				}
			});
		}

	}

	function checkboxOnclick() {
		var Source = window.event.srcElement;//指向触发事件的元素
		//var b = Source.value;
		//alert("tagName : " + Source.tagName + "\n" + "value : " + Source.value );
		//var radio_value = $("input[type=radio]").val();

		var arr_checkbox = document.getElementsByName("checkbox");
		for (var i = 0; i < arr_checkbox.length; i++) {
			if ($("input[name='checkbox']:checked").length > 1) {
				//Dialog.alert("此处只能选择一项");
				$("input[name='checkbox']").attr("checked", false);
				//对当前点击的checkbox置空
				Source.checked = true;
			}
			//checkbox不为空
			if ($("input[name='checkbox']:checked").length == 0) {
				Source.checked = true;
			}
			var a = arr_checkbox[i].value;
			if(arr_checkbox[i].checked == true && a.substr(0,4)=="0043"){
				$("#qxtr").hide();
				$("#cstr").hide();
				$("#yjtr").hide();
				$("#anyou").show();
				var au=$("#"+a).html();//案由
				$("#au").html(au); 
				return ;
			}
			if (arr_checkbox[i].checked == true) {
				text = $("input[name=checkbox]:checked").next().text();
				$("#au").text(text);
				$("#qxtr").show();
				$("#anyou").hide();
				addqx(a);
			}
			if (arr_checkbox[i].checked == false) {
				$("#span_qx" + a + "").html("");
			}
		}
	}
	//添加失信情形
	function addqx(id) {
		$.ajax({
			type : "post",
			url : "${base}/private/sxcj/sxqxAjax?sxxwid=" + id,
			dataType : "json",
			success : function(res) {
				var qx = "";
				var old_name = "";
				$.each(
						res,
						function(n, array) {
							if (old_name != array.sxqx) {
								old_name = array.sxqx;
								qx += "<span id='span_qx"+id+"'><input style='vertical-align: middle;' type='checkbox' id='checkbox_qx"
										+ id
										+ "' name='checkbox_qx' onclick='addcs();' value='"
										+ array.id
										+ "'/><span>"
										+ array.sxqx
										+ "</span></br></span>";
							}
						})
				$("#qx_td").html(qx+"<hr />");
			}
		});
	}

	//添加惩戒措施
	function addcs() {
		var Source = window.event.srcElement;//指向触发事件的元素
		var id = Source.value;//获取当前点击框value
		var bz = $("#bz1").val();

		var arr_checkbox = document.getElementsByName("checkbox_qx");
		//单选 
		for (var i = 0; i < arr_checkbox.length; i++) {
			var a = arr_checkbox[i].value;
			if ($("input[name=checkbox_qx]:checked").length > 1) {
				$("input[name='checkbox_qx']").attr("checked", false);
				//对当前点击的checkbox置空
				Source.checked = true;
			}
		}
		for (var i = 0; i < arr_checkbox.length; i++) {
			if (arr_checkbox[i].checked == true) {
				var text = "";//单选存储
				text = $("input[name=checkbox_qx]:checked").next().text();
				$("#sxqx_name").val(text);
				$.ajax({
					type : "post",
					url : "${base}/private/sxcj/cjcsAjax?sxqxid=" + id,
					dataType : "json",
					data : $("#form1").serialize(),
					success : function(res) {
						var cs = "";
						$.each(res,function(n, array) {
							cs += "<span id='span_cs"+id+"'><input style='vertical-align: middle;' type='checkbox' id='checkbox_cs"+id+"' name='checkbox_cs' value='"+array.id+"'/>"
									+ array.cjcs
									+ "</br></span>";
						})
						$("#cs_td").html(cs+"<hr />");
					}
				});
				$.ajax({
					type : "post",
					url : "${base}/private/sxcj/yjAjax?id=" + id,
					dataType : "json",
					success : function(res) {
						var yj = "";
						var yj_name = "";
						$.each(res, function(n, array) {
							if (yj_name != array.name) {
								yj_name = array.name;
								yj += array.yj;
							}
						})
						$("#yj_textarea").text(yj);
					}
				});
			}
			if (arr_checkbox[i].checked == false) {
				$("#span_cs" + a + "").html("");
			}
		}
		$("#cstr").show();
		$("#yjtr").show();
	}

	var ztMap = $ztHt;
	//选择失信惩戒中的信用主体
	function toAddsxcj() {
		var xy_type = $("#xzcf_type").val();
		if (xy_type == "" || xy_type == null) {
			Dialog.alert("请先选择行政处罚类型！");
			return;
		}

		$("#xm_name").val("");
		$("#contract_id").val("");

		var d = new Dialog("Addfr");
		d.Width = 900;
		d.Height = 450;
		d.Title = "添加信用主体";
// 		d.URL = "${base}/private/xzcf/toAddfr?xy_type=" + xy_type;
		d.URL = "${base}/private/jlxx/toAddfr?ctype=1";
		d.OKEvent = function() {
			if ($DW.doSave()) {
				var ids = $DW.$("#checkids_id").val();
				var names = $DW.$("#checkids_name").val();
				var types = $DW.$("#checkids_type").val();
				var contract_id = $DW.$("#contract_id").val();
				//alert("xyzt_id:"+ids+""+"contract_id:"+contract_id);
				$("#xyzt_name").val(names);
				$("#xyzt_id").val(ids);
				$("#xyzt_type").val(ztMap[types]);
				$("#contract_id").val(contract_id);
				$("#xwtr").show();
				$D.close();
// 				findHtmc(contract_id);
			}
		}
		d.show();
	}

	function findht(){
		var xy_type = $("#xzcf_type").val();
		if (xy_type == "" || xy_type == null) {
			Dialog.alert("请先选择行政处罚类型！");
			return;
		}
		var xyztid=$("#xyzt_id").val();
		if(xyztid == "" || xyztid == null){
			Dialog.alert("请先选择行信用主体！");
			return;
		}
		var d = new Dialog("findhthtml");
		d.Width = 900;
		d.Height = 450;
		d.Title = "关联合同";
		d.URL = "${base}/private/common/findHt?xy_type="+xy_type+"&xyzt_id="+xyztid;
// 		d.URL = "${base}/private/formyy/selectHt?xyml="+xy_type+"&type="+ctype;
		d.OKEvent = function() {
			if ($DW.doSave()) {
				var ids = $DW.$("#checkids_id").val();
				var names = $DW.$("#checkids_name").val();
				$("#xm_name").val(names);
				$("#contract_id").val(ids);
				$D.close();
// 				findHtmc(contract_id);
			}
		}
		d.show();
	}

	//查询合同名称
	function findHtmc(id) {
		if (!id) {
			return;
		}
		var xy_type = $("#xzcf_type").val();
		jQuery.ajax({
			type : 'POST',
			url : "${base}/private/xzcf/tofindHtmc?htid=" + id + "&xy_type="
			+ xy_type,
			success : function(res) {
				$("#xm_name").val(res);
			},
			fail : function(res) {
				Dialog.alert("系统错误?!");
			}
		});
	}

	//添加操作
	function doSave(status) {
		setFile1(form1.sbfile);
		document.getElementById("status").value=status;
		if (Verify.hasError()) {
			return;
		}
		if ($("input[name=checkbox]:checked").length == 0) {
			Dialog.alert("请选择失信行为");
			return;
		}
		var checkbox_str = [];
		$('input[name="checkbox"]:checked').each(function() {
			checkbox_str.push($(this).val());
			$("#sxxw_id").val($(this).val());
		});
		if($("#sxxw_id").val().substr(0,4)!="0043"){
			if ($("input[name=checkbox_qx]:checked").length == 0) {
				Dialog.alert("请选择失信情形");
				return;
			}
			if ($("input[name=checkbox_cs]:checked").length == 0) {
				Dialog.alert("请选择惩戒措施");
				return;
			}

			var checkbox_qx_str = [];
			$('input[name="checkbox_qx"]:checked').each(function() {
				checkbox_qx_str.push($(this).val());
			});
			var checkbox_cs_str = [];
			$('input[name="checkbox_cs"]:checked').each(function() {
				checkbox_cs_str.push($(this).val());
			});
//			$("#sxxw_id").val(checkbox_str);
			$("#sxqx_id").val(checkbox_qx_str);
			$("#cjcs_id").val(checkbox_cs_str);
		}else{
			$("#sxqx_id").val(" ");
			$("#cjcs_id").val(" ");
		}
//		alert("aaaa : "+$("#sxxw_id").val());
//		return ;
		//添加上传路径html
		$("#file_html").val(encode64($("#file_list").html()));
		jQuery.ajax({
			type : 'POST',
			url : "${base}/private/xzcf/addSave",
			data : $("#form1").serialize(),
			success : function(res) {
				if (res == "true") {
					Dialog.alert("添加成功！", function() {
						refreshloadDataTab();
					});
				} else {
					Dialog.alert("添加失败！");
				}
				return false;
			},
			fail : function(res) {
				Dialog.alert("系统错误?!");
			}
		});
	}

	function setFileList(filePath, fileName, fileSize) {
		$("#file_list").html(
				"&nbsp;<a href='${base}"+filePath+"' >" + fileName + "("
				+ fileSize + "MB)</a><br />");
	}

	window.onload = function() {

		checkboxOnclick();
		$("#xwtr").hide();
		$("#qxtr").hide();
		$("#cstr").hide();
		$("#yjtr").hide();
		$("#anyou").hide();
	}
</script>
</body>
</html>