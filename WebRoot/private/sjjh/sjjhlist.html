<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html style="overflow-y:auto">
<head>
    <title>$!app_name</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <!-- 框架 -->
    <link href="${base}/include/css/default.css" rel="stylesheet" type="text/css"/>
    <script type='text/javascript'>
        var CONTEXTPATH = '${base}';
        var stylePath = '$!stylename';

    </script>
    <script src="${base}/include/js/main.js"></script>
    <script src="${base}/include/js/string.js"></script>
    <!-- 分页  注意顺序 -->
    <link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css"/>
    <script src="${base}/include/js/jquery.easyui.min.js"></script>
    <!-- 树 -->
    <script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
    <link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
	<script src="${base}/include/js/ajaxfileupload.js"></script>
    <script>
       
        function getWidth(percent){
            return document.body.clientWidth*percent;
        }
        var zjxxHt=$!zjxxHt;
        function loadData(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/sjjh/getlist",//首次查询路径
                queryParams:{"type":$("#type").val()},//首次查询参数
                idField:"jlid",
                treeField:"name",
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "loginname",
                        title : "操作人",
                        align : "center",
                        width : 120
                    },
                    {
                        field : "type",
                        title : "类型",
                        align : "center",
                        width : 100,
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                            	val=zjxxHt[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "time",
                        title : "操作时间",
                        align : "center",
                        width : 100
                    },
                    {
                        field : "content",
                        title : "操作情况",
                        align : "center",
                        width : 400
                    },
                    {
                        field : "f",
                        title : "操作",
                        align : "center",
                        width : 60,
                        formatter : function(val,rec){
                            var s3 = "<a href='javascript:detail("+rec.id+");'>浏览</a>";
                            return s3;
                        }
                    }
                ] ],
                /*frozenColumns:[[
                    {field:"id",checkbox:true}
                ]],*/
                onDblClickRow:function(row)
                {
                    toupdate(row.id);
                }
                
                //,
                // onLoadSuccess:function(){
                //   initCheckbox();
                // }

            });
            //设置分页控件  
            var p = $("#dg1").datagrid("getPager");  
            $(p).pagination({  
                beforePageText: "第",//页数文本框前显示的汉字  
                afterPageText: "页    共 {pages} 页",  
                displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",  
                onBeforeRefresh:function(){ 
                } 
            }); 
            
        }
        
        //浏览页面
        function detail(id){
            var iHeight = 300;
            var iWidth = 600;
            var iTop = (window.screen.height-30-iHeight)/2;//获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2;//获得窗口的水平位置;
            window.open("${base}/private/sjjh/detail?id="+id, "浏览息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }
            
       
        Page.onLoad(function() {
            loadData();

        });
        $(window).resize(function () {
            clearTimeout(timer);
            timer=setTimeout(function(){
                $('#dg1').datagrid('resize');
                $('div.panel-body').css('width','auto'); //////
            },100);
        });
        function ajaxFileUpload()
    	{
        	if($("#f").val()==""){
        		Dialog.alert("请选择上传文件！");
        		return ;
        	}
    	 	Page.MinMessage.Show({
    	        text: '正在上传中', 
    	        type: 'load' 
    	    });
    		jQuery.ajaxFileUpload
    		(
    			{
    				url:'${base}/private/file/uploadSaveForSjjh',
    				secureuri:true,
    				fileElementId:'f',
    				dataType: 'json',
    				beforeSend:function()
    				{ 
    					
    				},
    				complete:function()
    				{ 
    					Page.MinMessage.Hide();
    				},				
    				success: function (data, status)
    				{
    					if(typeof(data.error) != 'undefined')
    					{
    						if(data.error != '')
    						{
    							Dialog.alert(data.error);
    						}else
    						{
    							var obj=data.msg;
    							$("#filename").val(obj.filename);
    							$("#filepath").val(obj.filepath);
    							$("#filesize").val(obj.filesize);
    							doSave();
    						}
    					}
    				},
    				error: function (data, status, e)
    				{
    					Dialog.alert(e);
    				}
    			}
    		)
    		 
    		return false;

    	}
        function exportExcel(){
        	form1.action='${base}/private/sjjh/exportExcel?type='+$("#type").val()+'&xytype='+$("#xytype").val();
        	form1.submit();
        }
        function doSave(){
        	jQuery.ajax({
        		type : 'POST',
        		url : "${base}/private/sjjh/importExcel",
        		data : $("#form1").serialize(),
        		timeout : 60000,
        		success : function(res) {
        			if (res == "true") {
        					Dialog.alert("操作成功！", function() {
        						loadData();
        					});
        			} else {
        				alert("操作失败！");
        			}
        			return false;
        		},
        		error : function(res) {
        			alert("系统错误!");
        		}
        	});
        }
    </script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
   <form name='form1' id="form1" method='post' enctype="multipart/form-data">
       <input type="hidden" name="doAction" value=""> 
       <input type="hidden" name="sys_menuid" value="$!sys_menuid"> 
       <input type="hidden" name="checkids" value=""> 
       <input type="hidden" name="deltype" value="1">
       <input type="hidden" name="filename" id="filename" value="">
<input type="hidden" name="filepath" id="filepath" value="">
<input type="hidden" name="filesize" id="filesize" value="">
<div region="north" border="false" style="overflow: hidden; padding: 10px 10px 0px 10px">
		<table width="100%" border="0" cellspacing="0" cellpadding="0"
                       class="blockTable">
                    <tr>
                        <td class="blockTd">
                            <table width="100%" border="0" cellspacing="0" cellpadding="6">
                                <!-- <tr>
                                    <td valign="middle"><img
                                            src="${base}/images/icons/icon042a4.gif"
                                            width="20" height="20" />&nbsp;#if($type)$!zjxxHt.get("$!type")#else 数据交换#end</td>
                                </tr> -->
                                <tr>
                                        <td style="padding: 8px 0 4px 6px;" nowrap="nowrap">
                                            #if($type)
                                            <input type="hidden" name="type" id="type" value="$!type">
                                            #else 
                                            &nbsp; 交换类型：<select name="type" id="type">
                                                                    <option value="">请选择</option>
                                                                    #foreach($!obj in $!zjxxList)
                                                                    <option value="$!obj.value">$!obj.name</option>
                                                                    #end
                                                               </select> #end
                                        #if("$type"=="3"||"$type"=="4")
                                        &nbsp; 信用类型：<select id="xytype" name="xytype" verify="信用目录|NotNull">
                                 <option value="">请选择</option>
                                 #foreach($obj in $csvalueList)
                                     <option value="$!obj.value">
                                         <script type="text/javascript">
                                             document.write(gettreecode('$!obj.value'));
                                         </script>$!obj.name
                                     </option>
                                 #end
                             </select>#end
                                        &nbsp; 选择文件：<input type="file" name="f" id="f"/>
                                        &nbsp;<input type="button" value="导入" onclick="ajaxFileUpload()">
                                       #if("$type"=="3")
                                       &nbsp;<input type="button" value="导出" onclick="exportExcel()">
                                       #end
                                       #if(!$type)
                                        &nbsp;
                                        <input type="button" name="check" id="check" value="查询" onclick="loadData();"></input>
                                        #end
                                        </td>
                                </tr>
                            </table></td></tr></table>
                            </div>
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<div id="dg1" style="width: 100%; height: 100%;"></div>
	</div>
            </form>
</body>
</html>
