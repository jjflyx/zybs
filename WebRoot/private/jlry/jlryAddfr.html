<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>$!app_name</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- 框架 -->
    <link rel="stylesheet" type="text/css" href="${base}/include/css/default.css"/>
    <script type='text/javascript'>
        var CONTEXTPATH = '${base}';
        var stylePath = '$!stylename';
    </script>
    <script src="${base}/include/js/main.js"></script>
    <script src="${base}/include/js/string.js"></script>
    <!-- 分页  注意顺序 -->
    <link href="${base}/include/css/themes/gray/easyui.css"
          rel="stylesheet" type="text/css" />
    <script src="${base}/include/js/jquery.easyui.min.js"></script>
    <!-- 树 -->
    <script type="text/javascript"
            src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
    <link rel="stylesheet"
          href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css"
          type="text/css">

    <script>
        
        function getWidth(percent){
            return document.body.clientWidth*percent;
        }

        //加载列表数据
        function loadGrid(){
            var v = Page.getValue("xyzt_type");

            if(v == 0){
                loadData1();
            }
            if(v == 1){
                loadData();
            }
            if(v == 2){
                loadData2();
            }
            if(v == ""){
                loadData3();
            }

            //设置分页控件
            var p = $("#dg1").datagrid("getPager");
            $(p).pagination({
                beforePageText: "第",//页数文本框前显示的汉字
                afterPageText: "页    共 {pages} 页",
                displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
                onBeforeRefresh:function(){
                }
            });
            $("#dg1").datagrid("clearSelections");
        }

        var ztMap = $!ztMap;

        //法人datagrid
        function loadData(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/jlxx/addFrlist",//首次查询路径
                queryParams:{"tname":"$!tname","xytype":"$!xytype","xyzt_name":$("#xyzt_name").val(),"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"id",
                treeField:"name",
                remoteSort:false,
                #if($!ctype==0)
                	singleSelect:false,//是否单选
                #else
                	singleSelect:true,//是否单选
                #end
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        align :"center",
                        width : 200
                    },
                    {
                        field : "type",
                        title : "信用主体类型",
                        align :"center",
                        width : 80,
                        formatter : function(val,rec){
                            if(val != "" && val != null){
                                val = ztMap[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "fr_name",
                        title : "法定代表人姓名",
                        align :"center",
                        width : getWidth(0.15)
                    },
                    {
                        field : "phone",
                        title : "联系人手机号",
                        align :"center",
                        width : getWidth(0.10)
                    }

                ] ],
                frozenColumns:[[
                       #if($!ctype==0) //多选
                       	{field:"id",checkbox:true}
                       #else//单选
                       	{field:"id",formatter:function(value,rec){
   	       	            		 return '<input  name=\"id\" value='+value+' type=\"radio\"/>';
                          		}
                       	}
                       #end
                ]],
                onDblClickRow:function(row)
                {
                    toupdate(row.id);
                }
                //,
                // onLoadSuccess:function(){
                //   initCheckbox();
                // }

            });
            
        }

        //自然人datagrid
        function loadData1(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/jlxx/addFrlist",//首次查询路径
                queryParams:{"xyzt_name":$("#xyzt_name").val(),"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"id",
                treeField:"name",
                remoteSort:false,
                #if($!ctype==0)
                	singleSelect:false,//是否单选
                #else
                	singleSelect:true,//是否单选
                #end
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        align :"center",
                        width : 200
                    },
                    {
                        field : "type",
                        title : "信用主体类型",
                        align :"center",
                        width : 80,
                        formatter : function(val,rec){
                            if(val != "" && val != null){
                                val = ztMap[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "code",
                        title : "身份证号",
                        align : "center",
                        width : 150
                    },
                    {
                        field : "phone",
                        title : "手机号",
                        align : "center",
                        width : 100
                    }
                ] ],
                frozenColumns:[[
                                #if($!ctype==0) //多选
                               	{field:"id",checkbox:true}
                               #else//单选
                               	{field:"id",formatter:function(value,rec){
           	       	            		 return '<input  name=\"id\" value='+value+' type=\"radio\"/>';
                                  		}
                               	}
                               #end
                ]],
                onDblClickRow:function(row)
                {
//                     toupdate(row.id);
                }
                //,
                // onLoadSuccess:function(){
                //   initCheckbox();
                // }

            });
        }

        //其他组织机构datagrid
        function loadData2(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/jlxx/addFrlist",//首次查询路径
                queryParams:{"xyzt_name":$("#xyzt_name").val(),"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"id",
                treeField:"name",
                //remoteSort:false,
                #if($!ctype==0)
                	singleSelect:false,//是否单选
                #else
                	singleSelect:true,//是否单选
                #end
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        align :"center",
                        width : 200
                    },
                    {
                        field : "type",
                        title : "信用主体类型",
                        align :"center",
                        width : 80,
                        formatter : function(val,rec){
                            if(val != "" && val != null){
                                val = ztMap[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "fzr",
                        title : "负责人姓名",
                        align : "center",
                        width : 150
                    },
                    {
                        field : "phone",
                        title : "手机号码",
                        align : "center",
                        width : 100
                    }
                ] ],
                frozenColumns:[[
                                #if($!ctype==0) //多选
                               	{field:"id",checkbox:true}
                               #else//单选
                               	{field:"id",formatter:function(value,rec){
           	       	            		 return '<input  name=\"id\" value='+value+' type=\"radio\"/>';
                                  		}
                               	}
                               #end
                ]],
                onDblClickRow:function(row)
                {
//                     toupdate(row.id);
                }
            });
        }

        function loadData3(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: false,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/jlxx/addFrlist",//首次查询路径
                queryParams:{"tname":"$!tname","xytype":"$!xytype","xyzt_name":$("#xyzt_name").val(),"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"id",
                treeField:"name",
                remoteSort:false,
                #if($!ctype==0)
                	singleSelect:false,//是否单选
                #else
                	singleSelect:true,//是否单选
                #end
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        align :"center",
                        width : 200
                    },
                    {
                        field : "type",
                        title : "信用主体类型",
                        align :"center",
                        width : 80,
                        formatter : function(val,rec){
                            if(val != "" && val != null){
                                val = ztMap[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "code",
                        title : "统一社会信用代码",
                        align : "center",
                        width : 150
                    },
                    {
                        field : "phone",
                        title : "联系人手机号",
                        align : "center",
                        width : 100
                    }
                ] ],
                frozenColumns:[[
                                #if($!ctype==0) //多选
                               	{field:"id",checkbox:true}
                               #else//单选
                               	{field:"id",formatter:function(value,rec){
           	       	            		 return '<input  name=\"id\" value='+value+' type=\"radio\"/>';
                                  		}
                               	}
                               #end
                ]],
                onDblClickRow:function(row)
                {
//                     toupdate(row.id);
                }

            });
        }
        
        var frWindow;
        var xxWindow;

        function doSave(){
            var ids=[];
            var names = [];
            var types = [];
            var codes = [];
            var arr = $('#dg1').datagrid('getSelections');
            if(!arr || arr.length==0){
                Dialog.alert("请选信用主体！！");
                return false;
            }
            for(var i=0;i<arr.length;i++){
                ids.push(arr[i].id);
                types.push(arr[i].type);
                names.push(arr[i].name);
                codes.push(arr[i].code);
            }
            //alert("ids:"+ids+" "+"names:"+names+" "+"types:"+types+" "+"codes:"+codes);
            $("#checkids_id").val(ids);
            $("#checkids_name").val(names);
            $("#checkids_type").val(types);
            $("#checkids_code").val(codes);
            return true;
        }
        Page.onLoad(function() {
            loadGrid();
        });
        $(window).resize(function () {
            clearTimeout(timer);
            timer=setTimeout(function(){
                $('#dg1').treegrid('resize');
                $('div.panel-body').css('width','auto'); //////
            },100);
        });
        
        //转到新增页面
		function addFr()
		{
			var type = 1;
			var typeName = "";
			switch(type)
			{
				case 0:
					typeName = "添加自然人信息";
					break;
				case 1:
					typeName = "添加法人信息";
					break;
				case 2:
					typeName = "添加其他组织信息";
					break;
				default :
					typeName = "";break;
			}
			var iHeight = 440;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			frWindow = window.open ("/gtxt/private/gtxt/xyzt/toadd?type="+type,typeName, 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}
		
		 //转到新增页面
        function addzz()
        {   var xy_type = $("#xytype").val();
            var iHeight = 500;
            var iWidth = 850;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            xxWindow = window.open ("${base}/private/zzxx/tdpg/toadd?xy_type="+xy_type, "添加资质信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }
        
        function closeCur(){
        	if(frWindow){
        		frWindow.close();
        	}	
        	if(xxWindow){
        		xxWindow.close();
        	}	
        }
        
    </script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout" onunload="closeCur()">
<form name='form1' id="form1" method='post'>
    <input type="hidden" name="doAction" value="">
    <input type="hidden" name="sys_menuid" value="$!sys_menuid">
    <input type="hidden" name="checkids_id" id="checkids_id" value="">
    <input type="hidden" name="checkids_name" id="checkids_name" value=""/>
    <input type="hidden" name="checkids_type" id="checkids_type" value=""/>
    <input type="hidden" name="checkids_code" id="checkids_code" value=""/>
    <input type="hidden" name="xytype" id="xytype" value="$!xytype"/>
    <input type="hidden" name="deltype" value="1">

    <div region="north" border="false"
         style="overflow: hidden; padding: 10px 10px 0px 10px">
        <table width="100%" border="0" align="center" cellpadding="0"
               cellspacing="0">

            <tr>
                <td>
                    <div class="czbutton">
                        <ul>
                            <li id='BtnChk'>
                            <span style="float:left;">
                                信用主体类型：<select id="xyzt_type" name="xyzt_type" onchange="loadGrid();">
                                #if($!ztlxlist.size()>1)
                                <option value="">请选择</option>
                                #end
                                #foreach($!obj in $!ztlxlist)
                                <option value="$!obj.value">$!obj.name</option>
                                #end
                            </select>
                                &nbsp;
                                信用主体：<input type="text" name="xyzt_name" id="xyzt_name" size="20"/>
                                <input type="button" name="check" id="check" value="查询" onclick = "loadGrid();"/>
                                &nbsp;&nbsp;
                                <input type="hidden" name="frname" id="frname" value=""/>
                          </span> <span style="float:right;">
                          #if($!frbutton!=1)
								<a
										href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn'
										hidefocus='true' tabindex='-1' onselectstart='return false'
										id='a' onClick="addFr();"><img
										src="/gtxt/images/icons/icon022a2.gif"
										width="20" height="20" /><b>法人信息&nbsp;</b></a>
										#end
								#if($!tname=="zz_info")
								<a href ='javascript:void(0);' ztype='zPushBtn'
                                                      class='zPushBtn' hidefocus='true' tabindex='-1'
                                                      onselectstart='return false' id='a' onClick="addzz();">
                                                  <img src="${base}/images/icons/icon022a2.gif" width="20"
                                                      height="20" />
                                                  <b>资质信息&nbsp;</b></a>
                                                  #end
                                                  </span>
                            </li>

                        </ul>
                    </div>
                    <div class="clear"></div>
                </td>
            </tr>

        </table>
    </div>
    <div region="center" border="false"
         style="width: 100%; height: 100%; padding: 0px 10px 10px;">
        <div id="dg1" style="width: 100%; height: 100%;"></div>
    </div>


</form>

</body>
</html>
