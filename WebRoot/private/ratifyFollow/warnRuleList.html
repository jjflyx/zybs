<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- 框架 -->
	<link rel="stylesheet" type="text/css" href="${base}/include/css/default.css"/>
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!-- 分页  注意顺序 -->
	<link href="${base}/include/css/themes/gray/easyui.css"
		  rel="stylesheet" type="text/css" />
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<script src="${base}/include/js/map.js"></script>
	<!-- 树 -->
	<script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
	<link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
	<script type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>

	<script>
		var xylxMap=$!xylxMap;
		var sxxwMap=$!sxxwMap;
		var sxqxMap=$!sxqxMap;

		var units=0;
		var index=0;
		var typesvalues=new Array(units);
		function showtype(idvalue){
			if(idvalue!=""){
				for(var i=0;i<typesvalues.length;i++){
					if(typesvalues[i][0]==idvalue){
						selected(document.form1.unittype,typesvalues[i][1]);
						break;
					}
				}
			}else{
				selected(document.form1.unittype,'0');
			}
		}

		function getWidth(percent){
			return document.body.clientWidth*percent;
		}

		//加载列表数据
		function loadGrid(){
			loadData();
			//设置分页控件
			var p = $("#dg1").datagrid("getPager");
			$(p).pagination({
				beforePageText: "第",//页数文本框前显示的汉字
				afterPageText: "页    共 {pages} 页",
				displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
				onBeforeRefresh:function(){
				}
			});
			$("#dg1").datagrid("clearSelections");
		}

		function loadData(){
			$("#dg1").datagrid({
				width:"auto",
				height:"auto",
				nowrap: true,
				striped: true,
				border: true,
				collapsible:false,//是否可折叠的
				url : "${base}/private/gtxt/rule/list",//首次查询路径
				queryParams:{"keyword":$("#keyword").val(),"xy_type":$("#xy_type").val(),"is_work":$("#is_work").val()},//首次查询参数
				idField:"id",
				treeField:"name",
				remoteSort:false,
				singleSelect:false,//是否单选
				rownumbers:true,//行号
				fit: true,//自动大小
				fitColumns: true,//行自适应
				pagination:true,//分页控件
				loadMsg:'数据加载中...',
				columns : [ [
					{
						field : "rule_name",
						title : "规则名称",
						width : getWidth(0.20),
						align : 'left',
						formatter:function(value,row,index){
							var sub = "";
							if(value.length > 12){
								sub = value.substring(0, 12)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;
						}
					},
					{
						field : "xy_type",
						title : "所属类别",
						width : getWidth(0.15),
						align : 'center',
						formatter:function(value,row,index){
							if (value != null && value != "") {
								value = xylxMap[value];
							}
							return value;
						}
					},
					{
						field : "sxxw_id",
						title : "失信行为",
						width : getWidth(0.36),
						align : 'left',
						formatter:function(value,row,index){
							if (value != null && value != "") {
								value = sxxwMap[value];
							}
							var sub = "";
							if(value != null &&value.length > 18){
								sub = value.substring(0, 18)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;
						}
					} ,
					{
						field : "sxqx_id",
						title : "具体情形",
						width : getWidth(0.24),
						align : 'left',
						formatter:function(value,row,index){
							if (value != null && value != "") {
								value = sxqxMap[value];
							}
							var sub = "";
							if(value != null &&value.length > 12){
								sub = value.substring(0, 12)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;
						}

					},
					{
						field:"is_work",
						title:"当前状态",
						width:getWidth(0.08),
						align : 'center',
						formatter:function(value,row,index){
							return value==1 ? "<sapn style='color:#0970bf;'>启用</sapn>":"<span style='color:indianred;'>禁用</span>";
						}
					},
					{
						field:"cjqx",
						title:"惩戒期限",
						width:getWidth(0.10),
						align : 'center',
						formatter:function(value,row,index){
							return value + " 个月"
						}
					},
					{
						field:"add_time",
						title:"添加时间",
						width:getWidth(0.18),
						align : 'center'
					},
					{
						field:"bb",
						title:"操作",
						width:getWidth(0.15),
						align : 'center',
						formatter: function(value,row,index){
							var s1="处理";
							var s2 = "";
							var s3 = "修改";
							if(!$("#BtnUpdate").hasClass("zPushBtnDisabled")){
								s3="<a href='javascript:update(\""+row.id+"\")'>修改</a>";
							}
							s1="<a href='javascript:show(\""+row.id+"\");'>查看</a>";
							if(row.is_work==1){
								s2 = "<a href='javascript:changeState(\""+row.id+"\",0)'>禁用</a>";
							}else{
								s2 = "<a href='javascript:changeState(\""+row.id+"\",1)'>启用</a>";
							}
							return s1+" | "+s2 + " | " + s3;
						}
					}
				] ],
				frozenColumns:[[
					{field:"id",checkbox:true}
				]],
				onDblClickRow:function(value,row,index)
				{
					show(row.id);
				}
			});
		}

		function changeState(id,type){
			var str = type==1? "启用" : "禁用";
			Dialog.confirm("确定执行"+str+"预警规则操作？！",function(){
				jQuery.ajax({
					type: 'POST',
					url : "${base}/private/gtxt/rule/changeState" ,
					data : {"id":id,"type":type},
					success : function (res) {
						if(res=="true"){
							Dialog.alert(str+"成功!",function(){
								loadGrid();
							});
						}else{
							Dialog.alert("操作失败！");
						}
						return false;
					},
					fail : function(res) {
						Dialog.alert("系统错误?!");
					}
				});
			});
		}

		//转到新增页面
		function add()
		{
			var iHeight = 620;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			window.open ("${base}/private/gtxt/rule/toAdd", "添加预警规则", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		function show(id){
			var iHeight = 570;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			window.open ("${base}/private/gtxt/rule/view?id="+id, "预警规则查看", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		function addSave(){
			jQuery.ajax({
				type: 'POST',
				url : "${base}/private/zjgl/fr/add" ,
				data : $DW.$("#form1").serialize(),
				success : function (res) {
					if(res=="true"){
						$D.close();
						Dialog.alert("添加成功！");
						loadData();
					}else{
						Dialog.alert("添加失败！");
					}

					return false;
				},
				fail : function(res) {
					Dialog.alert("系统错误?!");
				}
			});
		}
		//转到修改页面
		function openWind() {
			var arr = $('#dg1').treegrid('getSelections');
			if (arr && arr.length != 0) {
				openWind();
			}else{
				Dialog.alert("请先选择要修改的预警信息！");
			}
		}

		//转到修改页面
		function update(id){
			var iHeight = 620;
			var iWidth = 800;
			var iTop = (window.screen.height - 30 - iHeight) / 2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width - 10 - iWidth) / 2; //获得窗口的水平位置;
			window.open("${base}/private/gtxt/rule/toUpdate?id="+id, "修改预警信息", 'height=' + iHeight + ',,innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		function del() {
			var ids = [];
			var arr = $('#dg1').datagrid('getSelections');
			if (!arr || arr.length == 0) {
				Dialog.alert("请先选择要删除的预警规则！");
				return;
			}
			for(var i=0; i<arr.length; i++){
				ids.push(arr[i].id);
			}
			Dialog.confirm("注意：您确认要删除吗？", function() {
				jQuery.ajax({
					url : "${base}/private/gtxt/rule/deleteIds?ids="+ids,
					success : function (res) {
						if(res=="true"){
							Dialog.alert("删除成功！");
							loadData();
						}else{
							Dialog.alert("删除失败！");
						}
						return false;
					},
					fail : function(res) {
						Dialog.alert("系统错误?!");
					}
				});
			});
		}

		Page.onLoad(function() {
			loadGrid();
		});
		$(window).resize(function () {
			clearTimeout(timer);
			timer=setTimeout(function(){
				$('#dg1').treegrid('resize');
				$('div.panel-body').css('width','auto'); //////
			},100);
		});
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
	<div region="north" border="false"
		 style="overflow: hidden; padding: 10px 10px 0px 10px">
		<table width="100%" border="0" align="center" cellpadding="0"
			   cellspacing="0" class="blockTable">
			<tr>
				<td valign="middle"><img src="${base}/images/icons/icon021a1.gif" width="20" height="20" />
					&nbsp;<span>预警记录</span></td>
			</tr>
			<tr>
				<td style="padding: 8px 0 4px 6px;" id="btnlist">
													<span style="float: left;">
														规则名称：
														<input type="text" name="keyword" id="keyword" />
														信用类别：
														<select	name="xy_type" id="xy_type">
															<option value="0">全部</option>
															#if($csValues)
															#foreach($obj1 in $csValues)
															<option value="$!obj1.code">
																<script type="text/javascript">
																	typesvalues[index]=new Array('$!obj1.code','$!obj1.value');
																	index++;
																	document.write(gettreecode('$!obj1.code'));
																</script>$!obj1.name
															</option>
															#end
															#end
														</select>
														当前状态：
														<select name="is_work" id="is_work">
															<option value="99">全部</option>
															<option value="1">启用</option>
															<option value="0">禁用</option>
														</select>
														&nbsp;
														<!--添加时间:  <input type="text" id="startTime" name="startTime" value="$!startTime"   style="width:160px;height:16px;background:#F4F9FB url(${base}/include/controls/my97/skin/datePicker.gif) no-repeat right;"-->
																	   <!--onclick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" >-->
                                                        <!--到 <input type="text" id="endTime" name="endTime" value="$!endTime"   style="width:160px;height:16px;background:#F4F9FB url(${base}/include/controls/my97/skin/datePicker.gif) no-repeat right;"-->
																 <!--onclick="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:ss'})" >-->
														<input type="button" name="check" id="check" onclick="loadGrid();" value="查询" />
													</span>
													<span style="float:right;">
															<a
																	href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn'
																	hidefocus='true' tabindex='-1' onselectstart='return false'
																	id='a' onClick="add();"><img
																	src="${base}/images/icons/icon022a2.gif"
																	width="20" height="20" /><b>新建&nbsp;</b>
															</a>
															<a
																	href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn'
																	hidefocus='true' tabindex='-1' onselectstart='return false'
																	id='c' onClick="del();"><img
																	src="${base}/images/icons/icon022a3.gif"
																	width="22" height="20" /><b>删除&nbsp;</b>
															</a>
													</span>
				</td>

			</tr>
		</table>
	</div>
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<div id="dg1" style="width: 100%; height: 100%;"></div>
	</div>
</form>

</body>
</html>