<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- 框架 -->
	<link rel="stylesheet" type="text/css" href="${base}/include/css/default.css"/>
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!-- 分页  注意顺序 -->
	<link href="${base}/include/css/themes/gray/easyui.css"
		  rel="stylesheet" type="text/css" />
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<!-- 树 -->
	<script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
	<link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
	<script type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>

	<script>
		function getWidth(percent){
			return document.body.clientWidth*percent;
		}

		//加载列表数据
		function loadGrid(){
			loadData();
			//设置分页控件
			var p = $("#dg1").datagrid("getPager");
			$(p).pagination({
				beforePageText: "第",//页数文本框前显示的汉字
				afterPageText: "页    共 {pages} 页",
				displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
				onBeforeRefresh:function(){
				}
			});
			$("#dg1").datagrid("clearSelections");
		}
		function reloadData(){
			$("#dg1").datagrid('reload');
		}

		function loadData(){
			$("#dg1").datagrid({
				width:"auto",
				height:"auto",
				nowrap: true,
				striped: true,
				border: true,
				collapsible:false,//是否可折叠的
				url : "${base}/private/gtxt/warn_info/list",//首次查询路径
				queryParams:{"keyword":$("#keyword").val(),"type":$("#type").val(),"xy_type":$("#xy_type").val()},//首次查询参数
				idField:"id",
				remoteSort:false,
				singleSelect:false,//是否单选
				rownumbers:true,//行号
				fit: true,//自动大小
				fitColumns: true,//行自适应
				pagination:true,//分页控件
				loadMsg:'数据加载中...',
				columns : [ [
					{
						field : "img",
						title : "预警",
						width : 40,
						align : 'center',
						formatter: function(value,row,index){
							if(row.day > 20){
								value = "green";
							}else if(row.day > 10){
								value = "yellow";
							}else{
								value = "red";
							}
							var html = "<img src=\"${base}/images/private/"+value+".gif\" width=\"25\" height=\"20\" />";
							return html;

						}
					},
					{
						field : "xyzt_name",
						title : "信用主体",
						width : getWidth(0.15),
						align : 'center',
						formatter: function(value,row,index){
							var sub = "";
							if(value.length > 12){
								sub = value.substring(0, 12)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;

						}
					},
					{
						field : "rule_name",
								title : "预警事项",
							width : getWidth(0.24),
							align : 'left',
							formatter:function(value,row,index){
								var sub = "";
								if(value.length > 12){
									sub = value.substring(0, 12)+"...";
								}else{
									sub = value;
								}
								var html = "<span title='"+value+"'>"+sub+"</span>";
								return html;
							}
					},
					{
						field:"day",
						title:"剩余天数",
						width:getWidth(0.06),
						align : 'center',
						formatter: function(value,row,index){
							return value + "（天）";
						}
					},
					{
						field:"bb",
						title:"操作",
						width:getWidth(0.16),
						align : 'center',
						formatter: function(value,row,index){
							var s1="立刻填报",s2="撤销预警";
							if(("$!xy_type"=="00030001"&&row.tablename!="l_tkht")||("$!xy_type"=="00030002"&&row.tablename!="l_ckqht")){
								s1="<a href='javascript:yjtb(\""+row.tablename+"\",\""+row.htid+"\");'>立刻填报</a>";
								s2="<a href='javascript:yjcx(\""+row.tablename+"\",\""+row.htid+"\");'>撤销预警</a>";
							}else{
								s1="<a href='javascript:tb(\""+row.formdefid_s+"\",\""+row.htid+"\");'>立刻填报</a>";
								s2="<a href='javascript:cx(\""+row.formdefid_y+"\",\""+row.htid+"\")'>撤销预警</a>";
							}
							
							var s3 = "<a href='javascript:checkSomeThing(\"刷新\")'>刷新</a>";
							return s1+" | "+s2;
						}
					}
				] ],
				onDblClickRow:function(row)
				{
//					toupdate(row.id);
				}
			});
		}
		function cx(tableId,id){
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			window.open ("${base}/private/formyy/toupdate?defid="+tableId+"&mainid="+id, "撤销预警", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		//转到新增页面
		function tb(tableId,id) {
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			window.open ("${base}/private/formyy/tomakeup?defid="+tableId+"&mainid="+id, "立刻填报", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}
		function yjcx(tablekey,id){
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			var url="";
			if(tablekey=="l_ckqbc"){
				url="${base}/private/contract/ck/bcfView?type=1&&id="+id;
			}else if(tablekey=="l_ckqhjhf"){
				url="${base}/private/contract/ck/dzhjView?type=1&&id="+id;
			}else if(tablekey=="l_ckqsyf"){
				url="${base}/private/contract/ck/syfView?type=1&&id="+id;
			}else if(tablekey=="l_tkqsyf"){
				url="${base}/private/contract/tk/syfView?type=1&&id="+id;
			}
			window.open (url, "撤销预警", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		//转到填报页面
		function yjtb(tablekey,id) {
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			var url="";
			if(tablekey=="l_ckqbc"){
				url="${base}/private/contract/ck/toBcfEdit?id="+id;
			}else if(tablekey=="l_ckqhjhf"){
				url="${base}/private/contract/ck/toDzhjEdit?id="+id;
			}else if(tablekey=="l_ckqsyf"){
				url="${base}/private/contract/ck/toSyfEdit?id="+id;
			}else if(tablekey=="l_tkqsyf"){
				url="${base}/private/contract/tk/toSyfEdit?id="+id;
			}
			window.open (url, "立刻填报", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		function show(){
			var type = $("#type").val() == "4" ? "4" : "1";
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
			window.open ("${base}/private/ratifyFollow/reality/miningPriceUpdate?yj=yj&type="+type, "预警信息查看", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		function update(){
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height - 30 - iHeight) / 2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width - 10 - iWidth) / 2; //获得窗口的水平位置;
			window.open("${base}/private/ratifyFollow/warnUpdate", "修改预警信息", 'height=' + iHeight + ',,innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}


		Page.onLoad(function() {
			loadGrid();
		});
		$(window).resize(function () {
			clearTimeout(timer);
			timer=setTimeout(function(){
				$('#dg1').treegrid('resize');
				$('div.panel-body').css('width','auto'); //////
			},100);
		});
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
	<input type="hidden" name="xy_type" id="xy_type" value="$!xy_type" />
	<div region="north" border="false" style="overflow: hidden; padding: 10px 10px 0px 10px">
		<table width="100%" border="0" align="center" cellpadding="0"
			   cellspacing="0" class="blockTable">
			<!-- <tr>
				<td valign="middle">
					<img src="${base}/images/icons/icon021a1.gif" width="20" height="20" />
					&nbsp;<span>预警记录</span>
				</td>
			</tr> -->
			<tr>
				<td style="padding: 8px 0 4px 6px;" id="btnlist">
													<span style="float: left;">
														预警等级：
														<select name="type" id="type" >
															<option value="0">全部</option>
															<option value="1">绿灯</option>
															<option value="2">黄灯</option>
															<option value="3">红灯</option>
														</select>&nbsp;
														信用主体：<input type="text" name="keyword" id="keyword" size="20" placeholder="信用主体..." />&nbsp;
														<input type="button" name="check" id="check" onclick="loadGrid();" value="查询" />
													</span>
				</td>
			</tr>
			<tr>
				<td>
					<span style="padding-left: 5px;color:#A52A2A">温馨提示：系统提前30天开始预警。红灯：剩余天数为0到10天，并包括逾期未填报的5天整改期(仅限价款)；黄灯：剩余天数为11到20天；绿灯：剩余天数为21到30天。</span>
				</td>
			</tr>
		</table>
	</div>
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<div id="dg1" style="width: 100%; height: 100%;"></div>
	</div>


</form>

</body>
</html>