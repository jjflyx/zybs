<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html style="overflow-y:auto">
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<!-- 框架 -->
	<link href="${base}/include/css/default.css" rel="stylesheet" type="text/css"/>
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!-- 分页  注意顺序 -->
	<link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css"/>
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<!-- 树 -->
	<script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
	<link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
	<link href="${base}/include/controls/my97/skin/WdatePicker.css" rel="stylesheet" type="text/css"/>
	<script language="javascript" type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
	<script>

		function getWidth(percent){
			return document.body.clientWidth*percent;
		}
		4
		var cjTable = $!cjTable;
		var ztTable = $!ztTable;

		function loadData (){
			if($("#type").val()=="1"){
				xzcfData();
			}else{
				xzqzData();
			}
		}

		function xzqzData(){
			$("#dg1").datagrid({
				width:"auto",
				height:"auto",
				nowrap: false,
				striped: true,
				border: true,
				collapsible:false,//是否可折叠的
				url : "${base}/private/gtxt/xyzt/xzqzlist",//首次查询路径
				queryParams:{"start_date":$("#startTime").val(),"end_date":$("#endTime").val(),"xyzt_type":$("#xyzt_type").val(),"unit":$("#unit").val(),
					"cfsx_date":$("#cfsx_date").val(),"xyzt_name":$("#xyzt_name").val(),"xzcf_zt":$("#xzcf_zt").val(),"code":$("#code").val()},//首次查询参数
				idField:"xzqzid",
				treeField:"name",
				singleSelect:false,//是否单选
				rownumbers:true,//行号
				fit: true,//自动大小
				fitColumns: true,//行自适应
				pagination:true,//分页控件
				loadMsg:'数据加载中...',
				columns : [ [
					{
						field : "name",
						title : "信用主体",
						align : "center",
						width : 310
					},
					{
						field : "xyzt_type",
						title : "信用主体类型",
						align : "center",
						width : getWidth(0.09),
						formatter : function(val,rec){
							if(val!=null && val!=""){
								val = ztTable[val];
							}
							return val;
						}
					} ,
					{
						field : "aj_name",
						title : "案件名称",
						align : "center",
						width : getWidth(0.20),
						formatter : function(value,row,index){
							var sub = "";
							if(value.length > 10){
								sub = value.substring(0,10)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;
						}
					},
					{
						field : "reason",
						title : "强制理由",
						align : "center",
						width : getWidth(0.25),
						formatter : function(value,row,index){
							var sub = "";
							if(value.length > 15){
								sub = value.substring(0,15)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;
						}
					},
					{
						field : "start_date",
						title : "处罚生效时间",
						align : "center",
						width : getWidth(0.10)
					},
					{
						field : "g",
						title : "操作",
						align : "center",
						width : getWidth(0.17),
						formatter : function(val,rec){
							var s2 = "<a href='javascript:qzDetail("+rec.xzqzid+");'>浏览</a>";
							return s2;
						}
					}
				] ],
				onDblClickRow:function(value,row,index)
				{
//                    update(row.id);
				}
			});
			//设置分页控件
			var p = $("#dg1").datagrid("getPager");
			$(p).pagination({
				beforePageText: "第",//页数文本框前显示的汉字
				afterPageText: "页    共 {pages} 页",
				displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
				onBeforeRefresh:function(){
				}
			});
			$("#dg1").datagrid("clearSelections");
		}

		function xzcfData(){
			$("#dg1").datagrid({
				width:"auto",
				height:"auto",
				nowrap: false,
				striped: true,
				border: true,
				collapsible:false,//是否可折叠的
				url : "${base}/private/gtxt/xyzt/xzcflist",//首次查询路径
				queryParams:{"start_date":$("#startTime").val(),"end_date":$("#endTime").val(),"xyzt_type":$("#xyzt_type").val(),"unit":$("#unit").val(),
					"cfsx_date":$("#cfsx_date").val(),"xyzt_name":$("#xyzt_name").val(),"xzcf_zt":$("#xzcf_zt").val(),"code":$("#code").val()},//首次查询参数
				idField:"xzcfid",
				treeField:"name",
				singleSelect:false,//是否单选
				rownumbers:true,//行号
				fit: true,//自动大小
				fitColumns: true,//行自适应
				pagination:true,//分页控件
				loadMsg:'数据加载中...',
				columns : [ [
					{
						field : "name",
						title : "信用主体",
						align : "center",
						width : 310
					},
					{
						field : "xyzt_type",
						title : "信用主体类型",
						align : "center",
						width : getWidth(0.09),
						formatter : function(val,rec){
							if(val!=null && val!=""){
								val = ztTable[val];
							}
							return val;
						}
					} ,
					{
						field : "au",
						title : "案由",
						align : "center",
						width : getWidth(0.25),
						formatter : function(value,row,index){
							var sub = "";
							if(value.length > 15){
								sub = value.substring(0,15)+"...";
							}else{
								sub = value;
							}
							var html = "<span title='"+value+"'>"+sub+"</span>";
							return html;
						}
					},
					{
						field : "cfsx_date",
						title : "处罚生效时间",
						align : "center",
						width : getWidth(0.10)
					},
					{
						field : "g",
						title : "操作",
						align : "center",
						width : getWidth(0.04),
						formatter : function(val,rec){
							var s1 = "<a href='javascript:update("+rec.xzcfid+");'>修改</a>";
							var s2 = "<a href='javascript:detail("+rec.xzcfid+");'>浏览</a>";
							var s3 = "<a href='javascript:;toIssue("+rec.xzcfid+")'>发布</a>";
							var s4 = "<a href='javascript:chexiao("+rec.xzcfid+");'>撤销</a>";
							return s2;
						}
					}
				] ],
				onDblClickRow:function(value,row,index)
				{
//                    update(row.id);
				}
			});
			//设置分页控件
			var p = $("#dg1").datagrid("getPager");
			$(p).pagination({
				beforePageText: "第",//页数文本框前显示的汉字
				afterPageText: "页    共 {pages} 页",
				displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
				onBeforeRefresh:function(){
				}
			});
			$("#dg1").datagrid("clearSelections");

		}

		//是否发布
		function toIssue(id){
			Dialog.confirm("确定要外网发布吗？", function() {
				jQuery.ajax({
					type: 'POST',
					url : "${base}/private/xzcf/toIssue?xzcfid="+id ,
					success : function (res) {
						if(res=="true"){
							Dialog.alert("外网发布成功！");
							loadData();
						}else{
							Dialog.alert("外网发布失败！");
						}
					},
					fail : function(res) {
						Dialog.alert("系统错误?!");
					}
				});
			})
		}

		//浏览页面
		function detail(id){
			var iHeight = 450;
			var iWidth = 900;
			var iTop = (window.screen.height-30-iHeight)/2;//获得窗口的垂直位置;
			var iLeft = (window.screen.width-20-iWidth)/2;//获得窗口的水平位置;
			window.open("${base}/private/xzcf/detail?xzcfid="+id+"&sys_random=" + Math.random(), "_blank", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		//浏览页面
		function qzDetail(id){
			var iHeight = 450;
			var iWidth = 900;
			var iTop = (window.screen.height-30-iHeight)/2;//获得窗口的垂直位置;
			var iLeft = (window.screen.width-10-iWidth)/2;//获得窗口的水平位置;
			window.open("${base}/private/xzqz/detail?xzqzid="+id, "浏览行政强制信息", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		Page.onLoad(function() {
			loadData();
		});
		
		$(window).resize(function () {
			clearTimeout(timer);
			timer=setTimeout(function(){
				$('#dg1').datagrid('resize');
				$('div.panel-body').css('width','auto'); //////
			},100);
		});
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
	<input type="hidden" name="doAction" value=""> <input
		type="hidden" name="sys_menuid" value="$!sys_menuid"> <input
		type="hidden" name="checkids" value=""> <input
		type="hidden" name="deltype" value="1">
	<div region="north" border="false"
		 style="overflow: hidden; padding: 10px 10px 0px 10px">
		<table width="100%" border="0" cellspacing="0" cellpadding="0"
			   class="blockTable">
			<tr>
				<td class="blockTd">
					<table width="100%" border="0" cellspacing="0" cellpadding="6">
						<tr>
							<td align="right" width="80">信息类型:</td>
							<td width="80">
								<select name="type" id="type">
									<option value="1" selected >行政处罚</option>
									<option value="2">行政强制</option>
								</select>
								<script type="text/javascript">selected(document.form1.type,"$!type")</script>
							</td>
							<td align="right" width="120">时间:</td>
							<td width="200">
												<input type="text" id="startTime" name="startTime" value="$!startTime"   style="width:80px;height:16px;background:#F4F9FB url(${base}/include/controls/my97/skin/datePicker.gif) no-repeat right;"
												  onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" >
								到 <input type="text" id="endTime" name="endTime" value="$!endTime"   style="width:80px;height:16px;background:#F4F9FB url(${base}/include/controls/my97/skin/datePicker.gif) no-repeat right;"
										 onclick="WdatePicker({dateFmt:'yyyy-MM-dd'})" >
							</td>
							<td align="right" width="160">录入单位:</td>
							<td width="160">
								#parse("private/global/unitSelect.html")
							</td>
							<td width="*">
													<span style="float: left;">
														<input type="button" name="check" id="check" onclick="loadData();" value="查询" />
														</span>

							</td>
						</tr>
						<tr>
							<td align="right">主体类型:</td>
							<td>
								<select id="xyzt_type" name="xyzt_type" onchange="loadData();">
									<option value="">请选择</option>
									#foreach($!xyzt in $!xyztMap)
									<option value="$!xyzt.value">$!xyzt.name</option>
									#end
								</select>
							</td>
							<td align="right">信用主体名称：</td>
							<td>
									<input type="text" name="xyzt_name" id="xyzt_name" size="32" placeholder="信用主体名称"/>
							</td>
							<td align="right">统一社会信用代码：</td>
							<td>
							<input type="text" name="code" id="code" size="20" placeholder="统一社会信用代码..." />
							</td>
						</tr>
					</table>
								

							</td>
						</tr>
						<tr>
						</tr>
					</table>
	</div>
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<div id="dg1" style="width: 100%; height: 100%;"></div>
	</div>
</form>
</body>
</html>
