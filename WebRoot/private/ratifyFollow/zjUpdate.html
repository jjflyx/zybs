<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
	<link href="${base}/private/ratifyFollow/css/$!stylename/style.css" rel="stylesheet" type="text/css" />
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!--<link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css" />-->
	<link href="${base}/include/controls/my97/skin/WdatePicker.css" rel="stylesheet" type="text/css"/>
	<script language="javascript" type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<script>
	
	var idNumberCheck = false;
		function doSave(){
			if(Verify.hasError()){
				return ;
			}
			var state=$("#state").val();
			var oldstate=$("#oldstate").val();
			if(state==0&&(state!=oldstate)){
				checkrebg();
			}
			idNumberCheck = false;
			checkIdNumber();
			if(!idNumberCheck){
				Dialog.alert("已有此身份证相关信息，请勿重复录入！",function(){
					$("#code").focus();
					return ;
				});
			}else{
			jQuery.ajax({
				type: 'POST',
				url : "${base}/private/gtxt/zj/update" ,
				data : $("#form1").serialize(),
				success : function (res) {
					if(res){
						Dialog.alert("修改成功！",function(){
							window.opener.loadGrid();
							window.close();
						});
					}else{
						Dialog.alert("修改失败！");
					}
					return false;
				},
				fail : function(res) {
					Dialog.alert("系统错误?!");
				}
			});
			}
		}
		
		function checkIdNumber(){
			var code = $("#code").val();
			var oldcode = $("#oldcode").val();
			if(code==oldcode){
				idNumberCheck = true;
			}else{
				jQuery.ajax({
					type: 'POST',
					url : "${base}/private/gtxt/zj/checkCode" ,
					data : {"code":code,"type":$("#type").val(),"unit":$("#unit").val()},
					success : function (res) {
						if(res=="true") {
							idNumberCheck = true;
						}else{
							idNumberCheck = false;
						}
					}
				});
			}
		}

		//添加信用主体
		function toAddfr(){
            var ctype = 1;
            var d = new Dialog("Addfr");
            d.Width = 800;
            d.Height = 450;
            d.Title = "添加信用主体";
            d.URL = "/gtxt/private/jlxx/toAddfr?zttype=1&ctype="+ctype;
            d.OKEvent = function(){
                if($DW.doSave()){
                    var ids = $DW.$("#checkids_id").val();
                    var names = $DW.$("#checkids_name").val();
                    $("#unit_name").val(names);
					$("#unit").val(ids);
                    $D.close();
                }
            }
            d.show();
        }
		
		function checkrebg(){
			var code = $("#code").val();
				jQuery.ajax({
					type: 'POST',
					url : "${base}/private/gtxt/zj/checkCode" ,
					data : {"code":code,"type":$("#type").val(),"unit":$("#unit").val()},
					success : function (res) {
						if(res=="true") {
							idNumberCheck = true;
						}else{
							idNumberCheck = false;
							Dialog.alert("此人已在职！");
							return;
						}
					}
				});
		}

		$(document).ready(function() {
			$(".radioItem").change(function() {
				var selectedvalue = $("input[name='local']:checked").val();
				if (selectedvalue == 0) {
					$("#getFr").show();
				} else {
					$("#getFr").hide();
				}
			});
		});
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="form1" method='post'>
	<input type="hidden" name="type" id="type" value="$!obj.type">
	<input type="hidden" name="xyzt_id" id="xyzt_id" value="$!obj.xyzt_id">
	<input type="hidden" name="id" id="id" value="$!obj.id">
	<input type="hidden" name="actor" id="actor" value="$!obj.actor">
	<input type="hidden" name="oldcode" id="oldcode" value="$!obj.code">
	<input type="hidden" name="oldstate" id="oldstate" value="$!obj.state">
	<input type="hidden" name="add_time" id="add_time" value="$!obj.add_time">
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<table width="98%" border="0" align="center" cellpadding="0"
			   cellspacing="0" class="table_auto margin_top15 table_titlebk">
			<tr>
				<td class="table_title" align="center">
					#if($!{obj.type}==1)
						估价师信息
					#elseif($!{obj.type}==2)
						土地代理登记人信息
					#else
						专业技术人员
					#end
				</td>
			</tr>
		</table>
		<table width="98%" border="0" align="center" cellpadding="0"  cellspacing="0" class="table_auto table_nrbk">
			<tr>
				<td valign="top" class="padding10">
					<table width="100%" border="0" cellpadding="0" cellspacing="3">
						<tbody id="div_sn">
						<tr>
							<td align="right" width="150">姓名：</td>
							<td width="220">
								<input type="text" name="name" id="name" size="20" maxlength="40" value="$!{obj.name}" verify="姓名|NotNull" /><span style="color:red">*</span>
							</td>
						</tr>
						<tr>
							<td align="right" width="150">
								身份证号：
							</td>
							<td algin="left" width="140">
								<input type="text" name="code" id="code" size="20" maxlength="50" value="$!{obj.code}" verify="身份证号|NotNull&&身份证号|isIdNumber" /><span style="color:red">*</span>
							</td>
				       </tr>
						#if($!{obj.type}==1)
						<tr>
							<td align="right" width="150">
								性别：
							</td>
							<td algin="left" width="140">
								<label><input type="radio" name="sex" value="0" #if($!{obj.sex}=="0") checked #end  />男性</label>
								<label><input type="radio" name="sex" value="1" #if($!{obj.sex}=="1") checked #end  />女性</label>
								<span style="color:red">*</span>
							</td>
						</tr>
						#end
						<tr>
					        <td align="right" width="150">
								联系电话：
							</td>
					        <td algin="left">
								<input type="text" name="tel" id="tel" size="20" value="$!{obj.tel}" maxlength="50"   verify="联系电话|isPhone" />
							</td>
						</tr>
						<tr>
							<td align="right">
								手机号码：
							</td>
							<td algin="left">
								<input type="text" name="phone" id="phone" value="$!{obj.phone}" size="20"   verify="手机号码|isPhone"/>
							</td>
						</tr>
						#if($!{type}==1||$!{type}==2)
						<tr>
							<td align="right">
								资格证号：
							</td>
							<td algin="left">
								<input type="text" name="zgzh" id="zgzh" value="$!{obj.zgzh}" size="40"  />
							</td>
						</tr>
						<tr>
							<td align="right">
								#if($!{type}==1)
									执业登记号：
								#else
									登记号：
								#end
							</td>
							<td algin="left">
								<input type="text" name="djh" id="djh" value="$!{obj.djh}" size="40" />
							</td>
						</tr>
						#end
						<tr>
							<td align="right">
								所属机构：
							</td>
							<td algin="left">
								<input type="hidden" name="unit" id="unit" size="40" value="$!{obj.unit}"  />
								<input type="text" name="unit_name" id="unit_name" size="40" value="$!{unit_name}" readonly  verify="所属机构|NotNull"  />
								&nbsp;<img src="${base}/include/img/cz_find.png" id="fr_img" name="fr_img" style=" vertical-align:middle;cursor: pointer;" onclick="toAddfr();"/>
							</td>
						</tr>
						<tr>
							<td align="right">
								人员在职情况：
							</td>
							<td algin="left">
								<select id="state" name="state"  verify="人员在职情况|NotNull" >
							<option value="">请选择</option>
							#foreach($!ryzt in $!ryztList)
							<option value="$!ryzt.value">$!ryzt.name</option>
							#end
						</select>
						<script type="text/javascript">selected(document.form1.state,"$!obj.state")</script>
							</td>
						</tr>
						</tbody>
					</table>
				</td>
			</tr>
		</table>
	</div>
	<div region="south" border="false"
		 style="overflow: hidden; padding: 10px 10px 0px 10px">
		<div align="center" style="padding-bottom: 10px;">
			<input class="button" type="button" name="btnOk" value="确认"
				   onclick="doSave()" />
			<input class="button" type="button" name="btnOk" value="关闭"
				   onclick="window.close();" />
		</div>
	</div>
</form>
</body>
</html>