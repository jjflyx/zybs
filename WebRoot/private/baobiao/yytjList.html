<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
	<title>$!app_name</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- 框架 -->
	<link rel="stylesheet" type="text/css" href="${base}/include/css/default.css"/>
	<script type='text/javascript'>
		var CONTEXTPATH = '${base}';
		var stylePath = '$!stylename';
	</script>
	<script src="${base}/include/js/main.js"></script>
	<script src="${base}/include/js/string.js"></script>
	<!-- 分页  注意顺序 -->
	<link href="${base}/include/css/themes/gray/easyui.css"
		  rel="stylesheet" type="text/css" />
	<script src="${base}/include/js/jquery.easyui.min.js"></script>
	<!-- 树 -->
	<script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
	<link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
	<script type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>

	<script>
		function checkSomeThing(val){
			Dialog.confirm("是否确定执行"+val+"操作?!",function(){
				Dialog.alert(val+"操作成功！");
			},function(){

			});
		}

		function doFun(){
			loadData();
		}

		function getWidth(percent){
			return document.body.clientWidth*percent;
		}
		function loadData(a,canshu){
           	$("#lb").val(a);
           	if(a==1){
           		document.getElementById("sqr").style.display="";
           		loadData1();
           	}else if(a==2){
           		document.getElementById("sqr").style.display="none";
           		loadData2();
           	}
        }
		
		//加载列表数据
		function loadGrid(){
			loadData();
		}
		var startdate = '$!startdate';
	    var enddate = '$!enddate';
	    var xzqh = '$!xzqh';
	    var xy_type = '$!xy_type';
	    var state = '$!state';
	    var cz = '$!cz';
		function loadData1(){
			$("#dg1").datagrid({
				width:"auto",
				height:"auto",
				nowrap: true,
				striped: true,
				border: true,
				collapsible:false,//是否可折叠的
				url : "${base}/private/baobiao/yytjList",//首次查询路径
				queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"state":state,"cz":cz,"source":$("#source").val(),
					"end_date":$("#endTime").val(),"keyword":$("#keyword").val(),"xyzt_id":$("#xyzt_id").val()},//首次查询参数
				idField:"id",
				remoteSort:false,
				singleSelect:false,//是否单选
				rownumbers:true,//行号
				fit: true,//自动大小
				fitColumns: true,//行自适应
				pagination:true,//分页控件
				loadMsg:'数据加载中...',
				columns : [ [
					{
						field : "contract_name",
						title : "涉及合同",
						width : getWidth(0.24),
						align : 'center',
						formatter: function(value,row,index){
							return value==null ? "---" : value;
						}
					},
					{
						field : "xyzt_name",
						title : "涉及信用主体",
						width : getWidth(0.21),
						align : 'center',
						formatter:function(value,row,index){
							return value==null ? "---" : value;
						}
					} ,
					{
						field : "applicant",
						title : "申请人",
						width : getWidth(0.06),
						align : 'left'
					},
					{
						field : "code",
						title : "证件号码",
						width : getWidth(0.14),
						align : 'center'

					},
					{
						field:"add_time",
						title:"申请时间",
						width:getWidth(0.17),
						align : 'center'
					},
					{
						field:"source",
						title:"来源",
						width:getWidth(0.04),
						align : 'center',
						formatter: function(value,row,index){
							if(value==0){
								value = "线上";
							}else{
								value = "线下";
							}
							return value;
						}
					},
					{
						field:"state",
						title:"状态",
						width:getWidth(0.09),
						align : 'center',
						formatter: function(value,row,index){
							if(value==0){
								value = "待处理";
							}else if(value==1){
								value = "处理中";
							}else{
								value = "办结";
							}
							return value;
						}
					},
					{
						field:"bb",
						title:"操作",
						width:getWidth(0.09),
						align : 'center',
						formatter: function(value,row,index){
							var s1 = "处理",s2="<a href='javascript:update("+row.id+",\"2\");'>浏览</a>";
							if(row.state != 2 ){
								s1 = "$!leader";
							}
							return s2+" |  "+s1 ;
						}
					}
				] ],
				/* frozenColumns:[[
					{field:"id",checkbox:true}
				]], */
				onDblClickRow:function(value,row,index)
				{
					update(row.id,'2');
				}
				//,
				// onLoadSuccess:function(){
				//	 initCheckbox();
				// }

			});
			//设置分页控件
			var p = $("#dg1").datagrid("getPager");
			$(p).pagination({
				beforePageText: "第",//页数文本框前显示的汉字
				afterPageText: "页    共 {pages} 页",
				displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
				onBeforeRefresh:function(){
				}
			});
			$("#dg1").datagrid("clearSelections");
		}
		var ztMap = $!ztMap;
		 function loadData2(){
	            $("#dg1").datagrid({
	                width:"auto",
	                height:"auto",
	                nowrap: true,
	                striped: true,
	                border: true,
	                collapsible:false,//是否可折叠的
	                url : "${base}/private/baobiao/yyxyztSel",//首次查询路径
	                queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"state":state,"cz":cz,"xyztsel":$("#xyztsel").val()},//首次查询参数
	                idField:"sxcjid",
	                treeField:"name",
	                remoteSort:false,
	                singleSelect:false,//是否单选
	                rownumbers:true,//行号
	                fit: true,//自动大小
	                fitColumns: true,//行自适应
	                pagination:true,//分页控件
	                loadMsg:'数据加载中...',
	                columns : [ [
	                    {
	                        field : "name",
	                        title : "信用主体",
	                        width : getWidth(0.4),
	                        align : 'center'
	                    },
	                    {
	                        field : "xyzt_type",
	                        title : "类型",
	                        align : "center",
	                        width : getWidth(0.2),
	                        formatter : function(val,rec){
	                            if(val!=null && val!=""){
	                                val = ztMap[val];
	                            }
	                            return val;
	                        }
	                    } ,
	                    {
	                        field : "yyjl",
	                        title : "异议条数",
	                        align : "center",
	                        width : getWidth(0.2)
	                    } ,
	                    {
	                        field:"bb",
	                        title:"操作",
	                        width:getWidth(0.1),
	                        align : 'center',
	                        formatter: function(value,rec){
	                            var s1 = "<a href='javascript:showcy("+rec.xyzt_id+","+2+");'>详情</a>";
	                            return s1;
	                        }
	                    }
	                ] ],
	                onDblClickRow:function(row)
	                {
	                    update();
	                }
	            });
	            var p = $("#dg1").datagrid("getPager");
				$(p).pagination({
					beforePageText: "第",//页数文本框前显示的汉字
					afterPageText: "页    共 {pages} 页",
					displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
					onBeforeRefresh:function(){
					}
				});
				$("#dg1").datagrid("clearSelections");
	        }

		function update(id,type){
			var iHeight = 560;
			var iWidth = 800;
			var iTop = (window.screen.height - 30 - iHeight) / 2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width - 10 - iWidth) / 2; //获得窗口的水平位置;
			window.open("${base}/private/gtxt/xyzt/toWarnExceptionUpdate?id="+id+"&type="+type, "异议申请处理", 'height=' + iHeight + ',,innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		function add(){
			var iHeight = 660;
			var iWidth = 980;
			var iTop = (window.screen.height - 30 - iHeight) / 2; //获得窗口的垂直位置;
			var iLeft = (window.screen.width - 10 - iWidth) / 2; //获得窗口的水平位置;
			window.open("${base}/private/gtxt/xyzt/toWarnExceptionChoice", "线下异议添加", 'height=' + iHeight + ',,innerHeight=' + iHeight + ',width=' + iWidth + ',innerWidth=' + iWidth + ',top=' + iTop + ',left=' + iLeft + ',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
		}

		//转到排序页面
		function sort()
		{
			var d = new Dialog("Sort");
			d.Width = 450;
			d.Height = 350;
			d.Title = "菜单排序";
			d.URL = "${base}/private/ratifyFollow/warnList";
			d.OKEvent = function() {
				$DW.getIdsTree();
				sortUpdate();
			}
			//d.ShowMessageRow = true;
			//d.MessageTitle = "菜单排序";
			//d.Message = "只能改变同级的先后顺序，并要保证原先的上下级关系不变！";
			d.show();
		}
		function sortUpdate(){
			if($DW.Verify.hasError()){
				return;
			}
			if($DW.$("#commit").val()==0){
				$DW.$("#commit").val(1);
				jQuery.ajax({
					type: 'POST',
					url : "${base}/private/sys/res/sort" ,
					data : $DW.$("#form1").serialize(),
					success : function (res) {

						if(res=="true"){
							$D.close();
							Dialog.alert("排序成功！");
							loadData();
						}else{
							Dialog.alert("排序失败！");
						}

						return false;
					},
					fail : function(res) {
						Dialog.alert("系统错误?!");
					}
				});
			}else{
				Dialog.alert("正在提交，请稍候！");
				return false;
			}
		}
		function del() {
			var arr = $('#dg1').treegrid('getSelections');
			if (!arr || arr.length == 0) {
				Dialog.alert("请先选择要删除的菜单！");
				return;
			}
			Dialog.confirm("注意：您确认要删除吗？", function() {
				jQuery.ajax({
					url : "${base}/private/zjgl/fr/del",

					success : function (res) {

						if(res=="true"){
							Dialog.alert("删除成功！");
							loadData();
						}else{
							Dialog.alert("删除失败！");
						}

						return false;
					},
					fail : function(res) {
						Dialog.alert("系统错误?!");
					}
				});


			});
		}
		function sel(obj){
			var id=obj.value;
			var qx=document.getElementsByName("id");
			for(var i = 0; i < qx.length; i ++)
			{
				if(qx[i].type == "checkbox")
				{
					var v=qx[i].value;
					if(v!=""&&v.length>id.length&&v.startWith(id)){
						if(obj.checked){
							qx[i].checked=true;
						} else{
							qx[i].checked=false;
						}
					}
					if(v!=""&&v.length<id.length&&id.startWith(v)){
						if(obj.checked){
						} else{
							qx[i].checked=false;
						}
					}

				}
			}

		}
		
		function showcy(canshu,lb){
        	$("#xyzt_id").val(canshu);
        	loadData(1);
        }
		
		Page.onLoad(function() {
			loadData(1);
		});
		$(window).resize(function () {
			clearTimeout(timer);
			timer=setTimeout(function(){
				$('#dg1').treegrid('resize');
				$('div.panel-body').css('width','auto'); //////
			},100);
		});
		
		function EXP() {
			form1.action = "${base}/private/baobiao/dcYytj";
			form1.submit();
		}
		
	</script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
	<input type="hidden" id="unitid" name="unitid" value="$!unitid"/>
	<input type="hidden" id="xyzt_id" name="xyzt_id" value="">
	<input type="hidden" id="lb" name="lb" value="">
	<input type="hidden" id="xzqh" name="xzqh" value="$!xzqh">
	<input type="hidden" id="state" name="state" value="$!state">
	<input type="hidden" id="cz" name="cz" value="$!cz">
	<div region="north" border="false"
		 style="overflow: hidden; padding: 10px 10px 0px 10px">
					
	<table width="100%" border="0" cellspacing="0" cellpadding="0"class="blockTable">
        <tr>
        <td class="blockTd">
        <table width="100%" border="0" cellspacing="0" cellpadding="6">
                                <tr>
                                        <td style="padding: 8px 0 4px 6px;" nowrap="nowrap">
                                        <span style="float: left">
                                        	归类：<select name="glcx" id="glcx" onchange="loadData(this.value);">
                                            <option value="1">请选择</option>
                                            <option value="2">信用主体</option>
                                            </select> 
                                               <span id="sqr">
                                       			&nbsp; &nbsp; 
                                            	申请人：<input type="text" name="keyword" id="keyword" size="20" placeholder="申请人..." />&nbsp;
														&nbsp;来源&nbsp;
														<select name="source" id="source">
															<option value="">请选择</option>
															<option value="0">线上</option>
															<option value="1">线下</option>
														</select>
														&nbsp; 
														<input type="button" name="check" id="check" onclick="loadData(1);" value="查询" />
                                       		</span>
                                       		<span><input class="button" type="button" id="dosearch" name="dosearch" value="导出Excel" onclick="EXP();" />
										 &nbsp; &nbsp;<input type="button" name="check" id="check" value="返回" onclick="javascript:history.back(-1);"/></span>
                                        
                                        </span>
                                        
                                        </td>
                                </tr>
                            </table></td></tr></table>
	</div>
	<div region="center" border="false"
		 style="width: 100%; height: 100%; padding: 0px 10px 10px;">
		<div id="dg1" style="width: 100%; height: 100%;"></div>
	</div>
</form>
</body>
</html>