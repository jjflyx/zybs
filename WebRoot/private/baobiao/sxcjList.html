<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title>$!app_name</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <!-- 框架 -->
    <link rel="stylesheet" type="text/css" href="${base}/include/css/default.css"/>
    <script type='text/javascript'>
        var CONTEXTPATH = '${base}';
        var stylePath = '$!stylename';
    </script>
    <script src="${base}/include/js/main.js"></script>
    <script src="${base}/include/js/string.js"></script>
    <!-- 分页  注意顺序 -->
    <link href="${base}/include/css/themes/gray/easyui.css"
          rel="stylesheet" type="text/css" />
    <script src="${base}/include/js/jquery.easyui.min.js"></script>
    <!-- 树 -->
    <script type="text/javascript" src="${base}/include/controls/ztree/jquery.ztree.core-3.5.min.js"></script>
    <link rel="stylesheet" href="${base}/include/controls/ztree/zTreeStyle/zTreeStyle.css" type="text/css">
    <script type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>

    <script>
        function checkSomeThing(val){
            Dialog.confirm("是否确定执行"+val+"操作?!",function(){
                Dialog.alert(val+"操作成功！");
            },function(){

            });
        }

        function getWidth(percent){
            return document.body.clientWidth*percent;
        }

        //加载列表数据
        function loadData(a,canshu){
        	$("#lb").val(a);
        	if(a==1){
        		document.getElementById("xyztlx").style.display="";
        		loadData1(canshu);
        	}else if(a==2){
        		document.getElementById("xyztlx").style.display="none";
        		loadData2();
        	}else if(a==3){
        		document.getElementById("xyztlx").style.display="none";
        		loadData3();
        	}else if(a==4){
        		document.getElementById("xyztlx").style.display="none";
        		loadData4();
        	}else if(a==5){
        		document.getElementById("xyztlx").style.display="none";
        		loadData5();
        	}
            
            //设置分页控件
            var p = $("#dg1").datagrid("getPager");
            $(p).pagination({
                beforePageText: "第",//页数文本框前显示的汉字
                afterPageText: "页    共 {pages} 页",
                displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
                onBeforeRefresh:function(){
                }
            });
            $("#dg1").datagrid("clearSelections");
        }
        
        var csTable = $!csTable;
        var ztTable = $!ztTable; 
        var cjztTable = $!cjztTable;
        var startdate = '$!startdate';
        var enddate = '$!enddate';
        var xzqh = '$!xzqh';
        var xy_type = '$!xy_type';
        var sxxwtypeMap = $!sxxwtypeMap;
        function loadData1(canshu){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: true,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/baobiao/sxcjList",//首次查询路径
                queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"xyzt_type":$("#xyzt_type").val(),"xyzt_id":$("#xyzt_id").val(),"sxxw_id":$("#sxxw_id").val(),"src":$("#src").val(),"type":$("#type").val()},//首次查询参数
                idField:"sxcjid",
                treeField:"name",
                remoteSort:false,
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        width : getWidth(0.2),
                        align : 'center'
                    },
                    {
                        field : "xyzt_type",
                        title : "类型",
                        align : "center",
                        width : getWidth(0.05),
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                                val = ztTable[val];
                            }
                            return val;
                        }
                    } ,
                    {
                        field : "sxxw",
                        title : "失信行为",
                        width : getWidth(0.24),
                        align : 'center',
                        formatter : function(value,row,index){
                            var sub = "";
                            if(value.length > 40){
                                sub = value.substring(0,35)+"...";
                            }else{
                                sub = value;
                            }
                            var html = "<span title='"+value+"'>"+sub+"</span>";
                            return html;
                        }

                    },
                    {
                        field : "src",
                        title : "生成方式",
                        width : getWidth(0.08),
                        align : 'center',
                        formatter : function(val,rec){
                            var val = val+"";
                            if(val!=null && val!=""){
                                val = csTable[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "xy_type",
                        title : "业务类别",
                        align : "center",
                        width : getWidth(0.10),
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                                val = sxxwtypeMap[val];
                            }
                            return val;
                        }
                    },
                    {
                        field:"startdend",
                        title:"惩戒期限",
                        width:getWidth(0.14),
                        align : 'center'
                    },
                    {
                        field:"type",
                        title:"惩戒状态",
                        width:getWidth(0.06),
                        align : 'center',
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                                val = cjztTable[val];
                            }
                            return val;
                        }
                    },
                    {
                        field:"bb",
                        title:"操作",
                        width:getWidth(0.06),
                        align : 'center',
                        formatter: function(value,rec){
                            var s1 = "<a href='javascript:show("+rec.sxcjid+");'>浏览</a>";
                            return s1;
                        }
                    }
                ] ],
                onDblClickRow:function(row)
                {
                    update();
                }
                //,
                // onLoadSuccess:function(){
                //   initCheckbox();
                // }

            });
        }
        
        //按照信用主体
        function loadData2(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: true,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/baobiao/xyztSel",//首次查询路径
                queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"xyztsel":$("#xyztsel").val()},//首次查询参数
                idField:"sxcjid",
                treeField:"name",
                remoteSort:false,
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "name",
                        title : "信用主体",
                        width : getWidth(0.4),
                        align : 'center'
                    },
                    {
                        field : "xyzt_type",
                        title : "类型",
                        align : "center",
                        width : getWidth(0.2),
                        formatter : function(val,rec){
                            if(val!=null && val!=""){
                                val = ztTable[val];
                            }
                            return val;
                        }
                    } ,
                    {
                        field : "sxjl",
                        title : "失信惩戒条数",
                        align : "center",
                        width : getWidth(0.2)
                    } ,
                    {
                        field:"bb",
                        title:"操作",
                        width:getWidth(0.1),
                        align : 'center',
                        formatter: function(value,rec){
                            var s1 = "<a href='javascript:showcy("+rec.xyzt_id+","+2+");'>详情</a>";
                            return s1;
                        }
                    }
                ] ],
                onDblClickRow:function(row)
                {
                    update();
                }
            });
        }
        
        //按照失信行为
        function loadData3(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: true,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/baobiao/sxxwSel",//首次查询路径
                queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"sxxw_id",
                treeField:"name",
                remoteSort:false,
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
					/* {
    					field : "sxxw_id",
    					title : "失信行为",
    					width : getWidth(0.4),
    					align : 'center'
					}, */
                    {
                        field : "sxxw",
                        title : "失信行为",
                        width : getWidth(0.4),
                        align : 'center'
                    },
                    {
                        field : "sxjl",
                        title : "失信惩戒条数",
                        align : "center",
                        width : getWidth(0.3)
                    } ,
                    {
                        field:"bb",
                        title:"操作",
                        width:getWidth(0.2),
                        align : 'center',
                        formatter: function(value,rec){
                        	var s="1"+rec.sxxw_id;
                            var s1 = "<a href='javascript:showcy("+s+","+3+");'>详情</a>";
                            return s1;
                        }
                    }
                ] ]
                
            });
        }
        
        //按照生成方式
        function loadData4(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: true,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/baobiao/scfsSel",//首次查询路径
                queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"sxxw_id",
                treeField:"name",
                remoteSort:false,
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "src",
                        title : "生成方式",
                        width : getWidth(0.4),
                        align : 'center',
                        formatter : function(val,rec){
                            var val = val+"";
                            if(val!=null && val!=""){
                                val = csTable[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "sxjl",
                        title : "失信惩戒条数",
                        align : "center",
                        width : getWidth(0.3)
                    } ,
                    {
                        field:"bb",
                        title:"操作",
                        width:getWidth(0.2),
                        align : 'center',
                        formatter: function(value,rec){
                            var s1 = "<a href='javascript:showcy("+rec.src+","+4+");'>详情</a>";
                            return s1;
                        }
                    }
                ] ]
                
            });
        }
        
      //按照惩戒状态
        function loadData5(){
            $("#dg1").datagrid({
                width:"auto",
                height:"auto",
                nowrap: true,
                striped: true,
                border: true,
                collapsible:false,//是否可折叠的
                url : "${base}/private/baobiao/cjztSel",//首次查询路径
                queryParams:{"startdate":startdate,"enddate":enddate,"xy_type":xy_type,"xzqh":xzqh,"xyzt_type":$("#xyzt_type").val()},//首次查询参数
                idField:"sxxw_id",
                treeField:"name",
                remoteSort:false,
                singleSelect:false,//是否单选
                rownumbers:true,//行号
                fit: true,//自动大小
                fitColumns: true,//行自适应
                pagination:true,//分页控件
                loadMsg:'数据加载中...',
                columns : [ [
                    {
                        field : "type",
                        title : "惩戒状态",
                        width : getWidth(0.4),
                        align : 'center',
                        formatter : function(val,rec){
                        	if(val!=null && val!=""){
                                val = cjztTable[val];
                            }
                            return val;
                        }
                    },
                    {
                        field : "sxjl",
                        title : "失信惩戒条数",
                        align : "center",
                        width : getWidth(0.3)
                    } ,
                    {
                        field:"bb",
                        title:"操作",
                        width:getWidth(0.2),
                        align : 'center',
                        formatter: function(value,rec){
                            var s1 = "<a href='javascript:showcy("+rec.type+","+5+");'>详情</a>";
                            return s1;
                        }
                    }
                ] ]
                
            });
        }
        
        function chexiao(id){
            Dialog.confirm("确定撤销吗？",function(){
                var iHeight = 560;
                var iWidth = 900;
                var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
                var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
                window.open ("${base}/private/sxcj/toCancel?sxcjid="+id, "法人信息修改", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
            });
        }
        
        function show(id){
            var iHeight = 560;
            var iWidth = 800;
            var iTop = (window.screen.height-30-iHeight)/2; //获得窗口的垂直位置;
            var iLeft = (window.screen.width-10-iWidth)/2; //获得窗口的水平位置;
            window.open ("${base}/private/sxcj/detail?sxcjid="+id, "预警信息查看", 'height='+iHeight+',,innerHeight='+iHeight+',width='+iWidth+',innerWidth='+iWidth+',top='+iTop+',left='+iLeft+',toolbar=no,menubar=no,scrollbars=auto,resizeable=no,location=no,status=no');
        }

        
        Page.onLoad(function() {
            loadData(1);
        });
        
        $(window).resize(function () {
            clearTimeout(timer);
            timer=setTimeout(function(){
                $('#dg1').treegrid('resize');
                $('div.panel-body').css('width','auto'); //////
            },100);
        });
        function EXP(){
    		form1.action="${base}/private/baobiao/dcSxcj";
    		form1.submit();
    	}
        
        //返回初始页
        function showcy(canshu,lb){
        	if(lb==2){
        		$("#xyzt_id").val(canshu);
        		$("#sxxw_id").val("");
        		$("#src").val("");
        	}else if(lb==3){
        		$("#sxxw_id").val(canshu);
        		$("#xyzt_id").val("");
        		$("#src").val("");
        	}else if(lb==4){
        		$("#src").val(canshu);
        		$("#xyzt_id").val("");
        		$("#sxxw_id").val("");
        	}else if(lb == 5){
        		$("#type").val(canshu);
        		$("#xyzt_id").val("");
        		$("#sxxw_id").val("");
        	}
        	loadData(1);
        }
        
    </script>
</head>
<body leftmargin="0" topmargin="0" class="easyui-layout">
<form name='form1' id="from1" method='post'>
    <input type="hidden" name="doAction" value="">
    <input type="hidden" name="sys_menuid" value="$!sys_menuid">
    <input type="hidden" name="checkids" value="">
    <input type="hidden" name="deltype" value="1">
    <input type="hidden" id="xyzt_id" name="xyzt_id" value="">
    <input type="hidden" id="src" name="src" value="">
    <input type="hidden" id="sxxw_id" name="sxxw_id" value="">
    <input type="hidden" id="lb" name="lb" value="">
    <input type="hidden" id="type" name="type" value="">
    <input type="hidden" id="startdate" name="startdate" value="$!startdate">
    <input type="hidden" id="enddate" name="enddate" value="$!enddate">
    <input type="hidden" id="xzqh" name="xzqh" value="$!xzqh">
    <input type="hidden" id="xy_type" name="xy_type" value="$!xy_type"> 

    <div region="north" border="false"
         style="overflow: hidden; padding: 10px 10px 0px 10px">
         <table width="100%" border="0" cellspacing="0" cellpadding="0"
                       class="blockTable">
        <tr>
        <td class="blockTd">
        <table width="100%" border="0" cellspacing="0" cellpadding="6">
                                <tr>
                                        <td style="padding: 8px 0 4px 6px;" nowrap="nowrap">
                                        <span style="float: left">
										归类：<select name="glcx" id="glcx" onchange="loadData(this.value);">
                                                                    <option value="1">请选择</option>
                                                                    <option value="2">信用主体</option>
                                                                    <option value="3">失信行为</option>
                                                                    <option value="4">生成方式</option>
                                                                    <option value="5">惩戒状态</option>
                                               </select> 
                                       &nbsp; &nbsp; 
                                       <span id="xyztlx" name="xyztlx" style="display:">
                                                                                                  信用主体类型：<select name="xyzt_type" id="xyzt_type" onchange="loadData(1);">
                                                                    <option value="">请选择</option>
                                                                    #foreach($!type in $!ztlxlist)
                                                                    <option value="$!type.value">$!type.name</option>
                                                                    #end
                                                               </select></span> 
                                       
                                       &nbsp; &nbsp; 
                                       <input class="button" type="button" id="dosearch" name="dosearch" value="导出Excel" onclick="EXP();" />
                                       &nbsp; &nbsp; 
                                        <input type="button" name="check" id="check" value="返回" onclick="javascript:history.back(-1);"/>
                                        </span>
                                        
                                        </td>
                                </tr>
                            </table></td></tr></table>
    </div>
    <div region="center" border="false"
         style="width: 100%; height: 100%; padding: 0px 10px 10px;">
        <div id="dg1" style="width: 100%; height: 100%;"></div>
    </div>


</form>

</body>
</html>