<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
	<head>
		<title>$!app_name</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<link rel="stylesheet" type="text/css" href="${base}/include/css/default.css"/>

		<link href="${base}/include/css/themes/gray/easyui.css"
		  rel="stylesheet" type="text/css" />
		<script type='text/javascript'>
			var CONTEXTPATH = '${base}';
			var stylePath = '$!stylename';
		</script>
		<script src="${base}/include/js/main.js"></script>
		<script src="${base}/include/js/string.js"></script>
		<!-- 分页  注意顺序 -->
		<link href="${base}/include/css/themes/gray/easyui.css" rel="stylesheet" type="text/css" />
		<script src="${base}/include/js/jquery.easyui.min.js"></script>
		<script type="text/javascript" src="${base}/include/controls/my97/WdatePicker.js"></script>
		<script>
		
		function getWidth(percent){
	        return document.body.clientWidth*percent;
		}
		var loginname='$!loginname';
		function loadData(){
			$("#dg1").treegrid({
				width:"auto",
	        	height:"auto",
	        	nowrap: true,  
	        	striped: true,  
	        	border: true,  
	        	collapsible:false,//是否可折叠的 
				url : "${base}//private/zcxx/zclist",//首次查询路径
				queryParams:{"name":$('#name').val(),"idcard":$('#idcard').val(),"zc_name":$('#zc_name').val(),"zc_card":$('#zc_card').val(),"starttime":$('#starttime').val(),"endtime":$('#endtime').val()},//首次查询参数
				idField:"id",
				treeField:"",
				singleSelect:false,//是否单选 
				rownumbers:true,//行号  
				fit: true,//自动大小  
				fitColumns: true,//行自适应
				pagination:true,//分页控件  
				pageNumber:1,
				loadMsg:'数据加载中...',
				columns : [ [
				{
					field : "name",
					title : "姓名",
					align : "center",
					width : 100
				},
				{
					field : "idcard",
					title : "身份证",
					align : "center",
					width : 100
				},
				{
					field : "zc_name",
					title : "职称名称",
					align : "center",
					width : 60
					/* ,
					formatter:function(val,rec){
						if(val!=null&&val!=""){
							val=typeMap[val];
						}
						return val;
					} */
				},
				{
					field : "zc_card",
					title : "职称编号",
					align : "center",
					width : 60
				},
				{
					field : "zc_level",
					title : "职称级别",
					align : "center",
					width : 60
				},
				{
					field : "zc_time",
					title : "获得时间",
					align : "center",
					width : 60
				},
				{
					field : "sp_unit",
					title : "审批单位",
					align : "center",
					width : 40
				},
				{
					field : "zc_state",
					title : "状态",
					align : "center",
					width : 40,
					formatter:function(val,rec){
						if(val==0){
							return "<span style=\"color:green\">正常</span>";
						}else if(val==1){
							return "<span style=\"color:red\">注销</span>";
						}else if(val==2){
							return "<span style=\"color:red\">吊销</span>";
						}
					}
				},
				{
					field : "detail",
					title : "操作",
					align : "center",
					width : 50,
					formatter:function(val,rec){ 
						var s1="";
						var s2="";
						if(rec.zc_state==0&&(rec.create_loginname==loginname||rec.create_loginname==null)){
							s1 = '<a href="javascript:update(\''+rec.id+'\');">修改</a>';
							s2 = '<a href="javascript:detail(\''+rec.id+'\');">浏览</a>';
							return s2+" | "+s1;  
						}else{
							s2 = '<a href="javascript:detail(\''+rec.id+'\');">浏览</a>';
							return s2;  
						}
						
						
	                }  
				}
				]],
				frozenColumns:[[
					{field:"id",checkbox:true}
				]],
				 onDblClickRow:function(index,row)
	        	 {
	        	    detail(row.id);
	        	 }
			});
			var p = $("#dg1").treegrid("getPager");
	        $(p).pagination({
	            beforePageText: "第",//页数文本框前显示的汉字
	            afterPageText: "页    共 {pages} 页",
	            displayMsg: "当前显示 {from} - {to} 条记录   共 {total} 条记录",
	            onBeforeRefresh:function(){
	                $(this).pagination('loading');
	                $(this).pagination('loaded');
	            }
	        });
		}
		
	
		function add(){
			var url='${base}/private/zcxx/toadd?sys_random=' + Math.random();
		   	var title='新增职称';
		    var iWidth=750; //弹出窗口的宽度;
			var iHeight=550; //弹出窗口的高度;  
		   	openWin3(url,title,iWidth,iHeight);
		}
	
	  function update(id){
		    var url='${base}/private/zcxx/toupdate?id='+id+'&sys_random=' + Math.random();
		   	var title='';
		    var iWidth=750; //弹出窗口的宽度;
			var iHeight=550; //弹出窗口的高度;  
		   	openWin3(url,title,iWidth,iHeight);
	  }
	  
	  
	  function detail(id){
			var url='${base}/private/zcxx/view?id='+id+'&sys_random=' + Math.random();
		   	var title='';
		    var iWidth=750; //弹出窗口的宽度;
			var iHeight=550; //弹出窗口的高度;  
		   	openWin3(url,title,iWidth,iHeight);
		}
	  
	  
	  function del(){
	  	 	var ids = [];
			var arr = $('#dg1').treegrid('getSelections');
		    if (!arr || arr.length == 0) {
		        Dialog.alert("请先选择需要删除的信息！");
		        return;
		    }
		    for(var i=0; i<arr.length; i++){
		        ids.push(arr[i].id);
		    }
	          Dialog.confirm("您确认要删除吗？删除后无法恢复！", function() {
	       	   jQuery.ajax({
	      			url : "${base}/private/zcxx/deleteIds/?ids="+ids,
	      			success : function (res) {  
	      				if(res=="true"){ 
	      					Dialog.alert("删除成功！");
	      					loadData();
	      				}else{
	      					Dialog.alert("删除失败！");
	      				}
	      				 
	      				return false;
	      			},
	      			fail : function(res) {
	      				Dialog.alert("系统错误?!");
	      			}
	      		});
	       	   
	          });
	  }
	  
	  function cancel(id){
		  var url='${base}/private/zcxx/zx/tocancel?id='+id+'&sys_random=' + Math.random();
		  var title='';
		  var iWidth=950; //弹出窗口的宽度;
		  var iHeight=550; //弹出窗口的高度;  
		  openWin3(url,title,iWidth,iHeight);
	  }
	   
		Page.onLoad(function() {
		    loadData();
		   
	     });
		$(window).resize(function () {
			clearTimeout(timer);
			timer=setTimeout(function(){
			  $('#dg1').treegrid('resize');
			  $('div.panel-body').css('width','auto'); 
			 },100);
			});
		
		
		
	</script>
	</head>
	<body leftmargin="0" topmargin="0" class="easyui-layout">
		<form name='form1' id="form1" method='post'>
			
			<div region="north" border="false" style="overflow: hidden; padding: 10px 10px 0px 10px">
				
				<table width="100%" border="0" cellspacing="0" cellpadding="0" class="blockTable">
					<tr>
						<td class="blockTd">
							<table width="100%" border="0" cellspacing="0" cellpadding="6">
								<!-- <tr>
									<td valign="middle">
										<img src="${base}/images/icons/icon021a1.gif" width="20" height="20" />
										&nbsp;<span>职称信息</span>
									</td>
								</tr> -->
								<tr>
									<td style="padding: 8px 0 4px 6px;" id="btnlist">
									<span style="float: left;"> 
										姓名：<input id="name" name="name" type="text" size="15" />
										&nbsp;&nbsp; 
										身份证： <input id="idcard" name="idcard" type="text" size="20" />
										&nbsp;&nbsp; 
										职称： <input id="zc_name" name="zc_name" type="text" size="15" />
										&nbsp;&nbsp;
										职称编号： <input id="zc_card" name="zc_card" type="text" size="15" />
										&nbsp;&nbsp; 
										<!-- 职称获得时间：
										<input  onclick="WdatePicker();" name="starttime" id="starttime" size="10" readonly="readonly" >
										至
										<input  onclick="WdatePicker();" name="endtime" id="endtime" size="10" readonly="readonly" > -->
										&nbsp;&nbsp; 
										<input class="button" type="button" id="dosearch" name="dosearch" value="查询" onclick="loadData();" />
									</span> 
									<span style="float: right;"> 
										<a href='javascript:void(0);' ztype='zPushBtn' class='zPushBtn' hidefocus='true' tabindex='-1' onselectstart='return false' id='a' onClick="add();">
											<img src="${base}/images/icons/icon022a2.gif" width="20" height="20" /><b>新建&nbsp;</b>
										</a>
										<a href="javascript:void(0);" ztype="zPushBtn" class="zPushBtn" hidefocus="true" tabindex="-1" onselectstart="return false" id="BtnDel" onclick="del();">
											<img src="/gtxt/images/icons/icon022a2.gif" width="16" height="16"><b>删除&nbsp;</b>
										</a>
									</span></td>
								</tr>
							</table>
						</td>
					</tr>
				</table>
			</div> 
			
			<div region="center" border="false" style="width: 100%; height: 100%; padding: 0px 10px 10px;">
				<div id="dg1" style="width: 100%; height: 100%;"></div>
			</div>
		</form>
	</body>
</html>